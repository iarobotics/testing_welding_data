function [y1,xf1] = nn_d10n10newrupture(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 08-May-2019 11:37:10.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.209512942773335098;10.521841936866458411;-3.3969079567861384383;-5.8271537344633177469;8.806186725147698624;-5.648437453694808319;3.567354680062349459;10.714260557044285704;-9.025138885295355351;-9.3289375476739966331];
IW1_1 = [-11.77018393556572029 4.089211843815787617 9.0836574064375739113 -4.6541997855109844551 -3.6034961777657317228 2.2461143973405031105 2.0053751817833886939 -1.6546089247882442841 1.4471676856020052604 0.70125154308515158519 0.0070930801761520424764 -0.17353179091002343681 2.5109511690252386273 -4.0011612524486412923 6.7476704564456824187 -1.8085649120815696644 -4.8140675048795111834 3.5477248539581056619 -0.47362070874282363731 -1.8549736855190386287;6.4209977037999905747 1.5389975486445619524 11.985275221498035592 -2.9751089923864975084 3.1887977104561717745 0.48798222351217934722 6.8475011624555621736 -2.4195089522769905876 2.0531007893439352507 -3.2211512667460686643 1.7454929139340862321 -0.68895191015174017668 -7.0737873098762689139 1.8906647968208081245 -11.267644481526765787 5.9268952550601028406 -9.6066329119118201163 5.342668777598150065 -8.5495910382196598221 5.9828399145233746026;-14.681995361546539058 1.1127880744752662867 5.0028894885918591129 -3.1721976875866992884 -0.93001109004382898071 1.7928335307163247858 -2.7304989724103925219 -0.78501522718366834042 1.8083277893804241554 1.5264290062764407363 1.9742423926672127976 0.47180623027093854249 4.8375156884399386215 -2.9617847533379988434 9.2748476068522816007 -2.4678012813414880178 -5.284497355107247607 6.4169824428251391879 1.3694603150773589917 -3.9919485595299373237;-35.294023543006197485 20.514350092407816817 -22.477830606576638672 12.629274880806343972 -14.540353358873678857 10.38393259544787206 -8.6644353088490309034 6.4690986415917199892 5.1841983830871631866 2.2817294739434874629 7.3938404602640215302 -0.93619762759856950396 19.480958112558550255 -10.427221843834157511 23.756692271221663049 -14.467054106875780306 18.140078922886910817 -12.371363263891801409 11.761140994219836386 -21.153517935746915413;-6.066874015918476637 8.4450930500110654719 -8.6114748543446246742 8.8412234141507966001 -0.32912426706237674079 2.6070017803615703755 1.3114916839718588903 0.98140788197826089867 5.9959908227439973061 -1.3938200994303751035 2.2512560573447584211 -1.2356371089280984155 5.0804379240443111598 -1.0251466890189107062 2.6269078770339566731 -0.33316276739081196467 -4.6730632230898514479 -0.69962419794700636544 0.80545797283017972479 -5.8735334662041376319;-32.895319293677388828 17.839055471194718905 -23.147558643323034033 13.431616928919833498 -13.985440905014314694 9.7337884817560578199 -9.6482364737981871627 5.6390057770830122053 5.4819818732072107537 2.3335083109435830195 6.5801410034859966203 -0.97032820689388932234 19.393607105034025295 -9.4848420618305073759 23.6119580308317083 -13.396117275999461782 16.621744630456671388 -11.555214173771307884 12.743964297221090476 -20.715420881150929944;12.724964570158086019 -2.1417979812929441863 -6.1980224841271587266 3.6377722175393198967 2.0644745320030817304 -1.8873092764279062461 0.66185368398580424198 1.0816614537038686805 -1.4267559184942648631 -1.0357621716410898571 -1.351098850754463232 -0.29228091404976225265 -3.4689980330986522894 3.1506034738636499171 -7.7989307234421776371 2.0964508556711392018 4.5205319499856333465 -4.7969892598968595365 -0.54697723594472358322 2.8059084682660362375;7.2982823103050220581 1.3857816836241401148 12.5862594616424186 -3.0932114797858250022 2.3873045649460573614 0.71277867342227518854 7.1696742431213156266 -2.6201781182047865215 1.9464173378592619645 -3.3645567610299433881 1.3585896265265835492 -0.912640246896728069 -7.1955110398775294911 1.957013791912487255 -11.788215828781098082 6.4593425516226217198 -9.6786054188217889305 5.1823162026699813865 -8.3352905970200623642 6.1894944466596424348;7.7789528542399786204 -7.8868218489624428713 8.8634168459972269005 -8.2823912980820075802 1.4199593824896434846 -3.0397277598740695126 -0.020408718144347401391 -1.5952492289581814422 -5.2007398300476639363 1.1695360043921363413 -2.423803807938663013 1.1528270943556153671 -6.5825358636408628499 0.66913022676146571843 -3.2938107819235269424 0.25591659249167164614 3.4779175047141142052 0.80237519155420544692 -2.4862457070724266472 6.5613172457510264834;9.3751201911665216215 -7.1251785526643436341 10.111498980931642677 -8.1846383274640075456 1.9160388238128411853 -3.217771693845884684 1.5184777599159557937 -2.3088891374942086543 -4.5072750930106852962 0.90959378957297631896 -2.796508295403651978 1.0365056548918545332 -8.2354487694643001561 0.25848993016106353027 -4.2240880504944735563 0.29479733136539976179 2.4796933507043630307 0.70412751816698271323 -4.1669822334340134162 7.4465387906501074866];

% Layer 2
b2 = 0.56792623547007259344;
LW2_1 = [-14.507883304237589428 -8.5557126707405011246 -16.786997370777580585 3.7970402773197244883 -10.716872884584704551 -3.7803606352140302072 -32.590642761159969609 8.2549935410382566658 -24.194871892869041829 13.462489947139133051];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
