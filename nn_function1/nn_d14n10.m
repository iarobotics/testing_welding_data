function [y1,xf1] = nn_d14n10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 01-May-2019 18:48:14.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x14 matrix, initial 14 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x14 matrix, final 14 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.9385527135798632514;10.265735287257260921;6.7307850350749651724;-12.52902688855726332;-4.4290157045390392554;12.14980836771501771;5.0752938081534830772;13.945211216201604643;-9.2706397494511776358;4.0116010347621218202];
IW1_1 = [-7.0481828512576951695 7.945665329383965414 -0.016622579429994011058 -2.8546295955201230754 2.8490808426414111487 -3.1713169989819767203 -1.2767829103851087158 -0.56612793974750053039 -1.1883903209646857757 0.041270348309539184317 -0.66577440081540351091 0.84377921940365296916 0.23034900681758493923 1.9486750308396993958 0.23787019557440658435 0.006229706570760093487 1.4312002047038689945 -0.077161093796269425438 2.4467225097509239795 -0.56641712505889629803 0.93701552229324591714 0.30402050172428840558 0.14439902067145793385 0.80548292645811536694 1.3006655222624883272 -0.13155586374661387694 -0.5911165490097627373 -0.99152905364940358002;9.8617642187185055036 -8.7037502315188461921 3.5723326255584626487 -3.8836189057620442711 4.188875704072018813 -4.4107807638746328038 3.8793412891712577562 -4.3281035385480457478 2.5942147698453572602 -3.2362267431606266399 0.72985274961266854987 -0.99900028607802437985 -0.91674748156615848416 1.3159341153903576505 -1.5107242031091072665 2.1556958740084697368 -3.7325013956497397061 3.2502836121235798572 -3.0972103703680011755 4.8167376302931570464 -3.8387831476562022104 4.3828903040261426582 -4.619478278026745599 5.612817771969575098 -6.2423192576270851717 6.4667837625492348153 -5.5976891573685865211 7.621461588857755487;6.4578840769583143455 2.1467028770826046546 -6.7757751177848213331 6.5126901856904026999 -1.7367799686221787603 0.60567647115781553246 0.6925819382227620391 -1.1961425295217842368 3.059275869549840543 -0.83537537225273927888 -0.45224692077526978951 -2.3837029177361954702 -0.83787427998894159487 -0.38308679834798509134 -1.0651706842474324421 0.51887462681919083174 -2.2940930886698898128 0.38786336504695861915 0.39475478397876756498 0.86476775489750046244 -1.0821177939084800634 0.15448745751449349806 0.55444464943211513308 0.067182768024637448678 0.30687048698868724106 -0.18221288483806558078 1.6115948228120917651 0.13579861872352205765;-11.586312420479078611 12.881288164568577059 -4.7092730829924596136 4.8244245833204777441 -4.3630884467972590457 4.7574225104757985605 -3.7054263933660340768 4.927606082140166599 -2.5967348794795066524 3.7429834252773566128 -1.5158268382441650868 1.0287738302328837126 1.0712374773517356896 -1.5725894138271891975 1.0887953296249825996 -2.9309056381687148551 3.0500807927204545145 -3.7258819955235700228 4.1231953971330952413 -5.5749922811794663247 4.1021827596801268001 -5.5916844863085293227 7.113588129303796137 -7.0721191690066200763 7.7717941672938151143 -8.4713277179018877661 5.7481384035281983813 -9.0694073727021891074;9.8408464904259389527 -9.1545331026592720036 1.9168373655861015159 1.8903850397730772581 -2.8324822854589686294 2.6525600504374096111 0.030586503669764338736 0.53919199007369900123 0.80728741046928287339 0.38039247069839060567 0.57450330138675453906 -0.57466093654103667099 -3.1533529683213501471 -0.57924503127651139067 -1.4349085963710668246 0.35360309568920100798 -0.50938703522579065197 -0.12393895717486158592 -1.6693502503566051143 0.15012978655022407581 -0.048025399471013689723 -0.22126728820680457988 -0.35192561128447125141 -1.0818644010558693402 -1.4571273096726993224 0.087942536964521478282 -0.082750856063462469026 1.3288088732793139624;-26.000626058659356943 18.500565682686303859 -16.704349181678743719 14.10685265041859715 -13.016629659951373554 11.56288698367131218 -7.5876107296242158995 3.8967579991493583869 -2.3544216803771109703 2.9784187906583534655 1.8345376056934568076 0.40646435471217723379 5.6335716496190881841 -2.5299167424338575572 5.1705266378378027525 -0.21774626103226732421 6.3943520550263102109 -1.4891056380245688562 6.3875161907057789179 -4.7275121627810570146 5.42393300128073097 -3.8015334214460012596 6.8283791324902889386 -4.5312028846461798182 13.893706464902066955 -8.079584623339377103 13.434504399887151394 -13.412300985081881066;-14.465863693797572864 8.7301169222942824888 0.7501310667162930379 -1.7804093298368779408 2.0109113693685514157 -1.5782113492382527919 0.17726530044938929032 -0.90183876826845721375 -0.65277676640618997883 -0.095606003870857408922 -0.045172276270388667108 0.48446039362420068031 3.8701347676145427812 0.26363843237380468754 0.88821433987402709231 0.25497759245415102525 -0.21330256288824156474 -0.074113406288566566205 1.4525448091874013645 -0.18844477870617573623 0.48594103411378969382 0.61327292294086277469 0.32777033755826850969 1.4543012672799393581 3.4423677529432845645 -0.44776346776313175058 0.034858012943641811243 -1.2865516299524166755;-30.722623340346164156 20.890612285404927206 -19.818615970492590606 15.864146987080156137 -14.590973533715740018 13.396285770267031268 -9.1952477119800004601 5.2301986611288269202 -2.1416881904523075164 3.6776844511131834281 3.1836767733301707395 1.2415154276062265737 8.6390236179614063872 -1.9388916791389563254 7.4674894233139967881 -0.51513496210834219813 8.3865365919691825525 -2.1147099677197118694 8.1614653200803086719 -5.8752066504275690662 5.2948481942317666693 -5.4033328363746297995 6.6430136619226942685 -5.2850958568786294833 15.342733438368087562 -9.6242921601909223739 12.086086160011616286 -14.767504395922060212;-7.7470969292381743898 6.2021395772588272521 -4.1182943601516353027 3.4791135018772529897 -4.4519759429214804669 4.1862890341068350608 -4.0331088073267080674 4.2061640505940207646 -3.1094533570124380795 3.0898465221768272038 -0.41367491758536611979 0.82365839802809015513 0.4735253705269377722 -1.1541149615280366092 1.9924788586804178525 -1.8210894791435996432 4.3435693176856027264 -2.9766555415497100157 2.6870439258331493271 -4.3791632800702569028 3.9294993493859515787 -3.7220195829340516624 3.4972397028754662607 -5.0008272971493621384 5.4819864031678191552 -5.43112775393369418 5.9310607524502456656 -7.0352961064857488793;-7.7878350310751098817 5.5002344971339045543 1.4487493930335531012 -1.2154464375702367374 1.1124664127989063456 -1.32351204043924775 -0.68942484887737343069 -0.85043293997428448527 -0.45819024902610594463 0.18850479798213409799 -0.21946490469447951788 0.17223618409819452246 0.51209020502796920304 1.3085330358453026722 -0.5305316165510625126 0.71090046894111647013 0.10719667027720729269 -0.25757727347409775653 1.6815395481634050068 -0.37044542698742816134 1.1113994940590048444 0.58643902682599091669 0.14212102555453365316 0.8962266386030783849 2.6218838864707318947 -0.4961951245476074468 -0.33643050119514217311 -0.58512887531577084665];

% Layer 2
b2 = -6.6449201685553038743;
LW2_1 = [10.738714510559749016 15.380445243557085533 5.6607669028858893512 6.7437009060458885656 10.678302641488956581 -4.4685459755158083439 10.346731360303181191 4.5186967917181997123 8.6390621749722136258 -10.482208188010885053];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+13,15)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12 13 14]-1,15)+1),28,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 14);
xits = finalxts(finalxts<=14);
xts = finalxts(finalxts>14)-14;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
