function [y1,xf1] = nn_d12n10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 01-May-2019 18:17:19.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x12 matrix, initial 12 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x12 matrix, final 12 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [-11.418154175147813945;-0.58752932110335343019;0.57307509848503546124;10.630266004176002426;-11.538316051924809358;-1.562884901980880592;1.5055334784878355858;6.5294906524362872347;10.938846415325269135;-64.333909516805647399];
IW1_1 = [5.4040405585057502691 -4.9853317697092531802 -2.7752465423340995088 -0.078391830953063845744 -3.2327932412372080151 0.64158193214768743928 0.58824746692868168374 -0.42378251919586307217 -2.694735782415394354 -0.42095844057328396515 -1.0189749601991384687 -3.1928335029288201774 -2.7639678567959529154 -0.24180202556354332688 2.5793196474257755746 0.93547174145245037824 0.97328988088672430123 1.9382753095576592539 -2.53870959796364426 -0.79858894293866256042 2.7139929680809524726 -2.8776581564168557392 7.2711296484746492652 -3.1343325914397537346;-20.856860779567508501 13.261304355317951931 -14.736862397752686249 8.7085437529497013998 -14.303574268080744503 9.2196872050320699543 -3.3053478309996249251 5.5073820047597283889 -2.4012374199079391524 2.878891083132759654 -0.86611659049981848391 1.3996920980886284891 17.257764924779088744 -3.8417955330296735816 10.699388336077559458 -4.2773423398365384429 9.3168989924906835398 -4.2977196354846851634 4.0818219524310652702 -8.3276761937526018187 6.3809389725892859957 -7.8829037928334413365 11.811205378622895878 -13.645586009770120484;21.281390238644107171 -13.443408670757609258 14.474002068992689374 -8.6607984040860532815 14.303858154596721164 -9.2240190896662355158 3.1429882667182518219 -5.5090165751279949191 2.3640007264781774943 -2.8700867549310205007 0.67674386147565135374 -1.4544344382953340311 -17.319856389891445048 3.8493804946618306317 -10.624839497355880624 4.3243166937227721647 -9.3649910725402634171 4.3496872074760863924 -3.9615116925695001981 8.3844308416519641725 -6.4070032860080594617 7.8309552171274576793 -11.601616990673189633 13.613799436902318973;-20.543951453277998098 14.162238487870277837 -15.282275409647805731 4.310343773299130099 4.0209962286978448986 -6.2354866513883839829 1.5123288878432639137 -6.1049269303964779354 5.3122922932529030859 -0.90561230674695591958 -5.1685162298775546574 4.5619139640804995395 13.033635444080793775 5.6356365262502992053 1.3738964912958329112 2.2574674843223423437 -1.9663150710836425628 -2.1052384597048590109 11.879876808550941192 -1.1199216435677381565 -0.29714590260546430711 0.19501498146268375633 2.4392352362752744988 -1.4335901511189077517;18.609336584390927527 -15.439498590158969193 19.542625447640787684 -5.5008285193523862588 -4.7542317341633983929 7.3943701763870972599 -2.1423809860395168769 6.666788994366179999 -6.2387286962689652015 1.0560463690458081754 6.573333809629093416 -4.1514024273220799799 -12.961216498910255623 -6.4934628116385191277 -1.7217354749830273697 -2.6341936344175702622 2.4233575013046722013 2.3891586454787714366 -13.081332287873520315 0.87672494620705421209 0.80154577257565085002 0.27238220807283580749 -3.2029214804291532559 1.1367561998722743866;-38.772541850671956354 18.385728223355290112 -12.351718458015733759 10.200182730220056726 -16.415627009481173815 14.912495629567702693 -8.4574728083780250643 5.965071353845131874 3.2612603291000930028 4.7183241605950598796 11.754800075631438361 5.9832678063194961737 27.273070338520380318 -7.0542856882853284262 16.127696022359476302 -9.0515757463302097818 9.9413567387248935603 -8.2806696345758297184 9.218891082525395575 -12.753580307751338552 3.3775167803363439489 -7.8889657733797999839 -3.9678313212258498055 -16.547817933627630538;38.75429401059653145 -18.447934668455570062 11.9131685274113579 -10.040478612743978459 16.344983761620923701 -14.704863624805810218 8.0127945723355065155 -5.9238706345829195143 -3.0540255065591086492 -4.629815020368746481 -11.536290444819560008 -5.8885275498798437255 -26.978172386162334817 6.9315440296263552966 -15.720342685558700069 8.9110050819416528611 -9.9819082600943733752 8.196082162971672247 -8.8253126418615988058 12.66457095307245595 -3.5871622654841166522 7.7791844969468879611 3.6517047435251530629 16.399963640788289609;-24.974397223376723076 10.203536671519099599 11.981254133852635491 4.4281763805417462265 1.1764541944709918653 -1.5108433072318097068 3.0451424707785172963 -2.483893145781518097 2.3686876826904876836 -2.8835471735452471442 -0.020206551254317826893 1.4407648158052577259 10.906205256707456996 0.72491669088098131812 -6.3222777041743354332 1.6324321140284145937 -2.6705281891041239284 -0.26909824568194778971 -0.69348089577069793599 -3.1392716551586636875 2.2313509513911395921 2.5858861409809130727 -0.64729868390733791284 -0.31147329978506527182;-3.8054182321705734005 4.3498181515471801006 2.0387418503182814788 0.38514814614110165492 2.5380411197744376928 -0.22389168328974878852 -0.77576093581386151854 0.99772131442925793277 2.1457257103991311808 0.53440735961692109601 0.91502898851159653049 2.6518490357566317783 2.3253430297944901461 0.049694240429444147544 -2.1307901385243779302 -1.023252244456644755 -0.56710313611365525954 -1.8442512641431374476 2.1559880307697296686 0.77057059658963023008 -2.4645072953207645128 2.4170108306677997589 -6.5482256703137524667 2.9367697164988948444;10.315970338561069042 -14.367275964760009899 12.726375415563566662 -13.625139387958418169 5.7711931589062510639 -5.335856915418136559 -0.76181056997873386472 -4.8735774217353204918 -1.732017005045168867 0.40452735549156476624 -1.5663898690742370512 -1.2425031363653058492 -2.8839531282546722046 2.7014909133900082416 3.7080058340223196467 -4.1671468266713027617 -0.12720890522765171404 1.6508233478641494152 4.6728026452074811203 4.461515169898230937 7.5362748930312442042 1.6440327903280109734 11.248217970682926392 3.2649806786531390124];

% Layer 2
b2 = -0.72216616599145899702;
LW2_1 = [12.920921598984874024 -13.614988541574708947 -13.963004946413219542 10.942898525185205116 9.7393770676787756457 12.309094617203532707 12.647735557925615879 -1.1745975612693171364 13.959251293060475518 1.3398503261317487034];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+11,13)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12]-1,13)+1),24,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 12);
xits = finalxts(finalxts<=12);
xts = finalxts(finalxts>12)-12;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
