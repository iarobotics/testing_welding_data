function [y1,xf1] = nn_d10_n8(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 01-May-2019 22:51:35.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [9.9118530020188622132;9.9468508767988303987;14.477973909494258109;-9.4568153483070780396;5.9502667747103723528;19.049772105035277292;-14.387281932705707987;-4.3377595754825497565];
IW1_1 = [11.930234853552214247 -0.82372865051125943037 1.2608175710395062019 -3.4232510098139532495 9.835696635372794816 -7.9476251678724789684 7.4567926646910267507 -4.1554391449149674642 -2.7909642858337546656 -0.14885788706955510596 -6.074541061737641634 3.3463914950411930427 -7.0824921792357633521 4.5458595789941087517 -8.4610024094747249279 4.5565539594359742992 -8.0172331134871512859 3.1577556463792291197 -3.2611773496832601182 11.375788063099788516;12.757450887428328556 -0.87754146293120993683 0.72518675400789456287 -3.2790494316919405193 9.8306391774900774294 -8.078507619608785717 7.6398075614219438378 -4.1335495143155496223 -2.729604624857550732 -0.1653404946837493672 -6.2959405956375498192 3.2312894093333404122 -7.3539456822488293852 4.5348069810512390276 -8.3387242103212990685 4.6660028574601790652 -8.0417193787047658304 3.1696606334480810219 -3.3381340809273822856 11.389287090325616703;-42.878852887096492452 19.099914522785667259 -19.059967223648026646 11.998186593548021861 -14.257348056236329725 10.688731506499287605 -9.4165533134726064901 4.3904356874547945111 4.6947795058472552299 1.3764847540505338319 9.1443671114312472525 2.0179260182634575216 24.443182195732134687 -5.7959255283234991651 18.24238274940924498 -7.1697249345377525032 13.726059968777308384 -6.5341243439022926864 13.725628500554300615 -14.927058977247828153;-12.089407380145168247 -10.45287987744640823 20.265922518059923618 -18.459429451604876249 11.230408876674754737 7.1724178053645593067 -3.903044591643810346 14.839519879161562343 -10.785211906008452587 5.1960197952206197414 15.751768329671243407 -2.4050065978042463044 -11.87305312963639814 -1.7611823319424628753 6.5475584728533977596 -3.9532467417466277126 13.488914785475499158 -4.4461857110425544448 -17.436815478852000894 3.35781099702590069;-26.085617781039264429 12.438813456516285783 24.960397988695685711 6.9039862201169786005 -15.04330954184877811 -0.64539328497817083363 4.3821747583500512135 -2.357669870816718749 5.1499169460414968569 2.5823169630390432339 -3.3891851377603470219 -1.9054887372052298211 7.1567567886695027113 -5.3428590565248992306 -4.966103835016092205 1.3214314500264323637 2.4349035506749108215 -5.2141236341940508936 1.7408100097822736263 2.6311870408967110713;-106.51380841487427631 33.80010469860015121 50.50534209569241284 -28.244382305522108823 -8.7160851109364259059 -1.1042341809882583181 -2.0060828012060007985 -3.6735238312401619076 -3.1725802061249575026 7.5184616442720111351 20.128232703260497516 16.418359213603903157 13.514028580746598962 1.907182287039776547 0.59955785757780322154 -0.18783357094431918366 26.114806652424768174 4.0835706860565936793 7.3349646794885234868 -10.68025601468822039;41.880568477815650397 -18.942699356729548299 19.873571197812960776 -12.298402111492650945 13.264580770691459577 -10.566492585015078376 8.9222833668465550971 -4.5477096521346176417 -4.6538252178178112217 -1.1689740451178252112 -9.0885350953864119106 -1.8550329143626975714 -24.462985736081915178 5.8387116093240374326 -17.927856171230370563 7.1621635264059078096 -12.931585991764523058 6.7824605281319616523 -13.130022253045005698 14.432921096528188443;-25.307299774639673728 -3.7407943212323981896 35.121878315826748462 9.6729707814385541553 -6.5762908364362822056 -13.126288755873698477 3.9475358590143332371 -14.411576343854532567 -4.3964594190678090158 11.870074335120177622 -4.122335968805996842 10.654313364833354782 1.7430374614664223554 1.1674687046201188689 5.8382116068653182595 -4.4211502123398291886 -9.9926225124526144583 -6.5443829069063701454 1.3853078405698164843 14.833092460453428885];

% Layer 2
b2 = -0.80112224592205860674;
LW2_1 = [-15.937914217716388166 15.932606408245943541 -12.032979090526529475 -0.20955980758624684346 -0.76448597286041819476 0.32977736755711739569 -12.47591524862521517 0.41201029168565966865];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
