function [y1,xf1] = nn_d10_n8_cvs(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 05-May-2019 23:02:13.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52;0];
x1_step1.gain = [0.000550206327372765;0.0045662100456621;2];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.66604739880771557381;-18.172387415968589863;8.7457192588415360035;-6.1652383285514318345;-1.5283463223456137392;18.401285571043871414;-1.4654059201519926692;-1.7268890123072373477];
IW1_1 = [5.9241141629298263993 -5.183463244512023671 -3.4577991096353186684 0.95880663981103775306 -0.12221351375474806544 0.001859916898676245052 -0.025837223990638390203 0.28418338153539057789 -0.54017612435458806086 -2.9251321649870827279 0.10478316998537340332 -0.15409694357535963505 -1.4483099607297114098 -0.31050423635602902861 -3.5331227066973962536 -1.4058857963762663168 -1.7614067559805215435 2.9379106899445419643 0.90181558813013995568 -2.5702930449011085479 0.43094870429595177885 0.38258592258903739713 0.4309777899475965568 -0.51549578105265492223 -1.2067754435434985272 2.0836362882038179656 -0.64727911513274549726 -0.79608520841795393785 0.11152412237167295961 -0.22500888513699168758;-20.36336716769374533 19.272380431061439054 7.6477668821739364091 -17.117378555244716409 10.687058271153189182 4.5241783828396560097 -13.088276473846416792 10.052854447776477187 5.7537645872847971162 -5.6062443852898935504 5.2402130867247924684 4.7982461335813288983 3.790868235505207906 1.5272482631899146899 2.3263212328523770189 5.1746048419787031847 0.42627579545591853805 1.5803362117611208237 12.278340008722453902 -4.3699729409125369628 -1.9468238522760847875 11.84249043163603865 -7.4243604695669551674 0.79836558207092733763 11.173934249579708933 -8.8739544710997826371 -0.28088401807288898571 13.506773889249487297 -16.397053246798900972 0.60893280604649768772;5.6574840655363374253 -7.1491524342161820726 -0.32284181483338936225 3.6049746550493444452 -1.0738387404270124392 3.2478583317936480235 0.37089914391489264833 -0.084252186348689583895 -1.7495840024377287136 -1.4258144714755744964 0.81509959911849649838 -2.0332204941945382082 -0.99252943114476666064 -1.2717579813828123747 -9.611031742283151047 -0.71577715486992465888 -0.43965962196919816662 -3.4800528807527824071 -0.69295301437219614105 -0.15015834754467952128 -4.5110711238764551467 -0.61311332322739320322 2.7717254666829980181 0.017442736392796649725 0.82614846979033562668 1.7831148524489135454 0.46959773847336278019 1.8082987228651810074 0.25122293092857606034 -1.934464330956094269;-4.8703074277405082881 1.0226039362668903898 -0.77425419571706743938 0.56670588573801239374 0.79493242081708326285 -1.5145013415350208064 0.30680611217528452883 1.0904126028615834798 0.17665286972483223993 -0.4915370298809543792 0.55535468945201682534 1.5366771465830515453 0.86619417836838796809 -0.74714439833409840297 4.3216593431950744986 1.4734686777380097134 -0.37192774385408777782 2.337729955687216421 3.0073958520111876425 -1.423306567893543928 3.122277742474615092 -0.18768441795866661059 0.36332740448211031659 -0.12874158074215982794 -0.12197404367384596935 0.16407382824355265516 -0.60767258669988100106 -1.7325268319614908208 -0.11432323302075277083 -0.025405791849978820451;-5.0726123105910012612 1.9946423459704036851 -1.697798768837796235 1.7963665848993568552 -1.2011385110435550683 0.006682558873270742078 0.80967561842564939045 -0.17066478998885009633 0.0039309857000912268657 0.27025175022607450526 -0.17419750331282399247 0.0054040988657870284162 0.13818553666799779367 0.13388013435646148319 -0.67430750190664423549 0.23294671253269280675 0.75384826192584220017 0.63962258628364498936 1.0499223111233069172 -0.07655563009438876021 -0.09969681295365441509 0.35527466191787548944 0.14384726531649796866 0.017261508733388490622 -0.035221357809628706104 -0.44081383631706777537 -4.5747077754624356771 0.16929672799147563178 0.11779803393805537981 0.025399232732054802947;20.315091237155552761 -16.957214229146579498 -7.3269544677944971056 17.030004123400964033 -10.043691956970819845 -4.253625909091296009 12.85077158860661406 -9.5678405160282764541 -5.605205973893495397 7.3038268006241624519 -5.3828454099684321932 -3.9893539070698680327 -3.1371615289864247522 -1.983262534540211508 -3.2766535604157089878 -4.6411807832393066064 -0.95788600782266852818 -0.70736113867409544653 -12.396187988093108956 4.516398591555451425 1.482880726925707382 -12.948006974421021553 7.5988978412420316033 -0.19171075249820210273 -11.886914301628559443 8.548188166542955102 0.37080916866231905527 -14.299399156008615108 16.247375135502355903 -0.99551873203242136068;-6.7696044580531475887 4.7636887739767015404 -2.4523532531497145293 3.4491858803422594804 -2.0250051541351568041 0.37005866694968669872 1.5142475013972500619 -1.1464756599652741187 0.25888241701644210124 0.71570542184628793692 -0.61617867977533702373 0.094180505299328975966 -0.83615088451416175186 0.9269272612690747648 -0.12094112545302669603 -0.046665918280233767423 0.24597500332231073128 -0.15580951629984540752 1.3571559427847557089 -0.40581782816959871552 0.097156089803921416581 -0.3724735928981021682 0.49993879417996162084 0.070143673187244529044 -0.11670631389512947651 -1.3034592591060176758 -3.201117708503151249 0.4407035798329415055 1.4192339026305842431 0.046955858912507905667;-10.470538108335414762 7.2092667078861509822 7.7334708372589524572 3.5998820007089409323 0.2792423981482926032 0.54193314584994056737 1.6183076804412639405 1.2323619893294692762 0.11165895946108919667 0.17973585203577122082 0.57928182433678354624 0.18455634387397085172 2.469510849919688944 0.1591385057256267388 1.3354121021397311608 0.68649534119448563096 1.2275214570445767137 -0.83282791493007068961 1.3848551969649389726 -0.21174319100120797543 0.24833566620518124357 -2.0195421743337780285 -1.5927650752627564579 0.24296144855271159524 0.94407723482682470717 -2.8518155496977466434 -3.6877364988987344496 0.41252942218777910455 0.54408183422070954816 0.15122586810250898681];

% Layer 2
b2 = -0.52358987993654937387;
LW2_1 = [-1.9180846119664334282 -6.8030705250092822212 4.2786744581387026187 4.6322867320236973399 3.3450985697191057966 -7.3240977954019808038 -3.3571556377147504513 -2.3162987095424640849];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(3,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),30,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
