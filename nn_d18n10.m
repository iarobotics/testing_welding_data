function [y1,xf1] = nn_d18n10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 01-May-2019 23:19:24.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x18 matrix, initial 18 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x18 matrix, final 18 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.6516010399776916984;16.138182770212790018;-1.7465206153019330326;4.8331778830567833083;3.2657515010176352277;2.1512623061480100617;2.3697405880035704584;11.725698479386137407;3.414864164762941634;1.7455873871409246512];
IW1_1 = [-12.773701111608728453 8.7071174619082682966 -2.2700379354876005777 -1.5277348879643875001 3.0714472096977036841 -0.32699870033331407404 2.354298173246287984 -0.915903627731832648 2.5550991592108220907 0.096725918579132513786 -1.2567359236977191372 0.18850080077726666383 3.9385059537777391547 -0.089923508732947271538 0.92062835655078811836 1.2645789127284583486 -0.91446640594744965647 -0.19590710687849793858 2.2364238170771404413 -0.72593101864808495804 -0.56463597299295731347 0.42207633377303815925 0.41587008576333900356 0.33717448841946112692 6.6628220023005466643 -3.0004030688341458699 0.17694173857099448899 -1.25959307569975687 -0.57606785792069525876 1.3243906855096860831 -3.3121227007377598284 -0.57509007201342732252 -1.4704017022442537055 0.77763708132729281175 -0.46884232869108594111 -0.38462179239313831758;48.964289514931131464 -31.987462852530086366 61.976680059315910398 -40.726284869855476245 55.7302517270285378 -39.452581641786387934 37.989741621377248748 -33.764610831012802805 18.425350852290591774 -24.564295145840951307 -2.5036594679544128539 -17.034155529465881074 -24.755172967302058851 -10.164190052634497263 -22.791654344809519017 -6.5650435456033404691 -12.917296328524017213 -4.5135187605446951409 -21.423580384226713846 1.6856957857572312243 -20.149941440173151364 5.4826452192192656199 -11.506898940322406233 13.713024609499706585 -44.782008292902325763 23.811878957870785456 -26.317927772987694368 37.657605876397227007 -23.016025967083301396 35.454422154970117731 -19.834837016164954093 32.245895675591654594 -2.017674775746632676 29.435636635186551047 4.0342978619646148175 49.441273385585326139;-8.934516523387799225 -1.1294458256064892065 13.439163707553278826 -6.3017311707216636663 0.18405417849678665232 3.3992948408131820059 -6.4202841594280171122 1.2581698753408707692 0.043931034952999353793 0.085057857600928626907 0.19466599574259776939 -0.17794998938030659463 1.3282701921348394336 0.34624096795840630936 -4.5091431129873873473 -1.2127717496339052161 4.8966125908274973355 0.05748886638087735701 -1.5137407989000590813 -0.53673893736127664678 -1.3130574151084843937 -0.14443352773289175328 -2.3037677151491342542 0.8138696437476991008 -1.1039356591248350448 1.2688421898207662419 -0.81742875838313777681 3.6041772595021535075 -1.6399434574702620449 -0.8778027924434592677 3.5271791108865948594 -1.0584225854825279889 3.2700755379718180471 0.0005103843453264714225 4.0876057025513921062 0.851779507629761512;30.014731381307264257 -20.744406460169248163 19.002800477714185234 -7.6290409412620787677 8.1137225372806103252 -15.337081077737163781 11.969893278901375666 -12.251463760796870162 1.1306207282280167359 -9.9690467982346309128 0.14178970559147979769 -10.834374624359227823 -17.315735163300391974 -2.7525524977800821524 -4.8775632804781112739 -0.35441186685210673835 -4.7427256465977229993 -2.4135551474594785226 -11.533130358996912079 5.1478249553743777867 4.9763734342308358904 -0.78570149141918776969 -13.065630591278825534 0.42182961324888784693 -17.543142574247340804 11.873807781695843389 -6.6638549419218993108 17.123308193968622248 -5.2938792601953688077 11.00090522629623635 -4.1888024109683748009 10.697681740964176456 -1.0935099407189019516 12.316869167957586129 10.095771255639933273 17.488341801964487843;-12.602391899619945548 7.6717960892336050094 -0.038534335489414761611 -1.5346498721065076065 2.1615992605135110338 0.062613051144952011628 1.836120816128204325 -0.66287002967155572719 2.3003848192066569389 0.16815587633709466742 -0.95349829593484580759 -0.043281385981114764427 3.6986388710094360022 -0.16605818753558165835 1.0656928691013389798 1.4017007426871035403 -0.66802554020464088858 -0.26131804436982913886 1.6350547499761014514 -0.67198560324732681259 -0.063805355197726204564 0.3492070636888465196 0.15107998635294697665 0.67318005663591717891 5.9991878432268705978 -2.6746176513938753061 -1.2910133558111727137 -0.96038714896427312961 0.2395557468949070512 1.1780951856398627076 -2.8041212728675874999 -0.84426621058328954472 -1.6471757775703401716 0.65908191338548172133 -0.1672272182329371526 -0.069329579300775934225;3.6591074558611489387 2.7811936853179148876 -9.8179193480053328358 4.1903420337881600588 1.8633689569239519912 -3.4224341467805836636 6.3187428691361366973 -0.10662072968837520148 0.1468887989622927881 -0.044789320099230339745 1.0113238188711444199 0.92497935774160122691 -0.48844716309861313519 -0.019437302253716415984 5.8618006732893812583 0.72909105444782484895 -5.657043471316590022 -0.48452183394332909439 1.5150832983474438187 -0.11438848191211686833 0.4160333975354582603 -0.062054888260171497949 1.8762896283642553907 0.89802453013825533912 0.48002465280215295129 -1.4387552754884755934 -1.8213704511472412761 -3.4330682261817049294 2.62272225767495204 0.29842603470696121848 -3.135224632994748184 0.10419423817175260671 -3.6966279821299510289 0.77013988470163063926 -4.2100619368569036638 -0.43744795140501135933;2.1728231543234692857 3.1302607220218421347 -8.4024689981430054075 4.0215084793163251575 2.0526680546726545629 -3.4751408664527279058 6.5582683085270652157 -0.068549599450820036806 0.35076816351460216037 0.053887712631920416106 1.2873716651984605797 1.3188462162203633543 -0.77901347631998929533 -0.2036650294028981012 7.1195993886994797251 0.97778144537192535068 -6.1419288788525365774 -0.64203261238765951813 1.7610427470561749175 -0.25569773829197889325 0.52616964864058890505 0.18600783685071353712 1.7791466660939465605 1.310052923183827378 1.1042847685350667408 -2.0156953566874404871 -3.3511875999260585246 -3.4544336583661867657 3.1373680620052581958 0.058009721787132581539 -3.9162994532550854387 -0.090068088136506935237 -4.088548411828769602 0.96859629989193851696 -4.5785545052899996321 -0.26013863943570270099;-31.889473104870440068 3.8717595770503550057 19.087680566561513018 2.3893153578911894286 0.99852942288052060071 -0.0033087363576433381773 0.43630749917967009965 -4.2175329038355338085 -0.27005704273071107213 -0.77690321319955435442 -0.11771448544212455289 5.30688370129293574 -7.7389496738066414494 -1.0937862816586056969 22.818385769701563959 1.2665590547485277018 -7.6307288215929993669 0.33069835597445867981 7.8744700083855398987 -3.0548754054179871886 2.8940520579457471584 1.1291798657052547483 1.2208870039210193426 7.8010850468826751225 17.403413460066840202 -7.0414967399433541217 -31.938950737794488788 9.080037423506071903 6.2956242451616786227 0.79487135875717451761 -5.2181845333433756196 -8.2929532022808292169 0.4372355389091844291 0.37107243386530669449 8.0563945715394886804 4.4982539062637458827;-12.46197431757780727 8.0103315026735746329 -1.224192685142642345 -1.4240904534750722377 2.573275532650080244 -0.16343846339688661295 2.0818928233263180871 -0.81903661168045560625 2.3873683928331526083 0.10857115597274066832 -1.0715408072570795639 0.14145553464304300162 3.644164206098923664 -0.15131415569729436688 1.0423473900714919083 1.2744992504798489108 -0.82283042996545052716 -0.19444395295888816655 1.969247865012998977 -0.67307656247168257124 -0.33938215383292541505 0.38745498245915765967 0.32512469437531654748 0.46845155869617927102 6.3061634439308322797 -2.8394619337536477488 -0.49487795378734056317 -1.050220523190260602 -0.21218737110336546858 1.2225249434960880901 -3.0939792777929797651 -0.6758706270699622598 -1.4829315767961723793 0.69257028873251325063 -0.29545547042238479163 -0.22811040213283714784;10.936917198856891176 0.49182269554688140545 -14.44743151430007444 7.5812395136878532043 -1.2674399911596787582 -3.7195270366421695485 6.9565598008120774765 -2.0336334506003814759 -0.083273599871096046221 0.13473760395327438744 -0.8414188778979637684 0.18600063088994547855 -2.1110514923465335535 -0.73164353534786163991 4.9139093348662425953 1.7658857764850151018 -4.9485934658835342148 0.0088661135614044109254 1.8503729891966675947 0.84508443011507705656 2.0882491669150744507 0.51708388901353630196 2.4203999422670809949 -1.5007604799893246028 2.0148332458417068658 -1.5463813786978981568 0.89120583752676574285 -3.866084134180199694 1.597486023240542341 0.9267668731152297612 -4.5259982763921433602 1.4905717902590549517 -3.4312938959551786411 -0.2687828628419909327 -4.4210287936891647931 -0.91733547702169626614];

% Layer 2
b2 = -0.99806840488198889094;
LW2_1 = [-35.611729646143572836 -0.64836608079648028191 20.062859732319648032 0.63855209923879741041 -28.246299403736369271 24.149158655800672335 -16.294807846317866051 -0.39315871864726686935 64.029920961133129254 12.423136266202684297];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+17,19)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18]-1,19)+1),36,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 18);
xits = finalxts(finalxts<=18);
xts = finalxts(finalxts>18)-18;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
