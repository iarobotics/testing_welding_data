function [y1,xf1] = nn_d10_n16(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 02-May-2019 00:02:48.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [12.748930548707127386;12.436047730892378027;-44.604045735801619799;-9.3093440672814455894;-13.712039836331388898;-7.4976846034517956596;-6.1994191797996718307;3.4307136592625502303;-8.8406196030129997609;4.1277166783178715903;-3.4660148796103431579;6.2295411928362867116;4.5866089712479727325;4.386173596529887142;-13.158323382268163115;-8.2378653831781250005];
IW1_1 = [-6.5852586353111250972 10.59689776934288119 -50.624529031173111093 35.359577983380994226 1.2335801286028060808 1.8827511840345261263 -5.2166723939305565949 -6.7200802080975661212 10.525149289581630541 -0.41190495499544549363 1.951312395859390092 -1.247958069387690383 10.366322321988004518 0.080869288061866884121 12.771524448506729854 -2.2744659723016500408 4.4579209104690242782 -16.552840505455318265 19.346266182477542372 -5.7538476754423619752;-7.1687277471871597712 10.424525426423462804 -49.228904915940546516 34.001646818891501312 0.96555214087056384642 2.2564470421982218973 -5.3069884856565323616 -6.3689759474191767197 10.30420753438733783 -0.64829377133538312883 2.2717996577017034454 -0.92103393957534629433 10.236831085212203973 0.38339220586867728269 12.83175104800339561 -2.5371889368857356573 4.9106340044738328032 -16.385588696001455844 18.326594798664864072 -5.6865945135312800929;29.592229585196303532 -20.44870363924331258 20.298759036333620998 -6.1488851751997168904 12.034286833051012877 -1.8597873708654173441 6.3308970882761856913 3.2755850624328890497 -1.8182568326618222532 12.600809366569055925 -12.13195817753977046 2.233850302656323894 -10.702313565608692514 0.82253409195007265442 -5.3146084526224317557 -1.5474854337031511697 1.3048274771526182647 -0.53548372987012271551 0.82481002524494340111 -0.55052110526673447843;35.186875097034231885 -25.626773449069592203 24.775625439313291309 -19.114636595231139893 22.983858481593870238 -9.314007741336014945 6.9187765188209642275 -4.955849908505534529 -7.561882135536356131 -1.5667073710908809847 -2.9202911749980522416 0.14176133086070957789 -21.835435763037406076 6.6603652539834818924 -20.891850090752491553 13.973059683232158079 -16.038897474428846834 9.7455303179553585124 -21.517795794601788373 21.399012652123687417;3.2269988802396145644 -4.8698509219038754736 2.7708940533134387429 -0.86751249756601700458 -3.1423754170385285178 -2.0240396097634740791 -1.591716169597631847 -0.69245136825321818019 -2.8737545438310081458 -0.3994413095355027199 1.5811230140015051226 1.7128541970366588654 -6.9086806721070574966 2.0206376429090675551 -2.6160617072450196297 -3.670368103313698338 7.2867801788615302883 -2.4249532745093698161 8.5278473611816032474 -3.0795820621797171945;30.040766959201228303 -20.775779228402065257 18.770256256412782392 -13.881635288753283675 17.349437109191189421 -8.183890473260419185 4.6533312254955321308 -4.6973807569731924616 -5.9034337553363069873 -1.2154634286155237 -4.0763823422703131527 0.29650394030438104176 -17.375169995982403748 6.048202391224080543 -17.016304043487796349 10.777465980680785762 -12.531773152874029265 7.3905929725619268211 -14.43881934669238909 16.845910923649981328;17.340807702212593711 10.11628547928623334 -30.043026042444267887 25.936485098700774898 -1.6514469898767074607 16.254586513058043806 -6.1131839111528938346 1.6221577297536682316 17.578542933195290487 -9.922856297280056026 2.8897667922759597836 -13.156004740778978856 1.9638683468106898911 -15.414826142704724177 2.8620055246282376515 -2.5248408197687104426 -0.85774769575853271331 -7.7095331539475164817 -4.1461014264509117311 -12.828996359675954864;-34.72378948013523825 7.4283423417061786864 17.413256625758982921 -4.0766719341639339191 -11.080740046214389238 -0.36839130447106255284 -0.62182944905167703009 -0.43790963167887686502 4.1396704455158781499 6.0705991133504682011 -3.421049282567959704 0.1649293270116244936 28.304439168795095583 -9.4866413684799333339 -3.7949847660058977361 7.2513213499089195224 2.2566573275807542132 3.3692159686676950159 0.21258331518219633627 -6.9697224067423508842;49.974842253128940683 -16.086578207115501016 -19.167554990453783859 13.373286748389631384 -7.6658531538506107239 -3.3032482453545761736 4.2333677266762412827 1.9852351654155855343 -0.98641429587207041241 -0.83257997696257257658 -3.7428365677703236969 -4.8616955246773310151 -12.675730847086310149 -8.3281872363564435346 0.10202515933074531029 -2.8302247889235609968 5.7419647481261035793 5.1694862100797216442 -12.308803402677041205 3.6629132628182206055;-24.625106033337186062 20.456133186193230955 20.59322010641681544 -6.9992188351895254783 -27.724210633950992388 8.3177729944034659582 1.3749400648677658765 1.4408293377729810558 5.7313290570092672027 0.79748152169469221917 -0.69397963345903102006 2.3708879965082516605 12.683384913451813958 -6.1352260830301954542 0.33568993456248114038 -6.4903051387767876079 14.096287868903953466 -0.82560034192732689728 -2.1138264353337632429 -7.5934464542095811979;35.014496656105968952 -7.1774752207689695993 -17.591734983354815114 3.6117310983731734098 12.099125158457043838 0.59684219598173471333 1.0018220509431439158 0.54804810793612956932 -4.5289572808865949938 -6.6005806574963985511 4.2596084359859629487 0.23802999181123046801 -30.677037734643743505 9.960046243937224375 4.6009147270909229732 -7.9242095112772297227 -2.1017424771173214282 -3.4989732206528185721 -0.7891926588635698181 7.4154462375451126732;-14.575640192922788785 -9.7389325451776755926 26.988198928902750851 -25.175264434820011417 2.6730468167055732032 -16.812604422862950315 7.101656879485199525 -1.7013296680740133127 -17.886428559519025328 9.6670186913205782275 -3.3391059484035063853 12.704904517409692843 -2.2790183255472538093 16.34206595156074826 -2.7023260989729847026 1.8635442827576969016 -0.23408268704318688225 7.4771399111689298422 4.4096531988055049922 13.141668477544557803;-24.112693103751801971 13.299451881373132167 9.0133257776169752873 -7.2753569131287596505 4.0292345739609061184 2.9182754952203469045 0.44852935904861379601 -0.47449814322456801419 -0.15468314078609715634 0.40297939534949067664 3.2164635002142185627 -1.7061629971081708756 8.8308735988898785507 -0.78064649748854386679 -2.0437718122526513653 2.6983585987192530986 -1.5107261243960197206 0.2528721024174893639 -0.29336026207974696955 -1.8265102608809928864;6.7880908393723986549 24.731379910411838807 1.8222688981296444322 -2.7739731536564917747 -21.082806207375760721 8.4587097753260316324 -19.454416978682534278 4.2286530268445883252 6.2924911339387072928 -3.2669240189752537518 3.2250625883834493912 -9.2068678465492297391 13.716460467988094152 -6.4475855967958501935 1.8857485941828735498 -2.7890009971970304292 4.5830170330188142458 2.0106439993941029876 3.2129308004841763413 -9.7234082345147889725;5.2181349297936279186 -5.8163878914473432502 3.0017296891018721006 -0.94760430751500945856 -3.5372886867795036991 -2.0335082301511513414 -2.3081285575818957234 -0.51514219778338621314 -3.3932387708565645568 -0.19578245082655598708 1.048872495008314143 2.00075853146119087 -7.75778980015135744 2.5477181027865474228 -2.9609850852282133538 -3.6279202591908972231 7.6533420243369283398 -2.5324733148974747365 9.2713012601059094919 -2.625350502166162947;32.035661715193022303 -22.71707323137081147 21.494558454526831781 -16.197621402161509252 19.552892268751971727 -8.5657738121041564483 5.8818111789385421062 -4.7083573728977414774 -6.6016896298599077042 -1.3875158148297921379 -3.5187024144524343683 0.24064725442204640271 -19.303344268798230843 6.2930700877712606456 -18.514873946598260801 11.913548263263470162 -14.024143708027018818 8.4855145596723708934 -17.714931588837515619 18.788634435372731701];

% Layer 2
b2 = 0.085920568014791226519;
LW2_1 = [-10.822304262823637444 10.981697984904467802 1.2242301177055416872 -12.317851354950791531 -14.771782252617963849 -17.715416509891589669 5.9939939730721656375 9.5976155993648415432 -0.5843800593051907688 -0.91310437831684343468 8.5752998398572533034 5.9890149682982309898 -1.5963012224177453025 0.20820039486716118704 14.698819842762738119 29.42767847273545101];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
