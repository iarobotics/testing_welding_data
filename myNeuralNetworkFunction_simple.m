function [y1,xf1,xf2] = myNeuralNetworkFunction_simple(x1,x2,xi1,xi2)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 24-Mar-2019 22:19:45.
%
% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   x2 = 1xTS matrix, input #2
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
%   xi2 = 1x10 matrix, initial 10 delay states for input #2.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
%   xf2 = 1x10 matrix, final 10 delay states for input #2.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Input 2
x2_step1.xoffset = 0;
x2_step1.gain = 2;
x2_step1.ymin = -1;

% Layer 1
b1 = [-15.412482738621330114;-5.4072205478090085151;22.391746385615849846;-5.3119733780595357331;11.635792489012724005;68.482483791070009715;15.297095990069466964;1.3445282883035172272;-17.727517671629563267;-165.95148532643239037];
IW1_1 = [87.326656523452470537 -18.855420592628409082 -85.764126650023214893 -21.909817346361862178 18.733223836380616945 10.139969987409180874 -2.0023477438723098487 8.7432718699303819676 -26.511035741262094945 -1.9180125439580644198 10.553273108453995022 -0.0035373577225668493239 -21.706413724232643148 11.081669771349140774 10.84414320036851187 -17.335106741674206177 40.516816861365441582 11.011665558632337536 -26.618393914897509944 -3.0008701495977665452;40.78977216390131133 -17.559890276642427409 -32.939377640096310529 9.2753383531786113281 9.1986858975187555387 -11.364758079867819163 3.380536542940958622 14.943544492695686188 -20.059462118672293229 -3.2268429000535507889 3.2378497580783602849 -1.8809566688545664714 -1.8566151888433466421 3.8041265744460401876 -4.2763377268273039533 -10.915735496339847188 6.6074927019662856864 6.9064631030279368673 -2.5265298885650779859 1.6888835710601255435;-190.58938724002308618 16.933674812675004517 103.60858212506295217 57.464518939048041091 -198.08994436132914529 -142.65019327102584157 -76.173389535375363835 273.18649483789488386 285.47467597491493052 -104.43417205894856181 257.01826633503918629 97.729186092576654232 -267.68353440120426967 -285.11857762262042115 -133.31020848080211749 212.63143577215478786 398.75535388181032204 -63.423941943648436848 -196.38462525590000496 -32.326560096981957315;40.598417884410636702 -17.305270158794602509 -32.774236652394762359 9.1777831307826058804 8.9358341877345868198 -11.27207013204281516 3.4995161363660676201 14.872955362342050734 -19.857352126009953253 -3.305033195874456986 3.0507138989810229646 -1.933641711139321151 -1.8493364832924090724 3.8858113113077621392 -4.160326635750063673 -10.703734023861054325 6.554922599453085752 6.6805230163986983882 -2.465487787533143127 1.7224171417339226853;-0.82445698182373428065 7.8764559996773844119 -6.2535610694918641883 4.5395046802265950348 -1.3258167677952772401 -3.0880731685498248318 -9.2500848208643908777 -3.3792446697136657718 9.3808222423033083004 -8.7193250534974691135 -8.8396386821946251189 11.533595100458075677 -8.1573781279891885987 4.1995784238165914104 22.176138662142687252 3.3789646036993246092 -2.4034849037389398596 -3.6099469092332507891 3.2353852568848235904 -1.4561330963088916501;-89.3964038344120695 276.47569090223680632 82.265581905416908626 11.371935896693704748 93.017366687248966173 -216.20342391663965032 -202.79339761770560813 36.105571950107318457 337.30562270278807091 14.433809096291867036 -198.1750365522735251 -118.74105534671117823 -3.6605199126570875379 64.200648773582400963 99.287217923476788428 120.46622919490555148 0.53789729360179550088 -90.553601536452191567 -87.530488665924210068 22.859520701386323083;-86.396865776436712281 18.446543276748720075 84.61863840558226002 21.572623247197380891 -18.437794520745246274 -9.585462867030219769 1.4626961777931599684 -8.7868894882542907254 26.60954664333520725 1.8779227920744356872 -10.352440983325665869 0.065298345295506141084 20.982981719045167068 -10.94058304804568138 -10.516606455439619694 17.269576094938329902 -39.510280653758783842 -10.96029698618471393 26.181762692598571363 2.9065805249880680705;-58.657389168992509099 10.560222231105669266 52.587870491765990266 -2.1876914159098501678 3.6042700252830752738 5.7984145753429681136 -15.238229940982908062 -20.482348381849806884 28.172667933191831935 10.077237855442080061 8.699745631872215057 10.120968676648491424 -8.0840329726373134633 -16.424990453280294389 -4.3173793857250712946 4.4248201922241898743 -8.8606881144913103299 3.5757481640749371188 1.6897395965697641351 -4.5350795756353896593;128.6754116895871789 -78.572991497814015815 -109.20666978334431008 19.233706614368610843 -2.9445639800552361187 12.673791429444497325 -66.706848423833051243 2.850689364128632608 41.167679106729217153 36.948076693731984221 3.0964618892051607446 -15.295860099713641134 -79.149255854327336124 -6.9608420133199802038 63.686680585716239023 9.7095656080507719565 48.589365938611308593 1.4803380922550446464 -20.289028751770683101 -8.7551366509538137706;-38.368169144587199071 -153.07220124130392946 -156.69755033881139639 -382.35661975705323812 139.88697671573626735 661.40485023998223824 163.52841022395080017 -399.56930623810745828 -239.60520393853360588 123.83513752393417917 56.602582692756108429 -255.2049535596696046 266.77823036045123217 209.95819682403313777 128.79678193996525692 -400.57058146388368414 -582.54999426931692597 346.7985356338707561 295.02256951321061251 18.890594202235718058];
IW1_2 = [4.0416196008848883636 -0.24746416018066005882 0.77471454868498823565 0.56751526320289746863 -1.64004144095563964 -0.3451162143658237369 -0.39169948344279109653 -0.45400038398133657491 0.6493271983558298599 0.10227295149728077295;-4.5514617857496917352 -0.75843056087695337464 -0.68376570333241171173 8.0132579542521504834 2.3458414453184168735 -0.52777182225594876375 -0.41413379853211312875 -1.7606344770238773201 -0.0069809665526054673693 0.55425353574370028742;112.58127777833561822 0.072764370266823225064 -0.26270398212923307124 -45.249648444064192176 -10.706718045087239233 0.80401133954552028715 0.31448620533289117773 73.133764498305112056 3.5729845357902809688 -4.507119423779845313;-4.5163029730019124131 -0.74478188780819654102 -0.66302576741117347225 7.9312453553396595751 2.2240099669037967089 -0.44053447773175447022 -0.42474959294522807163 -1.7036224464731350992 -0.011311098839369201213 0.55209995198731875998;-7.4406653952476595748 0.27309080029229509945 0.67893178556986766292 -0.4401118047898665564 0.91554440931083791444 0.28089239017680178723 0.13816774715749316482 -0.23378573619047696153 0.36544239344480461407 0.12186409198821152033;21.519489851005555892 20.394875054964167305 -8.8191099087476398921 -81.093901821935844509 -14.860775012597247979 -5.9592277567424147833 4.4823529381132649618 5.5095999889383682202 9.3294771842509529591 -8.6661403549746953701;-4.0192029871442782607 0.24965316976713766706 -0.76057133636450158232 -0.55462271869044488248 1.6380526348602850728 0.34191234847395673979 0.3782045361121207927 0.44112970678805263347 -0.64417743177778741259 -0.098198544715054153498;17.502889543593621369 -0.82780096205082198679 -0.95698164753324022058 -8.1009418971753568428 -0.92856669506364986066 -0.67607607217978060721 1.6090302032942485067 -11.299364520062798789 -0.10021272993489016567 -0.76582379847521331317;5.9487788746799372674 0.96899324392719443644 2.0439874001261761904 2.113704667438883078 -2.7797208600617895335 -0.88623888974140541119 -0.31186266015910080185 -0.96221385918549817706 0.32996320439875292951 -1.3716944086453688456;-20.80738554879049218 -16.120056750939816936 -11.341280792460390003 100.05773116374405163 12.180898192590602136 -6.1760962916439776649 -6.2094329203936231565 -7.1532916408052917845 -5.9174562706627966691 13.041370023208900264];

% Layer 2
b2 = 0.00053242735533544263259;
LW2_1 = [-42.561499380262787895 -59.624385503582850276 0.97074958977143721572 60.754295740568132089 0.94033586093645882276 0.95160569660044513896 -42.945948315157686181 0.96990014748469888239 0.58443892994580015632 0.79302930693268769424];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Input 2 Delay States
xd2 = mapminmax_apply(xi2,x2_step1);
xd2 = [xd2 zeros(1,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Input 2
    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),10,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
xf2 = [xi2(:,xits) x2(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
