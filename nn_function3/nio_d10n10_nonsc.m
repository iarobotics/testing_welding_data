function [y1,xf1] = nio_d10n10_nonsc(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%targetting rupture 10 2 inputs
% Auto-generated by MATLAB, 10-May-2019 22:00:59.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [1361;56];
x1_step1.gain = [0.00110741971207087;0.0176991150442478];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.4392611983141230247;2.6934801483993031646;1.4607064727171137353;-1.7203395418755975665;2.7116301048653754791;-0.90910730688307128666;1.7527471810650574469;-2.6077557488267211205;1.5828814393232566449;1.8450889091293396493];
IW1_1 = [9.2752908954304302824 1.2669560148128964361 5.5348312090134381691 -0.17735893848588574206 -4.4248304680705352609 -4.5914021323450464607 -2.58394593340631884 7.0084957474531748289 -0.44602269322605919699 2.7469052825808111251 1.3949705699965451178 -6.5879984159318709658 -6.2534244845822719583 5.0541117146112863878 -0.53164525903223525116 -0.78976227831491208065 0.30955239105291249002 1.3500452147967096916 2.1212262374136328091 1.2106762816520819648;17.771422325698011946 -13.686642260848753239 24.735640025532497077 -6.7310557109438624579 -11.748140276271184845 -2.3509281245125426274 -23.194520939418467265 4.5828833585059518541 -1.9054300850241046028 -0.33981793645145530469 -6.4398046649638507333 3.2599606608300506494 -14.742890813628065416 7.822921775060515337 -14.650270144479630829 3.0405982679146537073 7.6442496942912541158 -0.27688108203718192479 21.003941625265809989 5.4150603782893940163;-5.2636543994793614232 3.7997950745199604583 -7.4641305253459364621 1.1619967838635669732 -0.96073876673696378958 -0.45277656313424680112 3.7871726674979635519 -0.91594818069188654874 1.3857645543542338462 -0.8523767774092846361 1.6027697782669088067 -0.11204973248642979833 1.6695310196365420463 -1.4422428437173253624 0.67737838458246391049 0.55643717496251787757 2.1781870215344079078 0.39555634272629847104 2.0935756582592079944 -1.6143678170407240735;10.402468045262535767 -5.4443862003649181602 10.129993787852100695 -2.4700200708926356441 -0.4398158283891601128 0.03512970675274722232 1.4993805425904334072 0.67080497050136844717 -3.68857680264082477 0.33708498012748033812 -3.5476469705025448498 0.76123162786532172497 -7.31221513494284725 1.1526799238214622267 -0.45025808449100945818 -0.36331441010875642483 -1.9580202976004013049 -0.57473856998210171021 -2.5466374079437361644 1.6516265969057599694;-14.071296419873013051 9.2837880455683254866 -7.7139578313483632144 -1.2380351559226849822 11.182768026670220962 -3.3790623432853261754 2.6341099121360800339 0.15051290521176413639 -0.71763275246232771654 1.5480834383765926798 1.7395911838701607621 0.040573346667675390387 3.4272479219265039596 -0.14447405726498835365 -0.32508456446903016834 0.13830371761157386756 1.163228903366276823 0.34517780828502447887 -0.96744771235518856045 0.67787199807888598446;22.039851676367703703 -10.528557586677841584 -16.913036173540472618 7.4013446305969896599 5.164283296253371347 0.9386809144801310234 -6.9697889485527788622 0.78967184774422638505 -1.461488208459811533 0.44248714737734690106 -1.5244154558549505296 -0.27591063960734185656 2.1852245911610550522 0.75443917256219727996 -0.41303812419524571498 -0.065677351942432127263 -2.5480849556276483625 -1.3118885135384608098 0.60775836254479553844 1.6059317755199700173;13.832804851488567977 -3.8841354515684933801 -8.1001068005885237255 0.52389017252028902139 4.3623579350598076232 1.1424335913803866926 -6.6777082698486660561 -1.5484250957801188875 -5.7081925612936945669 -1.0460566586539701284 2.9108609263336271411 4.0879496798028389648 -5.2962719746149629074 -2.4584772543932964517 -0.20129721608799147625 1.4731170276785352513 2.2235452303156630904 0.22974486190927190243 3.7596144255817565138 0.20247103442767644399;7.9524525756615505045 -7.4067543258794561467 2.3397722057730585554 0.194319030025725481 -1.3355749465705255563 1.9323608067060018545 -2.89129747105148871 2.1154027745675945127 -0.30872354836050897031 -1.7611914392609393509 -0.28503982506128666685 0.27925202704140672516 -1.6140445636530125206 1.4339215853386217958 -0.0017305506940015757955 0.038587863963740691442 -1.9803268505246285347 -1.05985908004477003 -0.57072289827603928103 0.66369426088681593434;-9.7401783759085596159 4.8519935174777453213 -9.3476115283186640426 2.4192120287203731088 -0.68458196067676269081 0.16571519941764734085 -1.2280101861101115901 -0.63436134905623209335 3.9157181823572178025 -0.62173539474851025055 3.3584454881298184681 -0.69353639695523228159 7.078069049229868348 -1.1762324947778632911 0.51420231486680034738 0.38168236891123002996 1.7790397514465561279 0.45473724455128311517 2.537019267856686966 -1.6122778295239372781;-4.2288266298802579257 4.1731968364315239484 -10.153828490615282476 1.9885788826195729406 -0.18916439330910364558 -0.92500348533796616923 4.7196637986736993398 -1.3667116599687072487 1.2762048125378442354 -0.48958959426900305889 1.3605864877461721907 -0.16181857413904462972 1.4892369663666960022 -1.6898609243658282431 0.66700776443674902882 0.6023495539941207122 2.373872887661997666 0.43480175953068622707 2.2912925878444272421 -1.6375554053354774986];

% Layer 2
b2 = -0.56254574688075698052;
LW2_1 = [0.34086565798503648539 -0.51790574985628035076 -6.634969636469080001 8.325944825826404383 0.82539422794193717525 -0.64753984181031143397 1.0807989225014487111 0.95633564878232302231 8.9783292358275819112 6.0074115895962618694];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
