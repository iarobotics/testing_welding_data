function [y1,xf1] = nio_d32n8_r5(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 12-May-2019 23:55:59.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x32 matrix, initial 32 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x32 matrix, final 32 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2];
x1_step2.xoffset = [1361;56];
x1_step2.gain = [0.00110741971207087;0.0176991150442478];
x1_step2.ymin = -1;

% Layer 1
b1 = [-1.7357614452025176277;1.0841459832602782232;2.7025146217231825752;-9.9408467293977782475;2.278229781222638195;2.0401405618072665504;-3.7848034094542177819;-9.2025666562647447932];
IW1_1 = [25.081450006908074357 18.56143519812139786 -12.058264779551215895 -10.265316319256172051 -8.3182776865226397689 -8.1245379188816393423 4.8203854664248817485 -0.50544172358597894146 -14.136814686570200905 2.1293623326251895911 -0.67084778605789441297 5.8627296572573701638 -8.2426237143221197101 -3.8301873984163918863 -4.9321363149348123045 2.6987676794146584491 1.0151722636853452997 -5.8458012830873489207 -4.4470783887455054284 12.482222615203575344 11.760758628539180748 -9.3218504268817721226 -20.449599474256825005 17.258856231992034225 27.913197955885433288 -18.519430400338311671 -18.310249808824906381 9.8008882374028605255 16.182761284954050751 -9.7331641691519941162 -0.7053389233223665844 3.1030901364120433428 16.402432957210784537 3.0738948860888881676 21.246967303973029573 15.444740647447320114 13.031612394898756335 -5.4928393556817640686 -20.985551809841823001 7.4131219512895594193 4.2005342566099104218 -20.823487870206847106 1.8475063293305251655 11.346529543497954506 6.5703786694934098733 0.023839509547486720936 -13.799436913000578286 3.9596005300533421156 -10.183519302088024361 -8.2387897490097348197 7.3035531507767039727 9.5448014329504395903 -5.074111285399953708 13.953914665098318793 15.050198121686412023 -20.851507468459129058 -18.110425073591891021 -3.6080267906021887825 -8.2310495995840895489 8.3212651395178660607 5.526528309294611141 4.7870649850194970654 -2.9471456268592204353 -0.28905647933490841162;40.285014645719115833 -15.716340115039738379 27.447631984537053995 -8.3225489446089504497 4.970282576721885448 -3.3363507592010259728 -12.699076874352302369 3.4675981078736430874 -20.320927546177337319 5.27076120188967856 -13.21139106726026391 7.931977558309045051 -20.566899333464235156 9.97918250838316645 -28.124714841316098557 1.5519751579613509929 0.65473423507198580396 1.107555935001040881 25.710521980091215255 -1.046671466365201697 -1.739519626299395938 -1.0929138692627997642 -0.17981375977154159806 0.010777082948024202871 -0.2291664929369227055 0.84295343653162835285 -1.285374045727115222 -0.06098978176529385592 0.43773316947471319072 -0.65689184264593325491 -0.09060808143147217053 0.76213563156451014091 0.85223551557465826445 -0.21187506064292563335 0.38419192287635989258 -0.20387196898236614739 -1.6477235268700936022 0.31299641433517133571 1.9372430319652724773 -0.091332226015544706876 0.30764554731929893983 -1.4353998336404356628 0.70406758414851156047 1.7351947675353565081 -0.61455317925848895744 -0.30592211053804274634 -0.42743227810276546164 0.5563760787035481048 0.32843810437850257111 -1.342916797379562821 0.24180256106191441723 0.26022929650664877732 -0.48927812639717138676 -0.59957171897478800382 0.57583103418697856313 1.4683394091619867972 -0.45688659831125549848 -0.4356922407315676482 0.31617786757725885316 -0.23261656212487913375 -0.95907046735633760814 0.9636049611189644315 -0.63408382832954746089 -1.5294094142795593427;17.067642112454628034 -3.9404986415669376321 -4.8772840253876097449 -0.67229507334014004805 6.4396290010559091854 -5.4632301820908377721 3.6253542714137991787 0.54411050739404198673 -5.7109051370431167527 2.6067947802849000816 -6.2195122008076690889 3.5930690381084664509 -6.6332211098639319857 -0.27976340605405408679 -5.710885083803343143 1.055257227397401687 1.6673317391265729537 1.7728799618403925376 4.5696709905713497335 -1.7798576253083568943 -1.4590744066909919763 -0.74225080254666997437 1.0106440180669828965 0.49495922018150545485 -1.4849227442837904523 1.6132368362993154687 -0.48698792438912852365 -0.76759303265211409339 0.21078563202696010137 -0.66396567931172911781 0.18483494754985232977 1.5689040589706866324 1.6373835470692450489 -0.61812148693080315454 -1.9620858285873807869 1.8882593178357773844 -0.88840580561827964257 -1.8300939241630118648 0.60179841120170551871 0.45172041712059385343 -1.928710675173967104 -1.7754955901414795072 0.61141117008981116232 0.99652787395634057077 1.5156481427467758394 -0.90805053848991323928 0.81127871854921629335 0.72857436444518020036 -1.4017594522135494728 -0.18734710523715158992 3.0167845154619183923 0.00096936733251693060678 -1.4921217303070068994 -0.79448806881814659775 0.021275480432009715587 0.88127712825192061619 0.29954121928085619686 -0.68386608433990370148 -0.24616151466806593384 1.1699159906019689359 0.1982009309616853121 -0.20421168314734788884 -1.9636844952511616214 -0.14274246561304060332;2.6013563671102453156 5.2455602989849463569 7.181162331948653943 1.6441573660288195668 -9.7795897737977917075 -9.2063854296810045952 11.031013171671263606 11.523339493663570465 22.547236977063466412 -6.2766895055962388383 -10.961041286540597284 1.2459545588956217887 -8.507677612612178919 -2.0340751793982239093 -15.210288647427333331 4.1094509994213295201 -0.34486396922851231261 2.1968455374543904846 7.7845364308741178405 4.2659753443616770241 -4.7177584176591382814 -0.63159433034826450992 -1.8607126951801911119 3.7213846510604740025 -7.1640967156215378253 -4.6866440063697263341 8.0132725696168911611 -2.4994078826949306382 9.9360789680770178478 7.0759639407219889762 -4.1363324150399725099 2.1643249459956761527 -6.9665286990224748465 -2.066951462364222003 -6.3700114112521504239 -0.08443025846147586555 2.1828068011270493898 3.5702029167352145045 -1.9019247420871436827 2.7554423413333606341 -7.1486198694397780073 -1.6989374483917891734 -1.2120348341663924607 -7.1390758926492123848 0.79099468648455539821 -14.612943611256168808 3.570152186937493699 7.3114958303060308964 6.6788879062272394904 -5.3943539130797155678 5.7251611239001301001 5.3036635021570557313 -0.68179362403193322084 -0.72040278530109780331 0.35400781499000688601 0.2577084690277974266 -1.4496155787251265856 -0.23526718189635820178 7.7382306081154919042 -2.9986913117022826469 -6.6762573612499611642 2.3351212947206838599 0.29281152956145256594 1.6390883671564835389;35.475677062098483816 -15.688469609876742439 -0.60101426351163078632 -1.108378133502852636 -16.463092923608883211 -18.287245970079816004 22.487707670106050983 0.89841027639522819115 -2.9023782304115828268 10.827918021274527405 -13.193902964762285634 10.159355187904960616 -10.394558613593661178 -16.300208404532341433 -1.4008319699072300235 0.43091838155845751945 0.20472693750005296898 2.452771497904815412 6.9493492389937170373 0.98781579731755098095 -4.2612217805446936936 -8.0280464349231444032 -9.8520281579455186716 3.700225745732932392 13.894767648396040727 11.72916599429776241 -12.436096306831380787 -6.3984364026807352133 0.46846309545685127507 -1.1319052971471437186 15.694032512439417104 4.6225567025152525247 -0.1066493649606637395 3.9626205045402782545 -6.3130642491030757313 7.9887810734710544835 -1.7955992191070173636 -6.5107974416681519969 -13.15517690293929931 3.9804838562937323587 -1.3807499464151531399 -4.564757615515561362 -0.82742849544657282035 4.2804208771484892893 -3.4722263700731517133 -9.0259677447119575078 12.260093057664573024 12.795183244355694541 -4.6728586963965614842 -2.35999683679320027 3.4357025511462726541 -2.7811312423702236885 -6.3945683704256399693 -5.710667422500216972 4.4074445749672443995 -3.9028100085073664793 -7.7619502883390447678 -2.797631661757958188 8.5080876052601492887 0.76740007961547784809 0.063685925328831188841 10.558828022260950519 -2.4956166830788713007 -5.2867970744871781719;-24.933657911312682387 -18.781474027397436544 12.763734860736750676 10.581218007979225959 6.8174910217799924439 8.2722562814659212904 -4.1057833597597719333 0.6915328768792012859 14.121319697417463956 -2.410540325769522596 0.73886078030446111775 -5.743804589709856856 8.1609549457557104546 3.7751476571758830758 4.9504230521603096449 -2.6785883094165638951 -0.77329129121210971043 5.9774446914808674336 3.9263282461638673304 -12.751375544561810216 -11.420039726385057932 9.5517830203866580518 20.483737348665361111 -17.502965958827267912 -27.593821341235123867 18.83749688512243381 18.258024161004293262 -9.7353101600776383862 -16.645403024267821479 9.7366040681208065877 0.82823663485674681173 -3.0351231166809489181 -16.661558615371507841 -3.1697254940386603295 -21.567416182610809727 -15.617285016294729871 -12.84918186438913601 5.722858384310830715 19.982715162564602451 -7.5770885919691002286 -4.3748226802288501247 21.03703942502504276 -0.74794087455995650338 -11.978154779882288494 -6.9819797981345628202 0.51041991738283198909 14.906633262286979047 -3.8710664599058031143 9.7169999622250120552 7.9120292866498145301 -6.9367985735279713566 -9.3700030715323325836 5.4387771492470982082 -13.986200550692243993 -15.726370123464311845 20.918314034153009828 17.933708123188250028 3.5432811867979010501 8.5552705558233039795 -8.3082645746184429214 -5.7423488608135659916 -4.5537744167254299299 2.9509485717875674204 0.07416516235024238346;43.266717082002756456 27.977635593621275945 -11.825489548525361272 -7.3965242282243561789 -10.045601473347888444 4.2147146504928238997 3.7730428425139761472 -5.4516132018988292529 -26.096918546134446615 3.4999232870097736203 0.34996514684394092187 -1.1991826063954817982 11.309936387729562668 4.6389568534688221391 -2.2051601985786311033 3.1221802193678938053 -5.5926405495559352588 -4.366432716685782367 9.4910454861417523631 5.0219486419293151158 9.4051756892982840697 2.7139967711353638613 -11.413307669101460107 2.6669456996145850525 -11.624109135006026605 -1.9658197783276414317 -4.0596852117535888738 1.1662424494749501491 4.7594177682072809077 -7.411233837786078027 -14.263853585892002585 -3.8845710032148970114 19.709751961176198876 8.3851313711610604429 -2.0172679298090772093 0.90160568894412584928 4.0579670701146088874 -4.9033290272733909276 4.1764299718469102274 0.68977610109834108787 2.7652870304642229726 -2.2770247670999572698 2.1564756797085014028 -11.618633089987215001 7.1251608318563874889 12.336471948673485954 -1.6977425944322803719 -1.1159312203344551317 -1.4274085529201661071 -2.4513710436768469947 -21.641621266555969072 2.3064961650341766486 19.247885875810364809 1.9536148272149287397 -8.8868888368425320579 5.3820253457396427521 -7.9228706221909828145 -2.6521043618000437192 3.3310257189074397033 -9.765129629519664789 -14.101091805873190665 -12.63666224549737116 7.4999476969786549319 2.2732229317853120953;31.257080789165748058 19.978556967028243463 -7.3905414325794724917 -4.4825023483507218103 -6.3784425473163608444 2.2778775553334313919 7.4472823934148069114 -2.4076505351211312522 -14.599037701378778209 5.26397481760022945 14.708794117415706637 0.96857989809633471268 -2.1743709342237331761 3.137769430515566782 -19.186527024731191204 -1.7970266546842712518 -14.031337618903785724 1.0413938934370108313 8.3758017154413142435 2.4426800357753268855 27.818603193889277492 -3.9874321236577059402 -3.5587760538710804248 1.6555432816572868138 0.4586990768916178185 -2.8630710977205238166 6.9789341355814080714 -4.2305262093994713268 8.5082265776893954978 -5.1670937586712364364 -14.996011583771014841 -1.6238756545045127666 4.8588577513153987653 6.0247475146451474615 -14.839675731433436212 1.0571835529523145869 -7.3459939282073190014 -6.5478504946594693337 9.3193095408929842449 0.76687655246366304151 11.905411954915409822 -3.2688398120058690388 -3.3147966893353673079 -4.0969473520999537541 -6.3176065053531518245 6.917195240379204968 -2.2677712748920555441 0.1800845702669566506 2.4098693541942215468 -3.3613677958747723018 -15.354464562562718299 2.543823831918288203 12.041822889709070665 0.73437954790368797919 -6.5868842886159288952 2.5261640008097963062 -13.07024828854430254 -3.8533719700571031908 5.4677355482396317043 -6.8390839817667989919 -6.8959554795313104947 -8.0116924088779235547 9.1872433959457620034 3.0166257219911614129];

% Layer 2
b2 = 6.9743447386239747487;
LW2_1 = [6.6328095340687287518 -0.88944873694256043617 1.2897504920811746487 7.9134831306541544294 -0.40940779380216568706 6.6096161701964968316 -0.39187090653119754924 0.42174112524405338309];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = removeconstantrows_apply(xi1,x1_step1);
xd1 = mapminmax_apply(xd1,x1_step2);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+31,33)+1;
    
    % Input 1
    temp = removeconstantrows_apply(x1(:,ts),x1_step1);
    xd1(:,xdts) = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32]-1,33)+1),64,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 32);
xits = finalxts(finalxts<=32);
xts = finalxts(finalxts>32)-32;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
