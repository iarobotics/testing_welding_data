function [y1,xf1] = full_d10n8_r10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 14-May-2019 22:19:59.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52;0];
x1_step1.gain = [0.000550206327372765;0.0045662100456621;2];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.6392121362083287295;-7.5548161049585011995;-15.234538629287493805;24.63893117470150429;-0.91355282764422085506;-4.061849114435989172;1.4078381201478866735;6.9490198763800341553];
IW1_1 = [6.631983237336012138 5.3197361849664046574 -1.858187079719881174 5.2882086007502593361 3.4938084662427129068 5.0854949821560913037 1.9026389713872493559 1.9758360208108811662 0.98808958938844060338 0.75889063641273613037 -0.57665117100509744041 3.0813062047915922292 -1.4528586111181152063 -4.5437566612063404747 -0.43771895215074008156 -1.7716833871900339314 -5.9012250339916203501 -0.23965613552370279571 -1.1792574529179640219 -4.4678686021997400246 -0.53202056455511181898 -4.0317075108913975612 -0.42163236771878087605 3.9281353094833812989 -5.123563244962088703 2.2663133230437555454 0.50185556673066811229 -7.5989961663886163024 9.3909934607035179255 -1.3765164202305619767;19.812157872748699106 -6.5048273496435493612 -3.1407512500651244558 -6.3642402064379064441 1.8514437191688863926 -2.0207764962018051058 -0.29417535881148376697 -1.4254363768399591628 0.76535028119998194107 -2.7188551722743072858 1.5736413946240697115 0.74041583036409852614 -4.9920019030874795973 -0.30807465023526592329 0.09867893477442161998 0.20409777479613666618 0.40252019784891168719 -1.4648705050809205375 -1.0173847822948860475 -1.327255933007552402 0.073190511102110958341 -1.1879772383083935239 -0.33221804667054344318 7.1998642050036494311 -0.66159022927856758756 -1.5095754034029815749 -0.63167400188324973609 -0.65699633045892857908 1.980083455616435506 2.7960912588705340021;-27.876901601354106219 20.18083142580141498 -0.56327903511165189343 -14.888709675232599139 11.471428600912478402 -1.3199252652511508366 -3.1973672395534191715 10.378285184291851095 -0.98101050565518599367 6.036868770640472448 -2.4865201105994914066 -0.2813330115856770286 15.634496081111342036 -9.8989434217313867492 -0.63666205086008975655 11.870785039597253174 -9.1020095947447430262 -1.085028026674371926 15.984002337496217905 -10.730935510837632307 -0.3618646512513280511 9.1486567590520451176 -3.3102332684011503972 25.907520687781868673 -0.17850201291930056779 0.58435091870751387777 -1.107287745128754386 -12.040368524868863886 -5.1561079569526224731 -1.6852476535235914046;44.903075429892233217 -34.0789761229122945 -15.627468591913222795 27.551083900114594627 -18.089959023447399034 -6.1675020531610726948 2.0814963081429636027 -10.760126438168944318 -4.3160672505171522317 -16.57472851367672817 3.9177419246290883237 -4.0033894104988938523 -19.039381685687576606 9.476662685998807234 -1.6789566070787318441 -17.450206636800245974 14.097806943025926074 1.1053775603882891598 -36.512286539386614947 22.559828182717300393 1.1259769031693067642 -21.228444232373529843 0.35261577977038865983 -9.7450738417028190952 8.4390755947301343554 -1.7264072626062905158 0.7596506698291021209 31.802613930448789148 -1.4577433553047260961 0.95282835101627672003;-20.986160422048218521 8.2730708408776596485 -0.80486260173397194961 -3.9523621308183520817 -2.1702218532872246115 5.163811068188621789 -0.25618224548007079155 -5.5707113739694689158 2.5300175949272141196 2.9467414820003892117 -2.2542393337801485131 0.70957192429345361528 0.82461451927476769885 0.74846672007997339104 -0.2781014945846588815 3.5502307717098315898 4.1592439869279482778 -0.061601244371940484801 3.8211179922007096899 0.94298470740548356872 -0.089660342477592941401 1.4307433638541426912 4.5611068288663458858 1.3015935184732136953 5.004330806204117188 3.0582882100186936647 0.41609965479067256844 4.4289912162633902071 -1.2701122833497140441 -1.0752070116240537434;-4.9113651171109422577 1.6849677036730381641 1.6938691294173815471 4.2352247948133454614 -0.93080508210765078303 0.057183195080288712342 2.6841745167386803494 1.0135546595964255445 -1.3643105748568438162 1.021145492216771089 0.49956239040422856235 1.6488327561112088304 0.89414063830204637551 0.07721934047436967985 0.30894429578613369358 0.75012271925052709243 1.1159375923582730561 0.027150415906306960695 0.046091260492063662602 -0.67125754415684546483 0.15152878020169285866 1.692601701115960422 -2.2596706368968897394 -1.8887756104914494859 -2.1429739791681194916 -0.52511020238059591403 1.5282075598791780013 -4.6329872153593116835 2.2548097162888862677 -1.6584955797939064936;3.9285071208431894263 -2.1200184712082634775 1.3641493761424245967 -1.2239760783592004145 -0.3545740173310663601 -4.3315794585746614231 -3.1003862805957185245 1.1882339977847267143 -0.18038808029087916029 -3.4934190759243608504 1.7036642836972204496 -2.4228902614559308937 0.1979519050681058101 -0.48124092115960981353 0.12717696902108346912 0.53096606080645469827 1.2163550730512961984 0.10878210206790867032 0.04620500501151437317 1.088193281855826644 0.018884656265010325848 -2.378378790503304252 -0.44066723640705274256 -2.618606064730443439 2.7262536004917476973 -3.0536218041353757613 -0.13087205709480206894 6.8743465847663491886 -6.7354474808160311738 -0.48000277941013863581;-13.720735631766283191 4.1571549260275313387 2.8037697859089747432 3.2667474233337130407 -1.002317010194164526 0.15117376417795966304 0.95111520080055467208 0.62125408093633271989 0.17809415192402139327 2.006208963732670103 -1.1067409779372086032 -0.36256274743318012144 3.8005099675028080064 0.47842271211000020337 -0.081300323667780963199 -0.47264908321713000605 0.55251552978555829032 1.0658399090938108777 -0.69981089243929328614 1.5767792999855512193 -0.23266875929690838953 1.5639220738388113219 -0.47581660793294405787 -5.3065673812840143952 0.69590117213338387181 1.2487035847562109048 -0.79363646692877942712 0.88128951659128174079 -1.9965965191782522048 -2.0992619925430990868];

% Layer 2
b2 = 2.2965039443467274438;
LW2_1 = [0.32265671151742358891 6.7311348957792418446 -0.53276264686693586281 -1.1554244954384540467 0.70089190373079968133 2.1386058198977613287 1.0130134594339155196 6.2063626979224677527];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(3,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),30,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
