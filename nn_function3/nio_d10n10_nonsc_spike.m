function [y1,xf1] = nio_d10n10_nonsc_spike(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 10-May-2019 22:23:29.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [1361;56];
x1_step1.gain = [0.00110741971207087;0.0176991150442478];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.76001976558374528814;0.27019685434146856196;0.45918595204839363078;-0.23160156762134656572;-0.22710882516219715876;-0.63588234279425814854;0.74990449380860713102;-0.59291216424140213981;0.02004767785798454785;-0.0017701078983678988823];
IW1_1 = [0.17478597660081310328 0.27117809337405701653 0.28769320238016998781 0.28839698507105154812 -0.13321374378685083006 0.24927718383472619035 -0.26728424225441249629 -0.24434002359779669056 -0.26309107754539146073 0.28691996740524677856 -0.33952207392959232735 -0.18391230390529111904 -0.08584253954951964749 0.39415317119321902073 0.10106861112873594122 0.21558506244620279091 -0.50580406807944289227 0.3243261450715152483 -0.059697850208397205962 0.32281380140141763269;-0.2571489682555506695 0.55760630738485417179 -0.36096203077101057799 0.068317310147274601384 -0.36265070323332077029 0.063490520150760676454 -0.25058099296485814023 -0.77044777382255091869 -0.19817597377052428853 0.32059269514521276934 0.24251638010946371948 0.22138567987439955465 -0.049331383952362611867 0.35989898380992635385 -0.092700516073804500872 0.1298059972212057267 -0.13019764474354122985 0.11972928975692252729 0.42175275621775704105 0.2706589817013924093;-0.25265849240999876946 -0.57856159341064106183 -0.034872725761838162251 -0.069263921270956416154 0.0019623225878084493354 0.48553263950395403326 0.0090375921124435931731 -0.14088279500679259937 0.12151190642906077588 -0.085295080325185040904 -0.04144977707722430349 -0.26101873794389779393 0.05339466105059766099 -0.11198880707617500652 0.084598999863090079687 -0.13203376701511138069 0.16004886223320383132 -0.1163425843176207064 -0.1681682939406549393 -0.50087019673436516953;-0.20838603687019274791 0.43859275048568752142 0.1496418823148068511 0.19926288336402114831 0.2015415375371087392 -0.14639236201234487322 -0.26312074725609840842 0.13301633355516440105 -0.15529397828649341151 -0.30603985387302029553 -0.52637687322849824323 -0.11241081916157449894 -0.015938333427561304778 0.1315160474995343276 -0.18498767583768679912 -0.16423860834325240687 -0.10497112613721784613 -0.37824799483184884386 -0.53499440205497639234 -0.65311997836104040971;-0.005634054901985791064 0.61074085842063763341 -0.20278053259704159617 -0.95701769694602545346 -0.13288389080767837314 -0.24364792561648923597 -0.3868331577856656267 -0.43711217503638327697 -0.13937241086410304125 -0.20506845191079306479 0.26503470601560336073 0.21413186843999162945 0.23374107193779766756 -0.011165311618591289983 -0.07768346985951204986 -0.062007445274741980479 0.30208130251240528086 0.24063898117498058737 -0.052981664680765337694 0.31635699050415255762;-0.18950149658543979925 -0.5137568328078533364 -0.059764805337299942156 0.68674454990362987505 -0.00092979644370812068732 -0.26287972361718781045 0.093773909019440895851 -0.38662941091670555149 0.039496288775126245363 -0.047971000283075840298 0.21579019874519470013 -0.15658024976114356952 0.20373267594004376702 0.41272201972841171536 0.066280205921330367924 -0.071584745419959100454 0.20183748821364219661 -0.34473967964993534885 0.4035987175004699945 0.080290923410826678386;-0.81837411613327837312 1.2263936186196688904 -0.2796533260587105163 0.89032255296734919003 -0.13481504870066754465 0.53570777112775824769 -0.054333701019815952571 0.68968813546474372345 -0.055415687265049695664 0.26795573598503186208 -0.10817581760078066877 -0.011851479418977484484 0.21491349551545502194 -0.17496109670240514444 0.16019347234822012283 0.042692663111424250522 0.36082981727214141765 -0.02805036714668928538 0.30760506943302468041 -0.32792606076688618488;0.36159024792730226627 -0.53361639429348828312 0.24763112808108111995 -0.68742863655804953282 -0.1741569106007176404 -0.62013544044774626673 0.046628246935893076508 -0.40465811140213220343 -0.28956010159824618899 -0.17527354385819202132 0.14150292646802795082 -0.074859526484272173597 -0.012748080560530635971 -0.061983200271592882313 -0.097847780127225961189 0.36615935112403930063 -0.1745878823345798081 -0.26670822860455406511 -0.15203843118831475434 0.46274497761752286795;-0.31119012134175194628 -0.40058109528580748693 -0.26290217601261384184 0.18274616632856702236 -0.20702409662467943785 0.2463052412041296102 0.4976279118343228669 0.52093704708552912575 -0.23967262253983254161 0.018529071402747905595 -0.019487953157161036488 -0.019301556363852979958 0.34033037968639123783 -0.20839673884408027593 -0.15442975194143979123 0.045425224809195939579 -0.021431712319904552833 -0.48288798070162630705 -0.23484064307710761366 -0.52247859286512809973;0.11673203001827438252 -0.66398533834279438448 0.16985991089191135317 0.37161226119008211599 0.069818910830809224888 0.054298579757803229484 0.13102362181615384573 0.13035157269636840627 -0.024400968303865979564 -0.016626063470722516474 0.039829745854671708138 0.069420780403155996074 0.62726483048287662303 0.28411004674304002338 0.14671749586345403382 -0.11745611066502670283 0.21346757349188957842 0.048190017562369576176 0.057484723373681649583 0.41552465548098133086];

% Layer 2
b2 = -0.5320527383934542387;
LW2_1 = [0.97298958216605901939 -0.93462261438692961768 -0.84056124066601156652 -0.62625709737204016125 0.97063918581767671956 1.0043003076056911116 -0.63565503761759178936 -1.0757567480659588899 0.94536289358532088478 -0.86368094631983105547];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
