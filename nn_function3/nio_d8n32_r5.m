function [y1,xf1] = nio_d8n32_r5(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 13-May-2019 09:54:54.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x8 matrix, initial 8 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x8 matrix, final 8 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2];
x1_step2.xoffset = [1361;56];
x1_step2.gain = [0.00110741971207087;0.0176991150442478];
x1_step2.ymin = -1;

% Layer 1
b1 = [1.7195980089130353807;-0.45379387392749520602;-1.1402552106164971502;-0.5890573410911876806;0.56177358549698164225;0.23797054568430553445;0.22557671605425649863;-0.72577651355124528365;-0.49130924391962443876;-0.64303845498885858767;0.0078104145453506673008;-0.33066007882548587027;1.3971182121819920585;0.92445916989983911716;-2.0383691167131128275;0.60983788246231573904;-1.621100175919685249;-0.19351902736275078398;0.25352363751973272521;0.53085503736451122858;-1.1865259230525331269;-0.68100450358936981399;1.1213374659634856023;2.0539957083671271931;-0.63410932463031632889;-0.7685820670767681273;-0.71476247929228065026;0.53248720062670207298;1.6006629561758003444;0.91083856829330001048;0.57921332819533244418;2.1018155409142362799];
IW1_1 = [-2.1692892843006741366 5.4746333194304064307 -0.62898634964686495064 5.3084240523214987206 -0.17308237109793975228 -4.8252427124711081419 3.4486543982836490585 -2.7913689187979326967 0.16698891108826538487 1.4584332536587831797 3.830787291364586622 2.5427673210269681192 0.89353132583987071591 -0.57906378970856031696 -5.6971649395769103918 -1.4758489383344912671;-11.330888786318604744 -1.9817590199366779125 5.7429205542839518728 -1.0129938852186768372 -2.2382590694117672214 2.4595620044125552361 -0.99738095779690383313 -5.5070989235384777416 -2.8032521592587817949 2.2153634124020218366 9.7263680947818524913 -0.8704950717928390258 3.1291119287721573805 0.95661839145264748741 0.64753522733554835789 -1.9487268766053744695;6.9958556040026333989 -2.3454248536345816412 0.34294461144453725066 -1.0871973856913690337 -1.7407302045526202861 -2.4322735582393311127 0.64771288398075976822 3.4070671563964762818 -3.9053519373908858192 0.7361798200355352817 -1.2321766332784946929 1.4223536402311072191 0.55218436703876749849 -1.4610556217006145374 -1.1921199139663212208 2.6691857206073059672;-8.1035495143633724524 1.2914413378390312559 4.8096369155180465071 0.87398694108272079184 2.2293698344598391614 -1.2101840469934461719 -2.3172261841501469171 0.7268668322203974963 -1.1505588307945409099 -0.95469107867336400197 3.3943398261129895666 -2.9753982839723716047 5.3975401591305489646 -2.2874026122941439887 -3.2450686753194761813 2.1800248242921576036;7.5322856518935754622 -2.3703671506716346151 0.53091527875586774776 -0.86467384405988911844 -4.040555967342047694 0.74860535990646548399 -2.9344394663955135627 2.325959720796938246 -0.97812762931398189448 1.0163305761668821603 -2.0242378242789427212 -0.15779247474436461363 0.98489212170813655867 -1.0473248757455568825 1.293830664326383495 0.23395220745872577495;-12.651494159014569973 3.1341210867136295448 8.1265698676614697149 -1.3927699148966368181 3.2678425372248591785 -1.2246911974336205375 2.2300800586655338265 -0.61606278119620716538 2.4221157448884076402 -0.071916520678128537103 1.2407545383375488957 -0.70739778486286475356 -0.15019809809122589006 0.57400332336514758858 -4.0455209961315032885 -0.66434521965403026122;8.6352995818035758191 1.9035752823602030137 -4.530349988756055879 0.87255183902927746509 1.9603123576827594654 -2.0590507975029188614 0.65937422883708307619 4.7803772814399962954 2.8360858228590570818 -1.8996509930940188582 -7.8203878744740675799 1.0402964713463618285 -4.1414093688719590958 -1.3482178085708316218 0.14208175806520079165 2.1081067614200992288;-21.3130050356565377 9.888805955481219101 -3.9961489738486783985 4.2252832534730293546 -3.150253155850057496 0.68056776823856290903 3.8935135288129361086 -3.2826585000337114018 6.1773592723504480162 -2.0754770877523669448 6.532609459874404223 -2.2331469556616050376 11.389573520119292027 -4.1927835678716913748 -0.55713886447385885248 -2.0999572512797102242;7.7678400040722968001 -6.9463309555579213495 -0.53399568733281166377 -3.2096401961068670161 -2.3727329341083547298 2.0270063462298497647 -6.1035006756942804529 1.5967025995391921356 -5.4648905528187992076 0.52550056016215196397 6.208093756318326939 -0.17284725317397972577 0.87144683155630875415 -0.41638034290013364869 0.98189472961290047426 0.39298530535460080015;-18.856854719917787833 9.9881912537932677765 -3.6491093182467246869 2.4770391297570912847 -3.563545952046362153 1.317082127665120117 3.8117131146975085088 -2.9797591440407851238 5.6075177246690870447 -1.7705208463128225826 5.6317986678298144199 -2.5923542549976215099 8.2595748690678938431 -2.9108022492227787481 1.8649372874545415701 -2.0886482014303062726;13.400532986352452269 -3.3288595011509340971 -1.6879551885577062098 -0.64178028902094097496 0.93355790137604943713 -1.982960865617440005 -1.46448936257841833 2.5106983772163515845 -2.7408230973685530074 2.2834477739546827912 -3.6427171360207073469 3.5739068389650028301 -3.3550500484220258102 -0.026482797727092922957 -1.2756175829917730802 -0.040735575152377904995;-8.935762308165083212 1.5095152786176415649 6.4281784688089294022 1.3270721363593569464 1.7366774519750796113 -1.8561261358287286516 -2.5096729822993695258 0.84247364241790401174 -0.8483112309816219776 -0.86792475875284169629 3.089206048979067365 -2.874419826890847407 6.1942787481263250626 -2.830815708970607858 -4.0397291551992111636 2.3959184322817352886;1.5948380402367727804 4.2164919394604076786 -4.2487841030451880542 0.40531060778793565058 -2.517165877954813169 2.3222513952146135452 -0.20403570515610150449 -0.388298989416858642 7.3439136629126178235 -0.08733039201309035493 4.3391033480584493276 3.9358157438219913971 0.39072936730436524932 -0.52218647202470702684 -4.9201483214268222355 1.5104131545818948457;-7.6293814779354107714 3.1324178214730440395 1.0239056720924457622 1.0235645781836661961 -1.604309161098313341 1.3447437233564529802 0.97238223165103887524 -2.1111630125210996134 3.2158689308525283401 -1.296141527750736655 1.4166168767310878263 -1.8269056490657686886 1.5033820292631050464 0.37618382049456711158 0.47285093337326888907 -0.83857018098119828764;-10.026588502608996478 2.1963253904427180174 1.2431147956795760567 0.18863094700860635888 5.4210603997748592064 -2.6048645442792324189 0.25554598934189959314 -1.9341249010835910305 -1.8336910027274904156 -2.1679127400268005665 -1.6082452256153656478 5.0397607547770846281 2.7640254077179213787 -1.9140193335625645954 3.8652192799078259888 -0.21775602423368115024;11.288202863040373458 -3.9609578753212888458 1.2687352828601532462 -0.47338122729115877929 -6.6022923936904192033 0.43422568312448522887 -4.8792935832697974519 3.3077662454486116417 -1.5622711283817074523 1.8931324903167894291 -2.5958235056719289879 0.22581618194194091886 2.4763742953759519949 -2.4359543727966164184 1.4355144994222415189 0.57808890615394126211;-2.0397393788054518637 -4.8699313177148697562 4.9934279570730435438 -0.40338801202508062227 2.9767202667599961252 -2.8091283349814673009 0.25878028887699522365 0.70775099168388888593 -8.9715666324063416681 -0.30363683032853822086 -4.9499183439488207981 -4.180560960082686961 -0.30263128938329825202 -0.21438816705448010547 5.6933346809782978681 -1.2145202902596876626;1.0566438766639840718 -1.2687114277859157241 0.9508036766868305234 -0.33014108081827642227 1.0424352399442773365 -0.4013114938752060934 0.55388082382579151286 -0.31255707821484401965 -1.7673439407705278104 0.88051173486661282741 -1.9850392444606612674 0.52138294975036314494 -1.8765065271479706155 0.43010376502866976001 2.2866982666227135823 -1.1544486109721725509;-7.5295687895148759594 -1.9330698409679620831 5.6120005579391003536 -0.84777905032904954385 0.58564681945805197039 1.2800816093330218415 -1.4877272796515126352 -3.3399083403098965839 -2.1892527157221208789 1.4380161833371969404 3.8834572348131941588 -1.6664086769246639896 5.4966830343217800703 1.1388820154252072836 -0.66459979236538391234 -1.7667888467008210363;-7.9953742751418204193 5.7637448976899223752 2.1598906662100216813 3.2489455613398221523 1.4927424801068083227 -2.1602242298796912046 5.5177212939947990478 -1.4209454431644783501 4.1495601863438924539 -0.46638482081090792963 -4.3959713466236065571 0.5273817734141936775 0.71200458871992378107 0.33397398250430604394 -2.9019814983426837074 -0.47066526056211172024;3.1354279504747020191 -2.8641452358881545059 8.632333787215431542 -0.90287486476293510318 3.4952310359839686704 -1.1465695903492216789 -4.2314966338356487796 0.094633938628894395673 -9.817269960082386504 1.7874131171415097441 -1.1095556636593340016 1.1483092939027264023 0.37348192587654349683 -0.92352893596975793589 0.80982154705764908265 -0.30259882961537121204;-4.2311275557219838461 2.0564531348062078386 -1.9841456452801196075 0.27431880310604733753 2.0496698252870184653 -0.4757142033686347915 2.9212162686520568577 -1.6280759792765562288 -0.39797354213246005639 -0.78246894971116209838 3.5969488195514127682 0.18675821153421240384 0.74959309338314472626 -0.85488941025551967723 -3.3832152381398152841 2.2108488382614104317;-2.7321632595612266314 2.3849093800927896325 -9.5913727473844776483 2.4290195977853641374 -3.6758086087570553957 0.91652663235979459078 4.3905869186945274407 -0.34384958112824909326 9.5482783005915319308 -1.537704964916860817 0.67047802785313914686 -0.89232088001951848089 0.29982799986230279643 0.74743053905328304953 -0.42704436491278119359 0.23006938113717023686;12.322343151943970341 -7.7715382695322494655 -14.034131189671674278 -0.73946251886554503763 2.6688822550999620198 3.1724166168920797659 -4.0015706495229270701 4.1968584058221329869 -6.7072442880678497801 5.0597793327313063116 -4.5628357179987766301 -1.5926654423222168511 5.3773778034174979368 0.9494003669466948292 7.3548835332870448056 -0.57810169262025112857;-10.989086542563091697 3.1985113201214971923 12.552432150264507982 5.3470335048579009651 3.6736767775186236484 -5.2146401986094526038 -2.6645041993741229724 -7.1063043180092551054 -8.4813422997915903778 0.96927049242639118365 1.3866865477588148359 5.591001316769427909 5.4475946535318655606 -1.7641184676120871266 -1.4192290116163701619 0.18715516453967578903;-5.6597262528718346175 1.3404525908101048159 -1.4049290792993753829 1.8481901659773358748 3.9866764305407680347 -1.3686884520071103122 1.4623249246170151316 -2.1474922972045158431 1.3679357938694853836 -0.91145719525412483009 1.4598583117628358696 0.70295004167907937376 -1.2608447954262582691 0.36675274303619598282 0.32884203053117133653 -0.61108935467943370501;-10.68041514898281541 8.0954448361973962989 -4.4281858344863627153 0.85441610876196816271 -4.1620672889236498548 1.5288481798696755831 1.2630576301424627506 -1.9983531273700414488 5.7153628409742793792 -1.9878443337936690938 3.3604506030932386196 -2.6610450450814764345 2.7931834452448085493 -1.5046692387125413237 6.3391421669551526463 -2.4763892038493899861;7.5073201629961570092 -4.8298638034886760551 1.1732084558237230176 -0.3024623904434607935 3.24495848817014787 -0.93952622906712046635 -0.5094713179107611678 0.92470754703572310973 -5.3800841318971697191 2.2441992698650317095 -1.7852852542554427107 1.2826494353142430249 -1.032305559082093982 0.86886293511988910154 -3.942785914515934298 2.5057161895552937381;-4.4688269977885539674 4.151492369973706964 -9.6282925063603297389 -0.20375958541327676699 -4.4705224114450405892 1.6761861346633399883 5.469272144189838869 0.21827476632447531668 13.255290113051726664 -2.4576008896112382374 0.84663008632731084901 -1.7494280042385645935 -1.7428306890267628582 1.1422546886001172517 -0.70270635091204280975 0.53327721270532502107;13.229514997005116683 -9.7905135480960403527 6.0618983978811060709 -1.754160606765804209 5.2118440224542110784 -1.7407528924398578685 -1.2627986530947352684 2.6828341556230337339 -7.6265029102301369335 2.5576829760335471065 -4.090713217321597206 3.1470875649647083172 -3.6039540169110981793 2.250671119688076427 -8.3243756785792530906 3.3757377426777233076;-9.3295480297528943225 -2.2318980587980248309 7.8631313702174194802 -0.98516460289842422426 1.6095938218942580367 1.1379033161004410424 -1.7054663475894842328 -3.1534116625796482225 -1.649448355080448847 1.6784410970047585199 3.319860062993639005 -2.1894718144199001308 5.4822102718555321132 0.61111210960636208611 -0.87339856024449258332 -1.3118954368765745055;11.30981527818418364 -6.5263312096261802964 -13.071066430834958894 -1.4843842171847043687 1.8141804608653808728 3.3218080480869422999 -2.8276171457630359107 3.8553995508287486338 -5.6036479405357493278 4.3686274436302490187 -4.1034383768010505023 -1.2165224181310101415 4.3153312243610040255 1.0796522469911873365 6.5683017509928580679 -0.62100521169870270821];

% Layer 2
b2 = -0.80960786910573456776;
LW2_1 = [-0.3794458504753537853 3.576307902539909378 1.0645124099959031305 3.540427249661610265 10.758967075177901407 0.89320512601649826312 5.8450329694234515188 5.2591408279427556138 4.1486932109429890403 -6.3399612782993424176 1.1125760181659527515 -3.3607319426408590601 1.8872404367841437711 2.4740503992623477103 -0.48640249312230521284 -4.0009587902068401988 1.5847204462848558659 1.5897420255256027311 5.0058092748681080053 5.3774401350382943221 -9.4365790334086430136 1.4343555740427038625 -4.7042874424512115539 -4.4172809837349698014 0.38107145938951675346 4.1220574496045561119 6.7092517242661395827 1.0917760532409586105 -4.1920052757957426692 4.4165137668070046928 -2.8725779337662387114 4.8089952490449681122];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = removeconstantrows_apply(xi1,x1_step1);
xd1 = mapminmax_apply(xd1,x1_step2);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+7,9)+1;
    
    % Input 1
    temp = removeconstantrows_apply(x1(:,ts),x1_step1);
    xd1(:,xdts) = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8]-1,9)+1),16,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 8);
xits = finalxts(finalxts<=8);
xts = finalxts(finalxts>8)-8;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
