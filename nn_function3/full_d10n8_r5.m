function [y1,xf1] = full_d10n8_r5(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 14-May-2019 23:11:17.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52;0];
x1_step1.gain = [0.000550206327372765;0.0045662100456621;2];
x1_step1.ymin = -1;

% Layer 1
b1 = [-6.4172730897693757157;-15.546211485251507867;1.9193476043355981453;-6.6636768565995794233;15.100494840811540698;-15.204777310474549168;-5.1629773707219879242;5.3555178892161734439];
IW1_1 = [19.319394763774067059 -9.05995335033136584 0.53086173368545586104 -14.088541534034289882 7.4903449866928664136 0.64279982898717058504 -1.8989973707304399486 0.38488816501289913052 0.90764616265709929799 -1.3241428157123191767 0.18723871083928120274 0.7285394846999225793 0.47906598412865591952 -1.8501199581281031481 0.33321692811417791269 -0.38414258960892522232 -0.19929527984141851005 0.18680741695718569573 -2.4240958693973362337 -0.76740788543736171423 0.22487906768673360247 1.1831572532673766407 -0.75201100012583421695 0.41784052969526092047 -1.4269851531896178276 1.62639879830029499 -0.00090532121305643073472 1.2950610787552689906 0.52068520140254259676 0.16699385929103652271;-27.643116784379639483 22.331092878318916206 9.5893761238977379691 -12.536262078913377849 10.179643394678357993 3.2060544968112107966 2.4367444389968961893 3.267074067986669661 2.2752715468860120751 12.382615960395874311 -5.73686941903291725 1.7766230701336627185 12.589468408878714101 -8.1952147130659120933 -1.0267499291734702993 13.402216073169856969 -9.4899892119070994312 -0.5794481796188961642 17.823624568012174763 -12.586457427421260391 1.2529674335571134858 7.8978124468622352694 1.1267915033686859427 3.2390050118391817691 -11.019771428637671562 3.7455507147406601476 -0.2645723586063369881 -16.827909685303925613 0.60747835885653467258 -0.20362208893375718932;13.699138591889333583 -6.3162520594043476407 -3.9622153487901967672 -3.066322188618200606 3.6318643096718963292 -0.44132581006676047108 -5.1020523873393157643 1.4961712409537211155 -1.5822324345325275985 -4.8394201696057068673 -1.4824392473793537306 -0.92500238672421619679 1.3812241925662720465 -1.7480732838721273481 -0.71257714335162569697 2.2841668073877441358 -4.7951217962739747236 -0.38329798888781041466 2.2284239510927723593 -3.8364783687855088523 0.34281077991881803158 0.29075313150673354201 -0.4863414908444786966 -3.2226783033367754072 0.38216330608927995272 3.1220437060056434042 -0.0045743369571358046682 -4.3803640212935137654 0.45413670140547585108 0.087496930764124819513;6.577189746217221078 6.0691849455492281606 5.2671543527158908304 -23.350920280307498444 16.47517967361105562 3.5409460726841066602 -1.5435279699432253864 0.13051657516540249304 3.329356178448883874 1.3039020009032291636 -6.8288069414463645757 5.1525831550055478658 11.361143712975044551 -6.0683195142531838329 -0.35824469574582412656 2.5964690978008997391 -1.6294578828966796991 -0.43808979445634083083 1.2373789843524916066 -1.2844508730809474084 -0.53738099058114230377 -0.47462744815977642165 1.7968625544112097892 -1.0750128507325771299 -3.4370895387947055788 1.4261670756893380929 -0.27847926011699830617 3.6616019917804716322 -1.213412585540357469 -0.042623024825184957498;13.684699249312265223 -18.797633035086402487 -6.3197123860768256165 10.44679077864416783 -6.1823431328335693991 -3.2879691308268741423 0.74471703579245318583 3.2145817053773404481 -2.8754146625803800319 -4.0900311818926180507 0.94923504163542915535 -10.936551588789956924 -4.719417082127868035 1.3930193348730133263 0.078892806719825417372 -5.0010177089129612682 -1.2519780166695766432 1.2212307097897490138 -0.60408467554856770665 1.7741351406428451654 0.42317431561267837559 -2.269301055235438902 7.9543267989355816994 1.9302106663789662111 -2.6637918223701060327 7.0908222092888539834 2.0257801696151913617 -7.4824819803087603276 7.9799022312824554604 7.4304897742556494933;24.738447877232772498 -21.991530496015432306 0.52953236168513828641 7.6918965263383825004 -11.97005246414685864 1.208794566848974128 2.3471181525251174627 -3.1560429708178365793 1.5786962771077619472 -8.0686426858470010615 11.075671703085459896 10.052578775909911002 -15.566091782809202471 8.6615002530058777808 2.3988245375240233592 -15.231688398677919238 7.9593608236524984179 0.45741275461983182948 -13.961390409951160763 11.026893333863224456 -1.0673140225051489516 -1.7804716502770818742 -0.040572439349812979004 -2.952166471605718101 7.6808179437092061193 -4.2570879467195403834 0.22463937322638033445 13.135594413876320985 -0.50380940461897538718 0.042269876279198925761;-9.8373137831453334456 10.075499322296730398 4.3158613493528363847 -2.4343456177457456491 3.6124845245854522169 1.7486240447596197445 -2.3668085025176259784 1.9493632354885430669 1.3600292176929753563 1.842165996107105963 -4.4879269328792368299 4.4779967532349882475 5.6995606848931554822 -3.5558346796960926817 -0.32829139619247393878 7.4391043471611943971 -1.5278739472516773557 -0.56201376253018131557 1.9709517301559236202 -3.7201257021020048832 -0.71572390932121954243 1.1165490179199633047 0.31775430770057472296 -1.6434811289742672358 -2.2685794790466533577 1.3179454324468047322 -0.19982035055007954516 -2.0003683985079003804 0.13559251836235247657 -0.18998260380358847343;-15.030034278908418699 7.0889743276473486944 -0.78671347707939265348 10.859838064171849936 -6.028252997194599061 -0.65422379371672989556 2.2885134250959078273 -0.79060081808414406357 -0.4505247202594576672 0.9107112249265502113 0.396891013478121224 0.12999238669281007463 -0.41998791902099619211 1.6961783928320999237 -1.1933211569420003606 -1.1010235356788642402 -0.7685681514071375231 -0.23871846054118980862 3.1808828561701476545 0.8664688353323820591 -0.25753679873087204077 -0.91626233896162867509 1.0788898667969097911 -0.41289963562792503238 1.2516479063209076106 -1.4484766585307116138 0.0071873558730026253574 -1.4299823255073218498 -0.72689653071799331663 -0.19928811082840000579];

% Layer 2
b2 = -0.76958385654840100187;
LW2_1 = [-9.7934908586485125426 3.0446404859100151263 1.8028917684985823477 1.6672515142786878961 -0.45653338343979421587 1.4731165913396593314 -3.539198544058497653 -8.7244587414362086975];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(3,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),30,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
