function [y1,xf1] = nio_d10n10_3in_rupt5(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 12-May-2019 22:32:45.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2];
x1_step2.xoffset = [1361;56];
x1_step2.gain = [0.00110741971207087;0.0176991150442478];
x1_step2.ymin = -1;

% Layer 1
b1 = [2.8311432275643690915;3.2082352857708262839;-3.3302742944343242115;0.57268235089965080498;3.1676504975661599062;0.3163989296787252381;-0.27024256188877321394;2.743858151747807117;-7.119874564779627768;-3.2579502675687472824];
IW1_1 = [-6.6423735163882922095 -2.4989344232668306844 -5.6513341033212824982 -5.6105529631804893498 -4.7089350549853898897 6.2946153353402225505 -6.9467919578319561325 -4.3362913862253424924 -3.874700858944735149 5.2854704023018914683 19.030302717745954055 -4.9419861005786165364 -6.5721271630739748204 -1.3758636081405797302 2.4793528454994531174 0.013989782136683110228 13.585303273320606721 1.5647356536914740488 -2.8877388275906712423 -1.1437586230396477038;-0.67618392661885629025 0.35543485798694357536 -5.4623408346937276647 2.0253720845058431621 2.7719363256677809204 -0.3664004454268439126 -1.0182790309654667915 -0.43937247173342758311 0.90326580006066259365 0.471547024346837651 1.017833918659607928 1.2687434231509462368 -0.58506046048730220299 0.0026720582152458256624 2.2274766377700410125 1.3491280736420199204 -2.1641027435129309708 -0.65208535076666895858 0.92264411920455702276 0.80690789438889587437;2.7571408680183426831 1.9885151859595442403 -0.39385175827380686231 0.68675250230705553456 2.2137538346430600811 1.0069035907058925261 9.7336196091693878429 2.6675755506645097981 -10.872326482874786535 -7.9118866043196947047 -1.5112270160300269595 7.7379989762635732475 7.2895717165633531209 1.8371037948055692901 -8.5071920882448424095 -7.1172130607411050462 -2.1448508270251389618 5.6630471626690237485 2.1504676810946099508 -0.24125042995992060368;32.485699087108415029 -11.854322100997105593 19.25855079673849346 -8.0723632668710294524 -5.0653938665830100518 -3.5697694571643201478 -12.099199190097445822 1.3347038128383390543 -11.016869143591266678 5.2162365760995053066 -20.763400454876023815 7.7630119860342921001 -29.294048661279841639 10.501133347026822662 -7.6749680322821829392 -0.69684885737765434044 11.152006703458766879 -1.2762561539624974749 24.508007079021457031 -1.3218763055844326981;16.589908667409400067 -5.3451670716995050014 -2.7729835463576582022 3.1518552002359321307 -1.4452191249964754238 -6.1838584354910208774 2.8505208918569984178 -1.2941506152652633155 -4.2590024042713663377 4.6586197533845217222 -5.6317339699960697885 5.9584496576124470479 -16.355473874519198318 -2.8488519366776499098 16.580954510761358733 2.0638419352765988712 -5.6193345416237496792 -0.49122941519117047093 1.4741005217563594165 0.21895493894659345813;14.508660778840242855 -3.9680454888903695654 -4.8743085483178996142 2.6223748536128601572 -1.8111503186004123123 -3.0644536431360065443 0.53242635119966186252 -0.020371356699035166743 -3.6093693821113403963 3.755047464358460374 -3.1579594890713718058 1.1057893244796006549 -1.3850091111533173738 -0.64601736126586140063 0.23894737165013868463 1.251733928704977572 -1.7187297829364653889 -0.40357429952203688339 1.0890403147865053146 0.84805905496314903935;-14.060516676013603998 4.2042125670689465267 2.7262537640244386417 -2.0375349392259676229 1.4225005569529765026 3.2804916845778340218 0.072100915160761724909 -0.21628290816533141117 4.1578721942189664773 -3.9801470417866080531 3.5074795660886763926 -1.4103814091868975833 2.3518638935377924604 0.42124905489804115311 -0.31778973078300909449 -1.3481026213654765389 2.1264641271528836874 0.47125240744272517412 -1.8139845623849717438 -0.85323646085990156873;-7.3519604055495237915 -2.4730841044617353219 -5.7546746888027957567 -5.0602960871631381679 -3.6324774442370797445 5.8273592887801735074 -5.1722051499275751851 -3.0274056871531094259 -4.6797102329742719107 3.7022267072955314937 15.069552120007005058 -4.8681686112739681604 -1.5355232152302737969 -0.6872109283137075586 0.62923992475179646444 -1.3243584374086496691 11.097858581826198332 2.7563187161656492741 -0.77311425680378620395 -0.7540218165647395443;8.3466323793235961404 5.4220028365325037001 -7.2197334888094628624 -8.4919138952077695137 3.2753199946334952131 8.1441570772615659024 6.968973369378114846 1.2880379920008941941 -4.4554679120282472127 -5.492066204190035883 0.58228379561681309351 8.7055817618934785429 -4.2673223376128994744 1.047554359327240725 -1.9155113066188727 2.4419922917986318645 4.8971772510948703427 0.74180884917576461746 -3.8469031310443080329 -6.0945285772121078338;-0.19087997880925658412 -0.43287922374728576846 7.4358379842385220471 -2.5310194978653788311 -2.285683619890901408 0.25420253053850233593 0.55212422537354732821 0.65131809070511303972 -1.2950362392749883433 -0.40172035682120349476 -1.0012342038457688886 -1.1029670811384235662 -0.0090344960897856627785 0.10082162884600807951 -2.2024295595648912816 -1.2511685889157049267 1.6793695350374329145 0.63225630663958920508 -0.58641408481069279279 -0.78944685692422900125];

% Layer 2
b2 = 0.60915621929783780875;
LW2_1 = [8.0932444606055309322 -5.3170635285747662735 5.2591367198720808673 -0.9276521060690346987 0.97239668960665004427 -4.8866952247500181628 -4.8600420062025531109 -8.2107017412163489922 -3.787655463768741626 -5.315777548642917516];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = removeconstantrows_apply(xi1,x1_step1);
xd1 = mapminmax_apply(xd1,x1_step2);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    temp = removeconstantrows_apply(x1(:,ts),x1_step1);
    xd1(:,xdts) = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
