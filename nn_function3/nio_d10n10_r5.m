function [y1,xf1] = nio_d10n10_r5(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 13-May-2019 15:07:18.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2];
x1_step2.xoffset = [1361;56];
x1_step2.gain = [0.00110741971207087;0.0176991150442478];
x1_step2.ymin = -1;

% Layer 1
b1 = [-1.6906846680344211897;-0.43305663308570346848;-1.8690040908641087913;0.42210900370100273848;-0.77713651432560693078;3.1447400494857107311;-2.6384490427071067842;0.39360738320294114123;-0.69480337724159235702;-1.8878839555933824013];
IW1_1 = [-16.280203148163927551 2.9824788991615482914 -7.3004799307846770517 4.077068383956824249 5.2793139051525219685 0.78776961004307555214 7.3634929556813899509 -1.2538154245096539974 6.5085561289892890358 -2.7846766905631117339 6.3818744997124525753 -3.6533968134214576118 8.1932587733965061005 -1.6766105510447253391 11.258994098899847813 -0.91992989124409663138 -1.8626409337291529589 0.13610398115786298545 -18.913599118451891457 -0.16805915114018007972;5.539912923547311685 -3.9538104353187137896 4.3835834517341298877 -1.89652043029765216 1.8561417027931019774 -2.661272034795605812 -1.5979667634566285805 1.230493662412608824 -5.2031616240218037106 2.5640702233501837526 -2.2747646020565497338 1.8888940257781667853 -0.98606275002195742374 -0.21963917650436348694 0.50147243384160800073 0.10294946993738167407 -1.9443136016514535047 -0.58362517254446066861 1.0033244409746620018 0.46445525284113081677;3.2088504107657991327 -13.744191023604233948 -2.5015899691386955794 9.9879463717111232057 -3.9396699734742628429 0.52979215318547967506 -2.6985941008427558607 -1.8297955879206828644 1.9310273707347069827 -1.5252972951817642677 5.707510900511275409 0.6583020720984888996 -0.52859974061710501836 -0.38657970181274231569 3.6666440628722276607 2.2983429631199845389 5.5574810632341460348 -2.03216805175721138 -8.0993019414873792527 -0.54467975401793289336;-5.8406660353650288187 2.6428528604070096186 -0.37804263024381207225 1.4381908104029441642 -1.6121551084734704329 1.8521804719229006952 1.4542630071826285754 -1.3680368365266541986 4.1727420273693693886 -1.7528853216293343031 1.5705591263593579043 -0.69728548134222234633 -0.038403479501302149879 0.0080115735462740946676 -0.44240500362453055727 -0.1558474487178696799 0.6920841493508353981 0.13326167817985845598 -0.3460835980955359048 -0.3791599777040715602;-1.4523036077011479694 -3.2956639183628251288 9.8346886345120942963 -4.7497137348530502621 9.8722887301090995749 0.55456714886851488089 -4.3510336930016162427 -2.3041624660205646258 -9.3535391969378789412 -11.714358772593042701 -1.9723487550272000846 -6.1501262442970157096 -8.3371120475091533564 5.4839851788950921829 1.4690806828931950445 -4.0658817534940103755 8.487679939485630598 6.632852152311718541 -6.6621377216523303133 3.1209246498451110874;17.443470224312193295 -3.3181417970807354223 -0.82105000532545502345 -2.6490843035323607957 0.60275151000515458932 -3.3302292761779810348 -3.8995299959606817275 0.86796926379815364516 -9.9344791933606728662 2.6578847348718279697 -1.5042856856653541442 6.5767729127134080258 -16.878550560538531755 -2.7591472289193781364 6.0277121738039101118 0.34173647150216684976 7.9075141250646971969 0.48129107145772409559 2.2546770814080789869 -0.024410840617978886435;4.7620240733544472178 0.97050202586997869059 -1.567617511625992055 0.36288269353763491498 -0.041600548587835281533 0.71324862984008263744 -0.20890225880226964694 1.7165893526514892642 -0.97736379124200567503 -5.377783313935633025 0.72208117101922508763 5.2301426548701410724 3.3007629302399328353 1.7008766556764636224 -6.6820945708745425051 -5.2599339367636055442 2.3342990767396796237 4.6217430971148063534 -2.5865145433641307804 -0.43307414553595124929;14.363188640125331474 -3.4495464694555835194 4.8837167545551656289 -3.7646266157731615998 -2.1692875429857285674 -1.7221475907303749331 -5.9366268845672927057 1.7713010212622526396 -6.7177582488102443037 2.8838516574152603944 -5.4063519522461911393 2.8070860766805587616 -5.367197557814516351 1.2676932334440169647 -7.0065073433635385314 0.68695833885193602342 0.69139138310629311146 -0.15542518067539598525 12.696534914204832489 0.32212335610133452368;-27.299095748394577754 12.953036864049934707 -22.176571386988889856 7.4098328717398089793 3.1025952108877272728 3.1347348492272066878 17.808701136406348553 -1.8015100710642892867 9.9276442445854744534 -4.3767224594736591214 17.40174233754258637 -8.4481611461607215574 24.794988860024535171 -8.6374504429468803579 10.620211898128179229 -1.3401018929908707911 -9.1237694952799568426 1.8998509242015291232 -26.276832279154355376 1.3876122637436347773;3.5527051322603395711 -14.656275846921037243 -2.1545339900884941109 10.706630104468795039 -4.7690119166438211806 0.81393847287449361261 -3.1332264878426876464 -1.9810275503555461185 2.1770456164145741695 -1.7143786006579648795 6.2808336153723267614 0.8424214521630412067 -0.37286273699649991054 -0.41594551067017965229 3.3631079938766363924 2.1476567554450936015 5.5340652443456557208 -1.9744539752688834433 -8.0683752306350680072 -0.61468959625831631755];

% Layer 2
b2 = 3.6701618531152195857;
LW2_1 = [1.3245504635128031445 2.1200810184490510579 3.0959515522921763342 3.0082095262721790796 -0.093108273835107419059 1.1241996270168232996 4.7156529450518416269 2.0492880669939963489 0.94389715118086370271 -3.1113079641499048478];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = removeconstantrows_apply(xi1,x1_step1);
xd1 = mapminmax_apply(xd1,x1_step2);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    temp = removeconstantrows_apply(x1(:,ts),x1_step1);
    xd1(:,xdts) = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
