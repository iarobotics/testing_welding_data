function [y1,xf1] = nio_d12n10_3in50(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 11-May-2019 18:27:40.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x12 matrix, initial 12 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x12 matrix, final 12 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52;0];
x1_step1.gain = [0.000550206327372765;0.0045662100456621;2];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.8187917856626696356;1.7016002820658595596;1.2959436810626159264;-21.928496282110391036;-133.69664008754975271;-6.6080492586869645777;-21.436483535853817273;-55.359009252379841826;-0.38104168171342456262;0.93565888853176781836];
IW1_1 = [-7.5061473406638361539 5.0184013240762270769 3.2690335256999074609 4.1598181071726711977 -1.5375027177233764331 0.89607131376456572447 0.027745609610641097653 1.1845368503697999429 0.63448022388267788507 -1.6254543785016404289 -0.52539778102200385135 0.020484573544300888059 1.0352699419030910732 -2.6682978759100817179 2.1257221887477517619 2.7077232045094175028 1.5551833914145720694 -2.2764136141576627459 -3.6496835615903515659 0.9363251155834702022 4.2355577997484141761 0.26455535750446601551 0.12110261501400210182 -0.017420330474053058456 1.6392349994925308199 2.4468008320877188133 0.013407026145021191943 -0.88288813162317802963 -1.4965419502719783384 -0.013919568693912332327 0.29800450838919451124 1.5021978679122256484 0.34678554548268242241 3.1380948248485096563 -1.1695587847846382612 -0.41734918999382558669;27.259720092323636464 -13.34038857987206228 -5.4755747026569379088 -15.431587819394152916 5.0294363025260206967 -1.9490126774879341642 3.1800941904576887076 -0.98683324608201461459 0.039542955068792906559 0.47754429924988267553 2.3583991576384839561 -0.61085049644618671927 -1.381348987389224181 3.5818089395934240571 -1.0606080239626687334 -3.7174454880887330965 -5.7775722589736639989 1.3652025168327315274 -6.509920818411922383 0.16894158945004777994 -1.7584555157236303469 6.3346983721250422761 -0.14323604017862048843 -0.25217863178836358307 -5.4049484344530114299 -2.8714897509718784185 -0.044097065732689844086 0.38227956948788777147 3.9944404472968475517 -0.16832620371471757048 -4.0588288215924102076 -3.3501483392656781213 2.2993742775227961062 0.63714703714630904763 2.4738369010118264057 -2.3990992640972090832;7.5762341848516667753 -4.8278239097510207145 -1.9431013341977589892 -3.1313123967962672722 1.4732364954093382092 -1.5066365465297337778 -2.3080839257495200378 0.15273139273656799464 -0.014082811629320023811 -0.97424175972382986988 0.12295800087166230963 -0.068707437683410463314 -1.300882600360976582 1.0184194900027312425 -0.29705556238940478142 -1.1921036196976562138 -1.2149981940984324602 0.070218544656175121976 2.3614321926358115 -0.54069520661298886566 0.5404327700636711862 -0.4986427121848070465 0.35419911647387747333 0.052091381877031106562 -0.00042852167860735201899 -0.54781740780990684225 -0.014640387857335174573 1.6527778190005184555 0.81492792486946696862 0.063451524596637040587 0.13340924064269646387 -0.86360064416907456053 -0.027963099696246180442 -1.5451744931888380385 0.11217658220262456681 0.12776646912504185938;31.245206113350562305 -6.6049753993750623948 9.1945522782612307822 -2.2107890900325859462 -18.404910314351571543 0.85844911714041283179 25.242751608357426818 -7.7536407031058214301 -1.7150971115798894218 2.3144173063653408207 2.9962619678945974222 -2.1455324856655733079 -16.249286848272333827 -0.28254281069784459302 0.19204828165289700159 -5.3605063318130303784 -0.65352646292004024087 1.4069175629305903374 -71.092718115437875781 18.1821422285622738 9.3693593603718401397 28.260837464694969157 3.619138906360389818 1.3822102000430191993 -25.479704387954299705 9.0123607895860704531 0.5086649026117671113 0.31381501390369764826 -1.3296163075736884274 -0.078315709365794516916 5.8909294200916795248 1.463194813699567165 2.8613172404931668247 28.506134083459958362 -2.8387616641188104794 -2.8332892729938028431;-60.788452559675775433 70.448295817781072969 53.419017376756976034 -56.014847949751448652 46.787787390517387109 50.180166777146169466 -42.316334626233967242 49.129239587430852509 52.134633172989353511 -25.964911864506817096 33.998656691951893549 -11.412125718790981921 -11.618886571663024299 15.172751568792424592 22.922665067101831937 13.895542833265874805 27.894498028401340406 -9.476158539138726411 20.203996215005929571 6.2102437788780244787 -8.6961705732894234444 9.8345489209734875402 -20.647084404165248372 -8.7380019757404827629 19.63987054133365362 -32.832455599546051417 -16.71039297420560743 43.625772087811995448 -81.888281803979097617 70.910945659088270077 56.229778144160583508 -64.781170905326348475 -60.927627737520055007 32.766934729576625784 -65.880405079822551784 -15.060868030534392048;-4.6287676157515535991 3.5016709056237464992 3.5560712792467796817 8.0409614436778529267 -2.6952899052322800699 0.81411421341412359975 0.16949759537194680759 -0.31879690449990899515 -0.091822141597637976784 1.8698494235693037258 0.23913395740193590933 -0.091833296297313432577 1.0298243825404493901 -0.6914651192821644754 -0.43770914662135934625 1.3284996563958553217 0.70875968689468782369 -0.080501577405915680785 6.2932841718894971805 -3.4613487459583360817 -0.14606731186622554097 -10.168136195537282873 -2.119129427440478608 -0.28289336513340423984 6.413333266124948473 -1.193945276314229309 -0.14114940942771614374 -4.0101808653953368022 1.1671875264592328492 -0.077837525761983675232 -3.3066907689140130344 0.28277955963417511498 0.2217075851850944801 -0.70880417817862351182 0.86420326840731687135 -0.26599569774017595147;-63.199505782715228008 38.712628797510163281 7.7752270915903460846 61.784228134024509416 -42.03071306812878305 0.30785419260384283557 19.079933165265352102 -14.230141166429804755 0.3724248413652650469 26.34919315632551573 -1.7777355056492991636 -0.88626930211463728071 -11.553821171988134964 2.9587477805270809839 -0.47567936551584227844 -0.83594365319611108056 14.373936447195690747 -5.2041733394158402604 7.305978354321204904 -5.5506615244555188582 5.6909662043805928633 -28.485377405514611837 -7.349241504964157734 0.25796559082529491036 2.8918545923429337385 -2.9971264020012617912 -0.034200490167872479863 -11.865882275527557255 -3.468522573034583889 -0.013234113539916610158 4.9211415943941609896 7.8771069996058962204 -0.6138702463439997814 -3.0571923787894030866 -1.1996729337684328698 0.42011201472477888164;-69.357913965393422018 49.436353726685169363 28.381236521621904245 -68.027794873404161535 40.175399951985149016 13.429484974003282005 -27.50654067587032614 23.32641499894160475 10.24950253424745128 12.149245882112428063 2.61106345024433395 9.9988712726151831589 46.111466544562496495 -1.5507346023344616981 5.5370279552380061716 54.899124977970821249 -23.516083666889198156 0.033300875718933586889 92.207068178824030724 -44.573355179977660612 5.3021522105817506798 65.10256727489685602 -29.533968203523745188 -4.271393727318397282 6.6964015824029772261 -16.273237500815451284 -0.92213316490372454481 -5.2619162847940614824 7.889018794007951918 -0.35009551481267009443 -49.625342095175547286 6.2798863735181340573 -0.2438713770113106194 -61.429581103590535918 1.3351612322144910117 0.16774282773249646339;-23.15830086182169012 13.760336950576654402 3.8963360971639171559 3.2134619971957474327 -1.9692000288942932418 2.7764787306664149291 10.778703282876868741 -0.05683318812419567434 -0.87535099528258963897 3.8416159971242098692 -0.46373141950913054909 0.6210004244220143077 2.9595444134785284795 -2.6368329661833906918 0.8058836540877142296 3.624713893387374597 1.8917738146787645981 -0.61484914643506416443 0.30635267671418930924 3.0256514840908823594 1.22158400158410263 0.27990919373873301979 -0.36966670779556448645 0.077277539297575775779 -3.1784354552296298912 -0.64078415936611987647 -0.060435481070267839387 -1.5495923336971784146 -4.531925699489255166 -0.19568396477838095882 2.1187031133316711617 3.3177882875751105729 0.19655000710914533046 -1.8503548109783536368 -0.34037881322548457774 -0.79815122375782177055;7.5971826703057532271 -4.722745027887072844 -2.2957976102590933465 -1.7403930318807727673 1.3037360882714374988 -1.4496035244564102751 -2.5754535787066350494 0.22066312831168816144 -0.024490522385856861032 -0.87432691042937726866 0.14517439954095776034 -0.079146414905558820641 -1.116780607310737583 0.9281281035637418686 -0.34883686409229097691 -1.1177620737572009357 -1.2634352856167541113 0.049507400688802744027 3.2453247394922666302 -1.0779425028360036798 0.16304442966185600516 -2.1974541862529290981 0.0082778333645762980364 -0.0070071773050409394065 1.0708436702796366724 -0.83425908508536639197 -0.028171366059452290082 0.95056524373624740054 1.2179924723733588365 0.10585658028495258109 -0.2963262704839538797 -0.93348781913505718411 -0.21132221468106429652 -1.7610697962346555379 0.24748528085785484465 0.32496810574013412776];

% Layer 2
b2 = -2.3501236950418324945;
LW2_1 = [-4.4020903747776785053 -2.1944783144290234134 11.606031939897404115 0.61449629016340678866 0.28967572598372226533 2.0869602945914578207 -0.59884825933258944985 0.72801742489722165441 -2.3312886895528546205 -11.673926598349755324];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(3,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+11,13)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12]-1,13)+1),36,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 12);
xits = finalxts(finalxts<=12);
xts = finalxts(finalxts>12)-12;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
