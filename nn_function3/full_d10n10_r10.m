function [y1,xf1] = full_d10n10_r10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 14-May-2019 22:28:09.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52;0];
x1_step1.gain = [0.000550206327372765;0.0045662100456621;2];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.1398802444535265366;-1.0261751432860424238;-4.2967815435149878667;-4.6367734041378687593;-7.2409736997549085658;-4.9336289700359348132;3.7154337080778687685;-0.17789123581017371456;-0.96396771200579767225;-4.7648651343258574542];
IW1_1 = [-3.6486471844994530223 1.8727764562422781758 1.5483589541427384972 0.73703452560877058541 -0.86920863385838120774 0.28989606770733161722 0.32454390921285780625 -1.8174848020351093147 0.074945436381329472164 -0.33607255519266632238 0.034662732066159836208 0.10112173545587270496 -1.2254484340011266852 1.0076702438943818674 0.1407807010197817954 0.50785821061980285229 0.6825920555716735727 0.15658968130089653825 0.095061894928054502252 0.48758462776766148261 -0.072622213166932916839 0.55027785595132472363 0.37182278556594838825 0.039246131458921876267 1.7548310343676738476 -0.16085073268810534675 -0.24391686663784439837 1.9348652735813984815 -0.64103326100147517419 -1.1204347819028117605;-0.53569590434139202628 2.1131869614563583148 -1.0780850697386930026 -1.1070188039885082709 1.2939087671200488749 -0.74520015222021240842 -0.82723201392977740998 -0.10598211298073131892 -0.29133948573509521607 -0.4934606066594662277 -0.40324060976485032182 0.2668164690194230193 -0.64173211795272866453 0.1868946685845145339 0.14759453860359042499 0.27012410084907023666 -0.02746121029572964195 0.31319788339347759409 0.55600492644621379856 -0.22415156793444840355 0.57824052026059058473 1.0900799149676747568 0.41814663651947603373 0.41661942765522080867 1.1025053242913613882 0.075515550205201897871 3.3338019977365198621 1.2406962410393194141 -1.4812096864201396151 -0.060393837058312506427;3.7350894228045601331 -2.1539797380488856504 0.20825626548385717252 1.155832091430597286 -0.43357472801053170697 0.99157848140894666589 0.3580683386025569348 0.31341731728144273106 -0.028503047753823368415 -0.6941164732221341005 0.87022362438650047167 0.056140094044892667469 -1.0708159032281197032 0.16933557336102883495 0.15785722284690498207 -1.5368225210021360105 -0.59719318068516757947 0.15031334808404372971 -0.82606959010680647282 0.2028910576846687519 -1.4287993066341682091 0.51417605776295094433 0.002709636478773765067 -0.046352521325344765712 0.089647290589613223832 0.54446582054227010694 1.0439606945339849897 -0.20557159166729455091 -0.30515312322162174707 -0.31915013902005845425;-5.9125259930918172557 6.0428040529809843306 3.7910566279775630427 0.86350497922359559233 1.8197576194441882347 4.3457699551509367808 -1.0142415278812912938 2.1202812560675821096 1.0182223729650634603 -0.70002022131683727668 0.58205339538202327532 0.27598382952091204956 1.2942334453982855536 -1.5698862919487619472 0.35885385200747288437 2.0414139849535688498 -1.8435528124732742938 -0.37705783518781932351 2.1128079099383483275 -0.79668667332848319695 -1.7195264234362070965 0.28390246882202574419 -1.0292849223864821706 -0.061237430854934667146 0.64306486164845444442 -2.0405598402741746966 -2.9683294702729554615 1.1871805330763915975 -2.2907745888347768037 -0.38646534142519822774;-20.588824362736371398 20.132999013589397919 7.9623728084716987041 -9.177569737503540992 7.5052003328054768261 3.0000730104476125426 -2.3149216089120110418 1.5397685671261902574 2.0119634766995022623 4.0400781512671581908 -4.1628024147773636798 0.99455673047663617492 7.4636098355163804641 -4.3561282610146347949 0.32425306058817865429 7.9656967157675522273 -2.805563203965658392 2.1708586720329230424 9.6108279758142600713 -5.8192306727230871388 1.8056069837350445795 5.0078334226529594986 -1.5096219466989304614 -0.48963231709399829272 -0.71866765803224152975 0.39070896732958770858 -0.57461137207061030452 -3.2007454742027672268 0.46831172328132386617 -0.48612798684272529037;-1.4308596936071580341 5.0286975086909357913 2.9036366629464587241 -1.5962529791898316667 2.0451610102761730303 4.8085496118544810429 -1.4356258372289443237 1.3480565084172120294 1.2019762951143180274 -0.83628424239509602245 0.66713604392211622862 -0.37310628466274547987 1.0774812005581917429 -1.2844156350593420868 0.37695194667262277299 1.1583054239905861138 -1.1176727465972311482 -0.42658243482420499237 0.093899282591733523873 -0.42878544259562911822 -1.2883065489544622828 0.91510091800075576973 -1.6996565968447583383 -0.13975894029658858519 1.4522966027854373738 -1.7517305600253061382 -2.8766629519309470098 1.8626515648430919114 -3.3158917607955684659 -0.40636256434726508724;-0.37908911777251264041 -1.6275716821092471864 1.5104988136419057465 -0.074992564491359492429 -1.3896103535147237285 0.25239451890582609295 -0.20751587871922741457 -1.2973780256862779137 0.36409216427696677876 0.36471994545188141101 -0.65826533768294837046 -0.077042480449132672016 0.65000525878051607087 -0.17158012666292665749 -0.19844904815823119493 -0.11855592625171353094 0.5521287147502694781 -0.23863196114623050348 -0.43926975127278983235 0.97091607456172035473 -0.61738103904463159655 -0.95236802916929785834 0.64368501507476727497 -0.34924419368860226687 -0.6584554589686294479 0.81339999020943642982 -3.2071439273659390068 -0.30357870738897863028 4.1686326540440319377 0.43716822805056915202;0.0045026431201558685113 0.25821640733637424292 -0.82102265735488422216 0.29876845575394989085 0.19712456673420006292 -1.5714914494214311524 0.13864578571758046088 -0.30583723637326859501 -0.064409964189963406223 -0.18817501385575211015 0.292712499975846141 -0.013314343464991279173 0.19436338588583729203 0.17172654827392130894 0.18399358701377854786 0.38647704827834383767 0.55235999414847714029 0.14948082955816757722 0.15101451799184328895 0.60010712196300053378 0.02663997252821652742 0.39203099702971005991 0.41237161812922623616 -0.78974806141513065327 0.51190168121812895663 0.80617352410505049853 -2.2357554377867989714 0.63441583949525726105 0.48609292165010076214 -0.74838367215513557085;-0.1710379013971621287 -0.61437645477448366016 -0.8116790677128311593 -0.54387253542639490966 -0.15513879540563332848 -0.88311401238264009006 -0.70265513286227077039 0.24590958972234244762 -0.25902514378988211741 -0.78903306645789195173 -0.40997869764403871429 0.32302013099024973197 -0.71992697006551054084 0.17976698854978931386 -0.0028702835601244645544 -0.64116550745026246183 0.19619045795791109632 0.07153848870457249487 0.051310333031878270493 0.41909085583971605882 -0.2036823330657099862 -0.21876642767307996618 0.019315752098566951744 -1.6596176773357800283 -0.19864874469852961125 -0.051669144017323996587 -0.60659881396234061057 -0.83101582076214985939 0.29138921107650112008 0.028846304941285996759;-9.8033050959409209213 14.183896491143466179 5.5053971568851682861 -6.8804109750127953049 5.4064351348712733625 2.1373817775067567304 -2.9349091056964651258 0.28201862416455275584 1.6103947030977410204 0.90183935428824657521 -2.9945972365103363799 1.3395580279199839069 4.26880438462654066 -3.4087307614514532617 -0.58580849594130202096 5.0622343484476646225 -1.6329739339218738436 1.07102502812599365 3.7577838131402301336 -2.7061547162357086904 1.4324003515401688702 2.7226844689901215091 -1.5180100453222129531 -0.40294574250604464627 1.1992612555488457726 0.0077503789735839934139 -0.5561913903700441697 1.1570983290172744962 -0.12621581570365708602 -0.4662830590726745883];

% Layer 2
b2 = -1.1580005646114357454;
LW2_1 = [2.9706156115138204754 1.8833099245135000999 -3.1966312602758311101 -5.8579760436541210566 4.1246425013379690583 6.2411850750705388791 1.5516175533077909421 0.33655170319677402135 -0.0072381272279081598081 -4.4417244415082119957];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(3,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),30,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
