function [y1,xf1] = nio_d10n10_3in_rup10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 12-May-2019 20:51:07.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2];
x1_step2.xoffset = [1361;56];
x1_step2.gain = [0.00110741971207087;0.0176991150442478];
x1_step2.ymin = -1;

% Layer 1
b1 = [-1.4265848026170053764;-0.24354041210628254999;-2.6148754437585157717;-1.5793542191082801107;-0.3645951103953205541;-0.20964605860092461187;0.90205415068092542619;0.96607801787829894469;-1.5002109767390772177;-0.85830676239741832134];
IW1_1 = [10.290730768874899681 -2.7508446847603695851 -5.9869024764896421331 -1.6911790510642750185 2.8133526136544761975 0.24750204575219370007 -6.2905226392053590345 1.7795950023315549871 -3.887357430883437992 0.23631994622118132621 -3.6333660972672512379 -4.6333974624101310624 -6.4436056169711157793 1.2867344956392476885 1.8439109373333621988 -0.40703134613683861209 4.5876663924017906382 1.8512222189129936556 5.9490547115597589567 -2.1165694473667477915;11.983368890128241802 -4.6362904906914019776 9.5629931258623699364 -3.7480971740900121958 2.3450130968793780895 -2.9194585968717374769 1.0394025552463173057 0.10295822874675923664 -4.9335075325060859797 0.84839872910732605504 -5.9013540071350822913 1.5993873939591531919 -7.9441330749580378878 2.4075900938722152311 -6.5975272132389175539 1.1998703107946167012 -0.56081508677435243371 1.0096901253338410598 1.660249223205322755 3.1914143184578658285;13.984057746032547698 -9.834491881001630631 12.112801633996157946 -3.5115307506634820811 -2.4627474853285669099 5.2108803207740690411 -7.3732697174034340648 3.146576624815887957 -11.978512966842812304 1.7511293595118426758 -0.51845408437498952114 -2.1797176980884378494 -0.99712477675828181667 -0.64549938839861698003 -0.649989961155884588 0.0068965901922484890152 0.07710182417855365733 -0.00088818397479980952004 0.94734290979186575044 -0.50350166896023018648;-16.920121843333227218 3.4578585665023102713 7.4986765397566514935 0.68797586563512935776 -6.7401321305348913526 0.0013931832194607040448 4.7306720972251072865 -1.8038387428499029763 9.4951454028916977279 0.74496673824296721911 -0.83620313728081807625 2.5446769810568548031 4.7530585819433071038 -1.3660069100584453228 -4.4921264001556915346 -1.1190743507309122151 3.5786681373817752494 -0.61756227233968552515 -3.5255405319247254958 0.31420487353995341095;12.220474945241402764 -4.5674748893133765293 10.119197565946445039 -4.2310206823041447421 2.7911930271544864723 -2.5443732620998589233 0.32773099710055486611 0.13618532221754967027 -5.6242712539732888644 0.41703815459804943755 -5.3491012648920959194 1.5149871579700469049 -8.4345100391295737552 2.4211620125685766602 -7.3168546446651623327 1.176703514045377208 -0.20582530978173227409 1.0330492972209417424 2.4627935073900735219 2.717702752554331358;12.509231913829781391 -5.0119979978186153247 9.439755173428945767 -3.849620083480469912 2.2620971184227038897 -3.6634754712541792721 2.3247202722721755919 0.27759666913684200029 -4.9629462262231394121 1.3180250748308819375 -6.7295847838029878574 1.8565840780917561847 -8.0540830518916077807 2.4904648071379544838 -6.2187711811830999054 1.3955536113866564563 -0.21161014487041693299 1.0826353644866673065 -0.0074615561869376643978 3.9065264198195643885;-8.0033896661241179515 2.1515714992528831573 7.6661091430654941803 -2.44169114008705046 -1.5691360991502414368 -2.2838292104628936663 1.5180367378412293888 0.47616730530212036943 1.991038898891981157 1.7928185655950239497 -3.0478594632062927516 1.3198967818808000629 -0.46177705939372742927 -0.5134334696175379964 0.67028326781299529813 0.42079919219378147943 3.5656508744151200752 0.39767866677350377502 -3.5643432417879941099 1.0602660557646035322;-11.560771086625882376 3.0746266618994382291 11.536556323417027414 -3.433850381996244483 -0.96605997605191029631 -1.4350856699752014833 0.4976506785881348871 0.37779672677052611451 1.5857288388604096063 0.92257398410664803734 -0.57018179963738702121 1.3765125490625207405 -0.82794127706734987893 -0.59681614624903378541 -0.2928936463296022974 -0.06855383204252109286 2.8240900619981257336 0.83731469398058755438 -2.6694593797258412415 0.099844790135015223931;8.8213101569748371134 -2.6148738147935661758 -4.0503824772513068453 -2.3055772008828063768 2.1203409498810104061 0.36306037104974697716 -5.6082886162046747813 2.0453028194776030624 -4.0493199525312819631 0.77616108871659827972 -4.7344195390724017614 -5.0699285777000193676 -5.5954399470180469223 1.2380886793145422509 1.9414211242537806612 -0.5641328869379260702 4.5386119841252350326 2.1365677036081560658 5.7116092450053237428 -2.3619650088305164104;8.8186517888356625861 -2.3349138793829067318 -8.7745295531036973102 2.7389536914379233323 1.2109655483850438884 1.7469735499142218238 -1.0873070757266005693 -0.42977126578433982873 -1.4572029202869685172 -1.2156308121460803751 1.5030829151329767601 -1.2979858335608223108 0.64347150189052426672 0.47389704292459927659 -0.096348468022046884762 -0.14425559171342150488 -3.0142599984338289687 -0.59916455085081121723 2.97225738274641893 -0.50781509615522835155];

% Layer 2
b2 = -0.98375190209837415356;
LW2_1 = [-2.9642998288845716637 -11.793855358811869749 -0.64244549642845272253 -1.0025748711408495328 6.8053859054147354257 4.9115159462339779139 3.0190328919911006977 3.7155130146284123249 2.6119717263588113632 6.7315154323134720471];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = removeconstantrows_apply(xi1,x1_step1);
xd1 = mapminmax_apply(xd1,x1_step2);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    temp = removeconstantrows_apply(x1(:,ts),x1_step1);
    xd1(:,xdts) = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
