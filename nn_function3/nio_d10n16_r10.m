function [y1,xf1] = nio_d10n16_r10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 13-May-2019 17:59:37.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2];
x1_step2.xoffset = [1361;56];
x1_step2.gain = [0.00110741971207087;0.0176991150442478];
x1_step2.ymin = -1;

% Layer 1
b1 = [0.8467747822112031697;-1.4128274628602233154;-0.30484647658076724497;1.2126377202937839161;1.3285865891494494928;-2.5369438874796199634;1.7113955585426616768;0.84836464710939407663;0.23382666229724707874;1.2377326736098739346;-0.24694981297788176633;3.1386966809792009592;-0.95763234588838341832;1.9264533160030983261;1.2732330406826055658;1.6875860094009231815];
IW1_1 = [7.7397566521955862839 -4.9481676217402510431 8.4278924159462409449 -3.2318514970426588384 3.6645222827607586424 -1.9888368098258282224 2.5052309581573921626 1.3159400288814420144 -5.0692439294679374484 1.0471607870867347678 -4.5997357569023744617 2.4379754716060002551 -12.752009847284311306 6.5665449704794438546 -9.2488848237944178976 0.89192859956110814856 2.056019925729428266 -1.3090499174036880348 7.5960062541747417342 -0.072421260161445399905;7.3886319843235348515 -5.0934482492667383369 -0.79334328289471389706 0.05653845374180865857 0.16409970359792197536 1.30715565600398409 -4.2822626277725408528 2.3382686757420385604 -1.2881381874462456416 0.083925862145593735364 -0.75092623163553129384 -0.60291685193760458095 1.4655234084917729831 -0.55002232854892296743 -0.30355261490498142152 0.2898323708891982764 -0.45138830451641520636 -0.21353152272282147073 0.044373296723814820153 0.030173885606622066063;0.15002806573504604004 0.071704832691210432238 5.0148156060284705404 -1.6879107659953889176 -0.20179463358538299311 -0.33428167156872407029 -3.175934078031678709 0.65507101811380485934 -0.31303639706061509029 -0.88120705858961212442 -0.54034899213246090355 0.10641653837462132504 -0.17253999855607288216 -0.14091103741563340557 -4.5072568394328413888 -0.87421932584656536491 -0.61387101044363090452 0.91908745777564637702 5.761337572397926543 0.36215619582440478075;-13.779594216439946308 6.5314223841870626686 -9.6375857672919345021 4.5809216301384187986 -3.7177668722209404883 2.464043261430424625 -0.27668650946922157541 -1.0125300053183519111 6.5555294208809229417 -1.8281428261687318049 6.1586083060181007198 -1.9025787872422175173 7.2760926294190850783 -1.1809823564786399164 3.9798078754178991545 -0.87166699824573690147 0.15035562164909804794 -1.2569434610665592977 2.285677006512477849 -3.9951030629671966388;-8.4188040483259261038 5.1480991702042135927 -9.0848928263618482504 4.1000912357079819515 -2.5314679920139990799 1.3502092251692154878 0.73078254074923021388 -0.98981957646406804052 4.5806504257419540238 -0.95671428074872955083 4.0185285149735543442 -1.2894670437386090978 4.9032759524100919535 -0.10771844273492578448 2.450500091533378999 -0.5607984966366661439 0.38996912098116431888 -0.83090893358186268536 1.4322087434950165896 -2.6564852685199320526;8.4031114854400925651 -9.0635404849242107161 7.3075312470379811813 -1.9967116392184993678 -4.1269341635250285094 2.6671774203164821948 -7.6375546421976574507 4.3293970841274926897 -2.1132357547994518043 -0.30129293867810036378 0.8098531568884365095 -1.4616815137796683732 -0.93223428452306256187 -0.29379733386538869899 -0.23418227464420002248 0.19232866003740894945 0.13429894226858571371 -0.36710558401679360685 1.2435905162466422968 -0.52075438866856049724;14.623620578941043391 -3.8249834032269816042 -3.5232511554982255397 -2.650574481908720248 -0.13650177246777389639 3.4754639609559694335 -4.509094435763643105 1.264397810722325044 -3.0089523333783314563 -0.69378867944555844272 -0.48702176143004760611 0.79747063491483838327 -1.3730890736336882618 -1.921764723595810187 1.8452530608843786819 2.496029259568114167 -2.7746092618705668897 -1.1341890912438139516 1.1678236528534677863 0.0991659629738233378;-0.94506079529405484507 0.19860408068966003969 -2.3706614625079884817 0.20561285895685471603 0.73895098943346804177 1.0240842972696551083 0.59148037349790127948 2.0024514275019602572 -1.2207366826102417079 -1.7501543621350934554 0.94529691790536440887 -2.2632715199625641489 -0.18667982475525965458 0.15860403713069926024 3.1173577474897240513 2.0350501921521448878 -1.1555692230628953343 -0.66556705328376897235 -2.1275786089846744353 -1.5073279065896676432;0.39657556507918184652 -0.049792888130956489134 -4.7309695806565059684 1.9764706393992421685 -0.25723752320856718701 0.6088952780513032792 1.7469666721465724191 -1.2014848347614697222 0.65581840108065647676 0.56110090297614667598 0.78983918278346798569 0.053631385411645117467 0.46166065229163577577 0.0097057361722846981905 3.2624942811930721653 0.59535982304179424496 0.5539040847233361875 -0.67658760366427939115 -4.085131367125384827 -0.14061086814826545544;-13.018138750851125707 7.1625919809283153938 6.0382603397930516564 -2.9499423429949578335 0.99477553420713482613 -1.6118562616705944812 2.9054081756046543639 -1.2358586727118918702 1.747326767911228762 -0.44061459940159930504 1.0910082651508037355 0.64093029360753217549 -1.1413794477255736481 0.54050520034646809542 0.1454806930606191151 -0.37444476996935160962 0.83397347219914375049 0.36972565884662833557 -0.35445494095419349811 -0.53074957391945343232;-3.5164365362959428829 -1.6229541606171260515 -3.4242666104167232 0.036302208066203538184 1.1588857268242223064 -0.90035939352708604932 0.59348162105057489235 2.21248819127550167 3.7411560123404012934 -0.76387658195705299136 0.77563317333362424844 -3.7552480926304649955 4.0662274938270437374 1.2296803250732282198 -4.2118351721370936858 -0.33648173807700154647 -2.824242863000001158 -0.24989506802043745526 3.6380914398859776071 -0.33461972523835864513;-2.1834692687925425503 -0.058620482632863867012 0.68414240329572550969 0.78546372161552746594 -1.316403975660507486 0.71066146177321476429 0.15681712677434184178 -2.2426026118165887091 -3.613016741310406843 -1.0032834068399396621 0.12015355517973651256 0.21400677523334496466 0.81385440742127446168 -0.25528397919344952838 2.798293721551171398 1.5412705135203941254 0.233425594382071111 0.58122006514597690519 -0.92241255448708636688 2.3650479118041514148;-0.76560865990583126806 0.18360699002450497908 2.1969787884066693806 -1.4762984454038692306 1.0114532818318338059 -0.13032517774961835388 -1.2282519254468813319 1.0537745114596848151 -0.48998398656355890424 -0.054992161190165637918 -0.28590638128042628052 -0.031284420777115948265 -0.14436156883183356991 -0.17293656359037190562 0.29266006577668596256 0.13907113026763354147 0.00020752722218050131259 0.063483317012260079282 -0.32958153444683346844 -0.30019899154612833536;0.074598529896875473422 -0.37487537224947137249 -2.9717693760686607618 -1.6124831334512415015 -1.9488850404109019365 -1.6308190359785610379 4.4765802480842395994 1.1244612963761757563 3.2557869561562551297 1.6464269614299138489 1.9296141063993652587 -1.2734999325326668007 1.0215051679302917798 3.3983846949029268281 -2.4548544708796780078 -0.5352105166953663451 -1.0279694243744723625 0.54671141776038245652 -2.888544037982332835 2.2733835627199674434;-11.524846401067240009 5.7364957148708102252 -9.1914501904638843399 4.2865628253863139463 -3.0996248379871791379 2.0105234078873679415 0.36654464554007815114 -1.0262849589934270877 5.6261711912923910717 -1.353312561632884492 5.2247095426109915195 -1.6105366475208808819 6.0103334407740636181 -0.68761738194904176158 3.4263921646988602099 -0.62708568761806660063 0.1857653840344765106 -1.0869898686159296108 1.7217314676477037949 -3.3505841179150102072;-0.39001027455215431239 -0.085787972699331971338 -2.3475402716315350027 -1.5673583419496492919 -1.6333562560776313521 -1.3898097062809919855 3.2630530950864176098 0.99659032626538790467 2.8983209316287363855 1.2396172685644823996 1.8786106638171782279 -0.86956170436611746055 1.1550276052435488605 3.1748530914135639769 -2.2771860529404914786 -0.53403777006885089218 -0.99579423576078451852 0.47170471284575599125 -2.321039876063796914 1.9468220626429342257];

% Layer 2
b2 = -3.8507053394082513265;
LW2_1 = [-0.5765797899435315399 2.6446147627994642804 -3.3168723626959422113 -4.8910993681389953736 -5.1986037899938191131 -1.0087780265196282237 1.0070374325406725724 0.43140924224366650197 -4.6657464441092590945 1.8655112197482512926 -0.4510954887507434008 -0.55474310804847937195 -5.3502584427665995648 -1.4507575783868289498 9.9257912244439090443 1.5342698578116304997];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = removeconstantrows_apply(xi1,x1_step1);
xd1 = mapminmax_apply(xd1,x1_step2);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    temp = removeconstantrows_apply(x1(:,ts),x1_step1);
    xd1(:,xdts) = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
