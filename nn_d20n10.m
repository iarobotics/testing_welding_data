function [y1,xf1] = nn_d20n10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 02-May-2019 00:08:35.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x20 matrix, initial 20 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x20 matrix, final 20 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [5.7742669472103873574;-4.8482833912790210817;3.7479817222040598956;8.0896994490899398755;7.8335975793652892207;7.9606368832897418386;3.8437344168841431902;4.8529902211915532106;-11.226902627465166873;-3.6880475944986033099];
IW1_1 = [-4.4977725450066134982 7.340756941631518373 -11.066576432680019337 5.3586564816070749728 11.396779108035293149 -5.2821611257346585688 -1.3217712479171512818 0.64419645035520967102 3.4773627915408895639 -1.4924923526789126704 2.2906931285560987455 -1.0190362768539533711 0.36897571650360416751 2.3860388705903976536 -0.9100060078337265379 -0.25552085508619626353 -2.3223491324188572094 0.60355321705454834103 3.6209962646962887689 -0.31489680591628932405 -1.116007956156140235 -0.81419377156562733333 0.46645083340888804369 2.6397174853225942037 4.0436126302400197119 0.36505816599511498044 1.2443065837930620265 -2.4416774348450478449 -3.8291024774397017794 -0.54436751207088218685 3.9029473456533039233 -1.3372809882468230658 -3.3311178339554619043 0.94893965054930295988 -2.8482161703331465574 -0.84831522898451872106 -2.3609514097112249686 1.1131953894279253969 0.88731699961359156159 -0.16440402959446243081;8.4292988552276408853 -3.5955385130201125143 3.7543748662356950518 -3.2783922464460828472 -8.4641001686349586208 2.2780505083567241797 2.3878081543073310655 -0.16009703980910713894 -1.1618072390691955853 0.34121337956675917846 -3.1412226238337237483 0.316301205626312254 -1.3273935935466401048 -1.7333166339725409877 -0.45020153388196249011 -0.17545953795331697966 0.59553508839466218205 -0.93320241714768636943 -2.7580009288488325225 1.0948010053010330811 -0.39520054234798102089 0.62981179839844081414 0.30650588346974322329 -1.6688599573068867432 -3.056823251600889968 -0.028841415578806088582 1.414061476987755972 0.61927985423763287631 2.929372790576243446 -0.46199333094003125488 0.21836675665129462454 1.79635337241546722 0.37944412829815538091 -0.69261512328993302123 1.5209331277704309926 0.021285069547099758069 -0.60430619591010503733 -0.43239833871350991101 0.96675471452870875844 0.081016637849039174757;-22.70962243940802594 14.62511233145696643 -15.897346100697582472 10.643154915306620723 -13.889575533594664236 10.58500805710195003 -8.364283545927138519 8.3404109653359590482 -4.3243203755460761784 6.0329858926886554826 0.55816447322877660309 4.4110408981228150793 4.2889694951777199705 2.1975077539125407178 6.499733419158405745 1.8713989719069299422 5.0607139886630330139 0.92203055830661462267 5.1537841704703764023 0.24680710939935898707 3.0986716937891798374 -1.4952777681185280834 5.9032174937108488066 -2.665028908750130654 16.341691598580364797 -7.2080276082552288131 9.7587516630592716638 -8.1265195772759017956 10.335328292381028348 -8.2268828488754337513 3.5654099923513733472 -6.6076411654307811716 -0.56140160898478586038 -6.5334006606018357743 -2.7853268396138997076 -4.1987213860052738923 2.0179357307516663234 -3.8999122730116231317 -4.271171650643413642 -7.2209712112163657594;21.871708341538731446 -9.2675778382149882617 -4.5364382666950868739 0.24958294772782102511 5.9732719891653545119 -7.7867035456273576699 3.1137793140000766812 -4.3427273186732948673 -0.31419104397085528824 -3.0067040174002230835 -2.5912580295805094366 -0.45853860480968544611 -4.6747073089978137261 1.6713696160978781524 -4.8556153192646283046 0.60738302079558970092 -1.402585714799743366 4.0210749968633461293 1.0186826244695004196 0.27113033482279097486 5.6520359419698813497 -0.40898550167462011107 1.8951317790564756738 0.020332656185711048269 -1.6131010395808460522 3.8528153286735959959 3.6879508345318048335 2.9154895897859560705 -5.2218981133011839191 1.7287185837978857883 -1.1266648386556028516 -1.0019041373467612033 -0.11607895864809089637 2.7888444846795028553 -0.53274590900594875897 3.5489072071138458853 -10.459723405795131157 5.3420079733207845862 -6.5876603240662312544 8.1856992674326143344;-17.311841572491914576 10.481493330401114861 -6.3894427937873388146 3.3926407803619662573 14.197578094555629136 -4.8153184258477219615 -1.909879722937826152 0.27604026075863841161 3.0221993969938543145 -1.1847023079020466696 3.9301266664652025895 -0.37003110713433839951 2.2390195165157353863 3.0295734896767196886 -0.3395240946933433257 -0.12714825603558524425 -2.4931241774065431294 0.62561795715819179531 5.0316428680794045292 -1.310125869828413947 -0.79569095274271739449 -0.46417911051859117588 0.53675060207314639893 4.1298568490438940515 7.2364697747996240551 -0.55916538621512335006 -1.3736347547973806194 -2.7108279776393335858 -2.4999521375760949127 0.29172526594038339365 1.2895075909968438665 -2.0977907427299506971 -2.9845381434043432023 0.80476426451332538914 -3.2948972541684047322 0.052815840616867212876 0.6581785284493963939 0.41304877140597606733 -1.556752679000059203 0.016369352556548096012;23.463093066322151969 -9.4780904938968433271 -6.1372131996142851307 0.43523298781733182894 5.6105390091576561318 -7.5017973590912072623 3.6851458653643480723 -4.634743336250039647 -0.55322225011329273503 -2.7434892923410401089 -2.8322450953545055263 -0.63478238772811756974 -4.7010524558832935682 1.5449670747776798052 -4.5213376019984705678 0.65323909685024095229 -1.637242459728945887 4.040484221695189504 0.81125025394048244642 0.30330470109493923303 5.7837201970798126638 -0.3518808501836664937 1.959572004825225644 -0.30993904024080320969 -2.3299972663908441461 3.895373518703249438 4.3712379838525521336 3.1846002396367496523 -5.2152410542141582894 1.5001585646620358983 -1.4956336431763790351 -0.92831710916075582674 0.21180032838362544689 2.7566780949658400424 -0.42124303999185297442 3.5504330863770228177 -10.217285594709204943 5.3374060161101866129 -6.5699604674287694905 7.9891459309942387534;-22.440266287596930539 14.785811950673570792 -14.730624761335604944 9.7868021734573176218 -13.550611527353211727 10.449107667014597922 -7.6229654200995931035 8.2230911459666664598 -3.8972222569894401367 5.8200221981740947186 0.78021683557734000658 4.2900066305397075439 4.4804316328482833853 2.1984060529784823501 6.558765267751526018 1.7481960587905369664 5.1581874756478365285 1.0023119762643679653 4.7684070353944303378 0.55129824009834860199 3.1141979330512192803 -1.2980791357894589932 6.1155888578559043367 -2.4980137822481975896 16.216194218132429228 -7.1163901724364615475 9.5742813753417728151 -8.0696019959795606269 10.273188492021677831 -8.0885654501316377463 3.0661051251828999042 -6.352820147724258959 -1.1931242198769582696 -6.5914265612719500353 -3.2208543664277939911 -4.0797118727788390657 1.6372728299987420186 -3.6907442665737622001 -5.3592371418988387077 -6.8408702159685823574;-4.4252319398041013443 3.9986099198439477576 -6.9226326224734755499 4.357094088112492436 8.4522802679978301654 -3.233993860010747845 -1.839034443579889766 0.31252724389607172695 1.9827714536701199766 -0.78285172971574734646 2.4862122634090746409 -0.60294413096963972443 0.58771867272317934727 1.7385099091997955334 -0.11876729315004777576 0.024215996644265352922 -1.0410329463906973224 0.82464695451952618743 2.6353538984888542629 -0.65934847567134868829 -0.14280635652884987596 -0.77040384709013920439 -0.10867337215769129477 1.6005284424365466833 2.6334052420510660752 0.37291804851564303025 -0.034009665862908287914 -1.0399497760171769745 -3.4522034326660335779 0.0030501414302371229748 1.6200925632884661809 -1.4843397766010231198 -1.2666908786734647485 0.76259479098459670432 -1.7231745358557573056 -0.45087455259019221243 -0.93361858192018509772 0.78150692716077363453 0.14585056238472804413 -0.14549353055959479697;7.707373382976350662 -11.043881646671946939 2.4066341642171273918 -3.8023432458410506563 -7.429900013986857843 2.8299500122433705052 -9.0203639559165509354 4.7738886133443845239 -9.0681614593458483853 -3.376659651883175961 -6.7590649388177386214 -3.882344201086589397 -4.0383587922965631378 -1.8895245357160228572 -7.0345292660312770394 -4.0398070500512286429 1.6662917996325441461 2.2085830841467939401 -5.3315392663310969823 1.3049287049669142657 -0.54832598401551180256 -0.81057375442217838302 -2.0246579623571192563 0.72294409955276173196 1.7112871598561703035 0.59961497073003411362 3.0074714070458310466 -0.3205303838819678619 6.37900643100103526 3.5101615845825304696 8.1340626643456399592 4.7746992128930925148 8.6850124134002655296 -2.1363456521636305929 4.3321897829670001911 -0.47378283778373142532 5.9357456906680781117 -0.45539332968155565862 13.100179443064984497 -1.0261395945982429989;22.885590062870718953 -14.612797511102792569 17.018988822602384658 -11.505350545986386734 13.974035666381023901 -10.764784952041372534 9.0148912761175399311 -8.4454682130900735615 4.6604301756270825052 -6.1938386527216859889 -0.36327336849579749956 -4.4299625896259309243 -3.968222388166311454 -2.2270703866544736549 -6.4441212409109231984 -2.0029321163390862992 -4.9392578513761282721 -0.81810398059231503876 -5.3072268463611615985 0.068851962758035775702 -2.9559375678591450765 1.75317426466477988 -5.6566128388510330538 2.8039245238082592948 -16.33744734065382076 7.2838305446266007337 -9.8918666097776632995 8.2326703963577543277 -10.234294514596166792 8.362046922587420994 -4.1670932788800758573 6.739086102444769466 -0.14051704924922092665 6.4560714663291545179 2.3968147864216202692 4.370397751593675828 -2.5416180272004189611 3.9680850709768349383 3.1560448354458352505 7.694966821815949487];

% Layer 2
b2 = -2.8181032382367492417;
LW2_1 = [-8.7332797546515230636 12.201179239400921972 30.82304881642100014 -7.8681544835140080352 5.3817868069421201938 7.8717389302885649727 -14.182037325449874388 17.671550888204613727 0.30738874193751491992 16.636375542865739163];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+19,21)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20]-1,21)+1),40,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 20);
xits = finalxts(finalxts<=20);
xts = finalxts(finalxts>20)-20;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
