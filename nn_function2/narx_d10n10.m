function [y1,xf1,xf2] = narx_d10n10(x1,x2,xi1,xi2)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 06-May-2019 21:32:21.
%
% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   x2 = 1xTS matrix, input #2
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
%   xi2 = 1x10 matrix, initial 10 delay states for input #2.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
%   xf2 = 1x10 matrix, final 10 delay states for input #2.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Input 2
x2_step1.xoffset = 0;
x2_step1.gain = 2;
x2_step1.ymin = -1;

% Layer 1
b1 = [-3.6999350221322209187;-1.3967522163318353279;-0.222264811487076136;-4.2615637648878843535;1.5136027987937568096;-0.077973340757293119196;-2.289445512453050835;-4.6318567616529158215;-2.9895203877210270171;-2.5005745812556856578];
IW1_1 = [12.824085916502880877 -11.600952444050486534 -2.5059313405858283375 3.5821341091436260662 -5.7421415767491774673 2.7378384681618013197 -2.2266572958015791173 0.56298237818223895168 -0.35856768266153821179 0.8113771510200571413 -0.20300875782695115834 -0.35770247358372719848 -1.8668435526823474735 -0.41444058028051050657 -1.139941982957400235 -0.11969340344685026889 1.3709929564001430702 -0.90988623416241154462 1.1494744602057709315 0.65035132165044240438;0.70087718186900116457 1.8915756030163275447 -2.4928786399632456572 2.0868518464020335834 -1.9914362297730134888 1.0679599809561572954 -1.8656076147760505268 0.77926062318595157308 -0.1948640584893489569 -0.59558510181470869504 1.8230725528635034483 -1.7467144692169116471 1.5782332205088707155 0.12696150999184846464 0.23405257895012449021 1.4153290163600376061 0.48463418773308236664 0.99573736288318104304 1.0564918876675870596 -0.69505873440550813847;0.21877432005737063037 3.0332686004737192675 -1.3602592103594517425 2.3128901557478940276 -1.037299322421394665 1.0777747779610558077 -0.065196685999985515281 -0.1006652779147629434 -0.063406073826230563428 -0.15787469228655257036 0.67897682661167546581 -0.16319601015941562205 0.70089302460446323284 0.11521792369102168418 0.27728172669950029716 0.28761230345459498636 -0.15180962110521714625 0.17250632147825656348 -0.090656243675473410781 -0.55148031340871417338;9.396037341239601659 -5.7765179801939838811 -1.937604882806145401 1.291546192587547992 -2.0509472705483298149 -0.07604939827026413468 0.4213816761332926375 0.64384293828332739285 0.23103435935623489739 1.1053942081023993005 -1.7264120567788148186 -0.19241091394246648272 -2.1916921873306938195 -1.0833006283902408828 -0.40851816305214089242 -1.0547382311007349465 -0.076659014683124443446 -0.51589562175878211914 -0.35205391607198721626 1.0238058149816136044;-0.0040985178100159027487 -4.6660456934469518586 3.7865236399316701821 -1.1058538261054375873 -0.29675841349874471087 1.155923298833553714 0.2828013861661126116 -0.2714062831554064914 -0.45056995216876971622 0.39973502329320048654 -0.47255735173208601729 0.87783317510924618876 -0.19609404604306918118 -0.23811331717654662943 -1.73430501662997405 -0.99957448095335366123 -0.1747384239130465311 -0.64598822380513976071 -0.042711439935051408179 0.43611812228867352648;-1.6638447423430740013 4.4793132510197848362 -0.61351690162785188498 1.6824054881135657169 -0.81016422271837362779 0.66072904496878281932 0.052551140975886027895 -0.056287164630458894066 -0.046165026189880151164 0.1467634992178551423 0.68925745123567594419 -0.29033815499848381059 1.4628347667036423196 -0.073415091337212606826 0.39463068536494949612 0.68798278813320268288 -0.48709153088005968657 0.16021751368651671044 -0.080589323792606956665 -0.77095260603406101652;-0.17222193414527231514 -1.1819467615798322502 0.94700567322087003674 0.78467314696751322423 -0.94947615834206833263 0.84687508214304796361 -0.40628296439768502024 -0.40192624292124917718 0.078947890104997905936 -0.13777343201974828757 0.7194131098168130567 -0.086295259235289717425 0.77360440387343887281 -0.51554363775222311617 -0.051286674353754030387 -0.18838891595990328587 -0.45301426138460654247 -0.19671975626024917894 -0.21183461484478394166 -0.034002727994198997385;22.845012690828639279 -16.755170944572064684 -8.6488101545608717657 6.330491188822582771 -7.1490641295003758415 1.9019563854372976142 -5.4124953687634063115 2.2566961360900235078 -0.30920035256381162014 0.91424454877996719215 1.1354820858697936004 -1.3761039081917973981 -5.6852333822666949459 -0.076603533743269391909 0.73582794065202783429 -0.030351807863125371267 2.0701815190570314051 -0.098336164247214002954 2.2206063378513634099 0.13370056305356919912;4.3324299332078748392 -3.0109514220530502193 0.12860348900124990434 0.6005783158207768091 -0.73015304796336844007 0.022371254585519424751 -0.053284768882832858616 0.28036161420108318687 -0.69520610208229827176 0.58930861163319936402 -0.78890040331915944893 0.48685982548860834429 -1.6472557617875227542 -0.21991600561180862927 -0.21438013890513682447 -0.86629813212606876505 0.19122491268049240931 0.18102182765362412331 0.070311471659707344695 0.63983852927005724354;-2.5620422831045135403 3.1933970078525577563 -2.2428777275912437084 1.0452942121579698043 -0.076621421671285189214 -0.3085449437417275842 -0.2069959475513756253 -1.4440580444706063723 0.2617923130308348334 -0.81899875419909973218 0.46461609763348493685 0.86553985992968407448 0.5093429170050216559 1.4490263188930725402 1.3756731105093598089 1.3583376650859080303 1.0628740946805923517 -0.58776174854802043512 0.47319950756846634876 -0.48876007794533560258];
IW1_2 = [1.9658763097739546666 -0.15302778719916676486 -0.14894907385965888702 0.17789900975215267032 -0.43635652185234885536 0.087481867518084302504 -0.099183242383842018519 -0.16345000855908034532 0.014682086601972161796 -0.18668691450730634518;1.9848017390373056124 0.58365355776028837731 0.77654213129622651213 1.1535776927636156586 -0.00084971929280837875387 -0.082369719653505563128 0.3408065909245362457 0.11792747235775227765 -0.056810495060521069843 0.17410592673829744514;0.78798737042874300585 0.12280484878461610243 0.41763225239412632428 0.48382903282678413337 -0.28635650741998680546 -1.2424025807017389234 -0.47733222584942464062 -0.42582725204768945293 -2.4763819622697060829 -0.13577617536740738124;2.4548088358721558144 -0.16891037292609950571 -0.29208615572758361845 -0.052572846336510721532 -0.097170727639464826719 0.14345326895166632397 -0.075609363995622416721 -0.037383870823279159723 -0.051033999962406428885 -0.13620846577231215946;-1.8010745478999159452 -0.77563479894969822315 -0.53276291536560937967 -0.60503694283552211797 -0.065551523140451678495 -0.12247162263806619931 -0.69207982096274911488 -0.11721820394644838492 0.019962996116811328184 -0.16528400591077793691;1.0592460765397158085 0.13133018838588911281 0.47712403867513702993 0.44036658257204891465 -0.31112559930314154233 -1.2742531582924558897 -0.5431919097628694626 -0.41680476857606135743 -2.6247270894911607364 -0.11087433125987297688;2.1418373791760219049 0.030753384866708935452 0.20173511318587267205 0.090421019032160154794 0.096053937609839032397 0.45201505346994796941 0.31810015588907941675 0.0079823386671590366298 -0.12333807723315902416 0.2054927556238708708;2.004586290251625158 0.059586645119025186124 0.13659665948587612627 0.24552634707705348061 -0.77724627989422789831 0.070388370197623562063 -0.15203958722945745685 -0.23151493598708530741 -0.0045975121446657288282 -0.19307353664880402833;1.0301066415136208576 -0.1092944886779011332 -0.31148536373925772569 -0.0078248531216877775796 -0.12820638209368107052 -0.41349060072191423654 -0.33079690146646328897 -0.033272844942457351081 0.14026840488464725754 -0.30024933363463918168;1.4638908664245353641 0.66452561101594032067 0.62695962402169214123 0.032816581086774265774 0.20448124948551171798 0.88389795800724546559 0.66616951489963838196 -0.025719398617988362826 0.13243067121575705092 0.1005947480929527682];

% Layer 2
b2 = 1.3397642248105241514;
LW2_1 = [-6.8958465117249323484 1.927839589236752138 1.1080520246442226995 4.6587810181072910609 2.9869348880755506315 -1.1016147343983759832 -0.96244014593179127992 4.2002288198196229274 -0.91562786256878314628 3.3000234512070414361];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Input 2 Delay States
xd2 = mapminmax_apply(xi2,x2_step1);
xd2 = [xd2 zeros(1,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Input 2
    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),10,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
xf2 = [xi2(:,xits) x2(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
