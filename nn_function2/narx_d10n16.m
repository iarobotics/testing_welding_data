function [y1,xf1,xf2] = narx_d10n16(x1,x2,xi1,xi2)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 06-May-2019 23:39:58.
%
% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   x2 = 1xTS matrix, input #2
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
%   xi2 = 1x10 matrix, initial 10 delay states for input #2.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
%   xf2 = 1x10 matrix, final 10 delay states for input #2.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Input 2
x2_step1.xoffset = 0;
x2_step1.gain = 2;
x2_step1.ymin = -1;

% Layer 1
b1 = [-3.4500392264224717387;4.9011848212258595225;-0.57372606065392683927;3.4062599076099857598;0.042289939889202182721;3.4695224634148034148;-0.021611463296435082238;0.62923251333151619669;3.0684912703314237703;-2.6951623709193430756;2.3882643976538040498;3.1143626854786083946;2.9278217484523421099;-1.1146178788733398513;6.0189774579601520443;4.2164198298299622181];
IW1_1 = [-1.8970347531420119758 -4.3845451642075605747 5.746371205691751527 -2.1984815857033455089 2.2918872961455680759 -0.73847865799853495972 -0.13402282092162784433 1.5710146761275598504 -1.2628053909277396905 2.4665383510281042589 0.75139931199522203009 -0.87456646520064906802 0.80179695994198485476 -2.2794316977598665375 -1.8007669378358033274 -0.3112669584527552602 -0.7067994083266324612 0.3666965400066822256 -2.4913722737104739835 0.25926360418479754699;-29.792494460317637817 17.077469979070855288 14.843922257500073769 -4.9386483023600362685 6.9799601872802519154 -0.17053238168707976485 7.017809776906497099 -3.9430570872040804353 -0.37907766977170281875 -2.6736798639882919382 0.085178122268660658167 1.6485234396057055761 6.502052457991536194 0.62377675611754734852 -2.0641385228058397594 -0.26899910553135863989 -6.1371112776676914891 0.7612611873274784946 0.78224143420433844831 -0.7149104416780179827;0.2235935402715640008 4.8808509795035677215 -1.0593896832572737843 2.4589484048921135262 -1.3406059787720296939 0.51717360573717796601 1.0802476910834941659 -0.74256566434541548816 1.2139231382839970053 0.27788736720573165018 0.1008577076121456445 -2.1730355538903753931 0.50814575016690621823 -0.40839179855539076147 -0.23697960293286324251 0.19343400995694007283 -0.98139513666319255769 0.78843358406235830582 -0.15328093010429610921 -0.26677912482620075307;-0.15196758990021472235 0.44188031426861712481 0.50629637860967091623 0.80649902650155924633 -0.042423840082133720819 1.9878867009644343167 -0.83587820699139081526 1.534849892162814422 -0.81319672141699528289 0.83687167946865470558 0.016820835737385304853 -0.1400191022753559944 -0.044480000716972445396 -0.28479274940455900911 -0.063280111458559495929 0.61368010168856546027 -0.26258228442456854612 -0.22751107914255946918 0.27089550241978632705 0.2004048800381297013;10.106717958746335384 -12.394364185874062301 -3.2720982215736862386 4.1118908925471115978 -0.16211591546641226924 1.1061202629537441045 -2.7409856031505537288 -0.57547837301878768113 0.86849754989266614302 0.9527566695839672084 -0.54457614787481467555 -0.18333536436733297026 -2.9835840773582575913 0.050944339110216577127 0.76217480857902553115 -2.2831269630108614876 1.1491591712250388557 1.4710361869700681048 -1.4872791361486297212 0.0058969854740583346753;9.8686299747572974184 -11.458983210719216217 1.069307292747830207 0.71329171883247188823 -1.0620801858966204545 1.6930768602461421235 -2.3899216981496644863 1.7978068452377680142 -4.4843085924723524727 2.2853843072923858415 -1.3302007330097354032 -2.2703155042473159853 1.1266693026470491201 1.2385759292952309707 -2.4529812553108176765 -1.0892366714497421221 0.65962886886640337281 -0.71983747238116280176 0.5208099674686197389 0.6171074000596918907;2.24043323133949146 -5.0423020421599238361 3.9636000363080476916 -4.2219263932871804457 -1.1161944298327035607 4.4608766631686602722 -2.613501522611466843 3.628164511693193095 -2.1102129906527387071 -1.2277515181525819887 -0.56596608983250029645 -1.7504554954358158003 1.3955735629004719645 1.1073676282757523026 1.2956917622686918712 -0.82440270136700743997 -1.5778531529301313974 -0.016292007640649378009 -0.2256913797761763707 0.5741317728204797799;1.1547093791942519836 0.047690002668690438525 -1.1035821122736866329 0.75374275043203531332 -1.0651521890449227037 0.36601227993412183137 -0.095761944807751603337 -0.29146099613101350556 0.59269635870931092203 -0.44654197227101305456 -0.21640652001900348433 0.39102525363190426821 -0.55305316711335461566 -0.018860850120818235809 0.48624168439174292322 0.19239209054380404518 0.42228746282654888722 -0.086598048410220271331 0.22774593960176309215 -0.014306380176717656619;2.5158842596038901718 3.3099880388606006676 -5.2705218669573916657 2.3987705931557070649 -2.7510547942627066043 0.85195698409949838226 0.025880026501850859899 -1.4334163613150552319 1.5101408061765904112 -2.2350939720888942652 -0.7771366433211215341 1.0042609605863792588 -1.1662850044256050097 1.6935177340509250943 1.839400851886388466 0.39884204530533673427 0.82063381066436225098 -0.35864604872739308528 2.1493915303413122508 -0.18132280027471467387;5.8234909652540540748 -0.61885759955386965281 -3.0071179866908992473 -3.8614655305706064858 1.9001902602924851671 -2.8219423067381472769 -1.7680161704035297632 2.5765480568719563159 -1.3043972618350447856 -0.7811274058049224589 0.32989406167951362825 2.1187624413837475856 -1.1950923089190901294 -1.3085134788785524051 -1.2175136277843914279 -0.081130907952404324179 0.83904353545963406003 0.60586205451724417514 0.65459697664949789697 0.13800250511759085126;-0.14973149943398345041 0.26232974771092887334 0.70463894718807451589 0.62136716098505662131 -0.74471170513252804568 1.4605961141866381503 -0.094212133345405277285 1.3491605238700603575 -0.75379502469960801836 0.53267288469406215423 -0.1503341892782747713 0.15745331852185567856 0.11708210617118194885 -0.10992118900220118616 -0.47812865061228110308 0.1911567406097051669 0.071843435304170213951 -0.27542646312674445852 0.47096427940104385046 0.35046339660532366267;10.348413326668969958 -9.8136395593447165453 3.6516374171134029503 0.79094748614401566567 -6.374203413701029497 3.9303637143496383821 -1.0865156607367922881 0.4415102043496736961 1.3414247504227179153 -0.46561369496906679366 -3.2700545520778172559 0.13510728856668574593 -0.70689186689512351069 -1.7711336033911144749 0.11114411875623556036 -0.35494597266934607704 -1.4428451270945255036 -0.87614884111770863218 -0.9033712624218053211 1.5734286897691158735;2.4026852717192226372 -0.88213777868683851402 -4.7691647658172096058 2.8911924183989241577 -1.2951617118684812802 1.1526988340451851389 -1.6844231091326962169 -0.46036870642193128411 1.5507192156776818948 -1.1107986691524267542 0.44239706068855000343 0.23918170056506493637 -1.5987596077508219317 0.65489229224752587566 2.4927921098671608213 0.1908808322774861177 1.3375732579665089439 0.45751415472466883116 0.58523949842198064175 -0.58338342032396017789;-1.232985236437023957 0.91113693898877012867 2.6850767411197340451 -1.3084708590252882576 0.39401791618722942223 -0.48849107461062979407 1.1000943512488610132 0.2135855362284583836 -0.51616593317676295882 0.48200823876514897748 -0.40261693773823792331 0.32061297258898396878 0.29037797398050679831 -0.75595950900270336703 -1.0573237750497928022 0.064453314430294381121 -0.80893064395652580778 -0.31043079185445143775 -0.33743797560912414113 0.3795914789525976496;-5.30939689265157444 3.8891673676489677547 -0.11943011981590435922 1.6623096765932809937 0.031131810429316023048 0.80700234480620702815 0.42346484168882436716 -0.27761270190480014097 0.0039357594639592707875 -0.74077645338999031921 0.039265161893810865412 -1.1270281533499117987 2.5585544577937073818 1.5379237674152608228 -0.38951460166022255915 0.49403683243749602072 0.30635585667162845702 -0.23455349739412165166 1.0010440708038390589 -0.48976117605576274805;-18.041755000091569627 14.221904994647330156 6.2232567977059005671 -3.1013945509883842355 4.9143466053974043106 -2.2914871562152976381 5.6802204324011249525 -2.790967794821198833 1.188586978300482766 -1.5482357826617638707 -0.058257135854659927721 1.8757117932873754729 1.6681946763783470633 -0.0935635216021725169 0.39346643034529993344 0.00089008732055240180614 -3.7411414627828221136 0.36764304754479082415 0.17729599083784883251 -0.44939490762920253353];
IW1_2 = [-0.51300279303335205583 -0.47753893416473308653 -1.6313628425773738506 1.8337723519748039269 -0.018519009133668992012 -0.11829114829061555814 0.122776747771623021 -0.037675188351488100857 -0.062316099786259564197 0.00050849536749086182708;-1.652432519548650669 -0.55971303392480376004 0.089362980954569209979 0.41374044483696903463 0.11002434959190592056 -0.065870637475023890994 -0.071647665287742690055 0.23689979162270585755 0.16734738701058593513 0.09809934796360696152;1.0647089726695222467 0.45777937408320973356 -2.473335375542417669 -0.13979522146343875688 -0.0024499023602843339464 -3.3803503120665494563 -0.24119625137653794011 -0.45498231809082345656 0.19047981835145949558 -0.55148993547977476215;-0.15522627231354621524 0.42798256721648753054 0.20649500940229964518 0.77582470952459692271 -0.21910352419144485392 0.10783149976754652366 -0.068096329322706206089 -0.12051707130288458192 0.19852020917260446153 0.026042541283332332203;-1.7380104423128290847 -0.92122915970044394474 2.6551681732602112618 -1.981501026763925033 2.1707836195393612755 4.0122285347261881228 0.086799287924522530724 0.019156006077402920607 -0.18096257896065651161 0.13613100242239004056;-4.6932806450301614021 -2.7634067608719647957 1.4171932345560815936 -0.63853698130179803449 0.67034168688798134728 -1.5145932426539121529 0.048369771849514658912 0.052017481590593196705 -0.31975143167285424717 -0.0077382852058401219858;4.3471695450926421955 -0.92438686780769940832 0.059344565042882664596 0.030175873595444237946 0.47146363291997234191 -0.20007001427787007852 -0.35356967546349982179 0.053268876591373387486 -0.28900812776125733849 0.22917487212192449997;2.038026394347583814 0.059537928589479989505 1.3950181329247188788 0.31048200088207456027 0.42803351437725900563 0.032686133450397343581 -0.0014589805433368125201 0.015067126799995883904 0.0083204266136852715607 -0.011791898229333517764;0.28738537571074745935 0.42307912678094883319 1.6125693330697645766 -1.8522593456126050793 0.038048429565894381632 0.11193696135278535797 -0.094030832916739068295 0.039353871747716796803 0.05361846259427748701 -0.0092351120627798821694;-1.3202681644055156429 -0.22459082420678699865 -0.29729765940497676624 3.0947648798121254465 0.52338418760021232501 0.16963260779634736775 0.053452668208999909449 -0.37492081351472966722 0.0674881031248288632 0.23641831142730754256;-0.63432948274055955817 0.41019432605126449065 0.10403141960008106814 0.68203016635942970147 0.38670447307723193608 -0.70124562560229120045 -0.023197778979160456336 -0.092679196291531221186 0.1359385143996417189 0.018811488474213999139;0.88027876624067968869 -0.38043036179472411451 1.875373552286459411 4.6358406684528610242 -4.1030765771630282046 3.6890319310933263885 -0.057626022412438443476 0.07937477775316345574 -0.24002931298765978196 0.098474846521603334737;-1.8630328854513682479 0.0011827368487593173732 -0.056915213804701977884 0.26411848384574815318 2.5040588665437928384 -0.0076617348378273698872 -0.11806489770069771017 0.0035267351641666789749 -0.014175950940618027574 -0.0063010674821288147757;-2.6675915280140900521 0.1109675782756197604 0.55522440270614392688 -0.35706983586529505992 2.4356366006224243748 0.23877067180310226902 0.087905771958610059991 -0.01028805271981827682 0.039451532771397491983 0.0056982921295321113664;0.8832485111465441241 0.51959847295285355173 3.6637293014315530648 -4.2329812563140407633 0.83281902897915993655 -0.040276161898377037252 0.37700925887989444885 0.46803791848523357277 0.08432491493107828473 -0.049861183603636630157;-1.583143372495442236 -0.39045235682252937837 0.44797376743493833029 0.025957446441750992028 0.19959909646555407114 0.00053457071378359283242 -0.07180490834393506161 0.16868826832854036391 0.19241823544565342385 2.8277821674447395361e-05];

% Layer 2
b2 = -1.8090877056916516707;
LW2_1 = [3.1073037681718376213 -4.1479127048116861687 1.23025748767499854 0.25218931189484633526 2.415832244220581515 1.8678286225161044865 2.9907029654837415933 -3.6042301691358900051 4.0766491195673255632 4.0130817143794006441 -0.34584965350888069446 -1.3413958523227909048 -2.7409070172596230464 -1.2723294019399755683 1.6714473042417354876 5.3166505949284488253];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Input 2 Delay States
xd2 = mapminmax_apply(xi2,x2_step1);
xd2 = [xd2 zeros(1,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Input 2
    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),10,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
xf2 = [xi2(:,xits) x2(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
