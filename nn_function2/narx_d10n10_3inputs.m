function [y1,xf1,xf2] = narx_d10n10_3inputs(x1,x2,xi1,xi2)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 08-May-2019 11:14:49.
%
% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   x2 = 1xTS matrix, input #2
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
%   xi2 = 1x10 matrix, initial 10 delay states for input #2.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
%   xf2 = 1x10 matrix, final 10 delay states for input #2.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52;0];
x1_step1.gain = [0.000550206327372765;0.0045662100456621;2];
x1_step1.ymin = -1;

% Input 2
x2_step1.xoffset = 0;
x2_step1.gain = 2;
x2_step1.ymin = -1;

% Layer 1
b1 = [-4.7358374680143340285;-5.0155991819271434906;-3.3914293146647467303;-1.4510519667563646085;1.2091003423427761909;-1.2109710874270516179;2.2529352139909195607;2.5914535629045154508;-3.3191863501028877614;-4.1677387197470308067];
IW1_1 = [2.934801803486058791 -5.4014898672705449201 0.47301022335678710729 1.5114107469352342505 -2.4316106590903783236 -0.26518800313570772831 0.48975368265275132096 0.65224184291286935178 0.16017921585418173902 -1.2809118599403319649 1.6957021610922544674 0.21558695627166410413 -0.58786176798526457166 -0.34455905659932695162 0.54118263351840889541 -0.21686515206915718545 -0.538450670468745618 -1.8003081039239092753 -1.1829784850383373573 -0.78564801067621425901 -0.049128904048270714833 -0.54404960694013126954 -1.2790955048951235806 0.22422724304931720973 0.097188826134927741585 0.48150870627424846582 -0.069437435203279357365 0.068842666124166035369 0.7959684080235847059 -0.04748168459000320224;23.91017141754221953 -15.481669381999640933 0.91300494937549725449 -9.8135192940140445472 5.2459746529993269704 0.098602071368409677232 -6.4844729462045576085 0.42120955731577125469 0.083516670142153512368 -5.4250228837535408033 3.8643222088453907936 -0.30694608387006627748 -0.68472547304872832807 1.3452328756926668074 -0.37507393374904729466 1.2000683965684462162 -2.0875936109142201325 0.14015828028342486311 -5.2681065442272894117 -0.86813154192676045273 -0.38316899733173576115 -0.15766894772754516674 -0.53538561591411193419 -0.10693319237710592617 3.6440257537741258531 0.050348753325926608182 0.013250572081030358162 1.0689868982760097893 0.38487007941619727491 0.26151838314600800439;0.91483141707178428081 -1.3766934092213756191 1.3461312235252982372 0.51384714818754073651 -1.4313276871602267359 -0.0072917182178903940798 0.6529950559618098449 -0.10155299850332155653 -0.018868283070516179284 0.1002413816302318017 0.69493229437414583138 0.59947024961995776238 -0.0071537032997473978813 -0.32622205819902155843 0.54578023471419534474 -0.42605239368293590374 -0.072633447026934278012 -2.1385700077171598821 -0.92280331028663287185 -0.62197543018770573564 0.089375862190699095766 -0.068350277755384492018 -0.46659192461485970993 -0.093551438028480801701 -0.10581363956530936976 0.15883732233608016671 -0.00079542424146195360099 -0.1015680440663783296 0.4753309299812316091 0.13236221282141674704;-0.5862317220603320278 1.101144738176765614 -1.0396560344015746136 -0.17219023812104325422 0.85468880807716240966 0.30323173950895948581 -0.2828516433102046812 0.40730401610653116373 0.15358106382829131431 -0.068318356942112440366 0.20980701720797459431 0.32973289978122888311 0.41190992613396948396 0.11499119759735400292 2.2995471885217164676 0.30375723361204126638 -0.51694057760471456842 -0.096786819496475356983 0.32321492801661710903 -0.25535099966138657956 0.36451685312666959327 -0.28554935494651778605 0.79217753790971656702 0.023324402163495596557 -0.031694719075811533804 -0.16917900570745483813 -0.12614648482385265593 -0.015933992904360639448 -0.37876708971218064903 0.48911872005132817076;0.90071736331852281232 -1.3438192907807482435 -0.35233850321892756785 0.2587499973383947105 0.22592736042840488864 0.20843804030079760015 -0.51449013829101453155 0.44085255877736040375 -0.28062972837711097629 0.0047566286808428150101 -0.31494569640033120983 0.31854249782637994448 -0.073086830591055140793 -0.39532001895942853187 1.2093209747762276862 0.012052324076888250651 0.059317015260463373805 -0.26466179101437586896 0.21600289682789416967 0.21243592762234791982 -0.061704870251618991472 -0.27017556531199399261 -0.038831944265582951648 0.028824766834389288495 -0.54016722030465058602 -0.10055543825863053065 0.17455173586848071743 0.22598320349414130481 0.16566275850250367085 -0.054725214076109210404;0.44831183618117026457 0.43029110637053757937 0.42722169945837557004 0.093691590035188496155 1.2369543487216176914 -0.057950059687306404443 -1.3736844677787038993 2.3470554206700389166 -0.14104932726505770013 -1.4327938893821887678 0.28163791996322556921 -1.0077925034381001179 -0.017267194206073865903 -0.5009661876675978176 0.1192486239525211017 0.72225590432274444641 0.080152090552907395704 -1.331923345911826706 -0.23950136100975147335 -0.24593991133756523682 0.079802445267682958763 0.58435018924117321237 -0.055153151375197911888 -0.22450715284631408974 0.4415899494555895477 0.15859593128643095783 0.25181579830435607548 -0.022748965771400710134 -0.077812032535023098467 0.083443542470294798652;0.78840832467364030389 2.8615156787991793408 0.29055108581986582861 -1.7929005761311660461 2.3450225085286557913 0.39302303246639419543 -1.0234609587358809435 0.72075852656691319353 -0.18128921548518503459 -0.15356827333426373294 -0.24006350735947848407 0.18713548396107482219 -0.24284256235789286604 -0.38810189767870861832 0.090855813363269088967 0.069802572645032243126 -0.00076145535025592785139 -1.531493799818071766 0.41415009930232071778 0.53641189220455021136 -0.082890103349638255548 0.51033152877088527877 0.50522787578863981306 -0.12177887604356282814 -0.0077636293875395882835 -0.13365894525554392058 0.20193863727494978932 0.3272568031172573555 -0.41196798627507108526 -0.17946442221005387552;9.3723623998512337607 -7.7399265369601337738 -2.20072617774439383 1.5206412460400264841 -0.4784493327986174549 -1.5617856227351498699 -1.4371873647965269782 1.1431956634046269716 -0.09934007359402045878 -0.41202434957159678186 -0.10213626322901442345 0.60743460545489269542 -2.3398463133604128217 0.7308200995751709117 -1.0129831954694397123 -2.4591632440779580548 -0.127243426460665221 0.40834515597482157201 -1.30226470455657517 -1.0391074610393136179 -0.22791888508600707808 -1.4840154869611628108 -1.0881688980061490213 0.087840136611644206721 -0.12377005953788260129 -1.0464411201368657434 -0.048283993052237780819 0.88019939623429299669 1.1378523370515554181 -0.42612620466556033749;5.795075007766341102 -3.6547684581804866788 1.2537121620522546639 -1.7109778257517893607 0.55660069922914934271 -0.0072752654194729801662 -2.9249450744392087032 -0.38927087032064622285 0.33656378028724787121 -0.010201233516243538024 0.72404895608049257838 -0.58859324844152027811 -0.1992954153898917613 -0.32253655756533122778 -0.13434436810317057498 -0.20708996072198182503 -0.076134916888169201776 -0.074200698928450964376 -0.65444112024953171591 -0.489445022218882142 0.078010191330619274575 -1.0909466505733500519 0.25048926608582716691 -0.36560744415878199121 0.71812151981539207313 -0.60206236678883184865 -0.19800587624854329438 0.98519669654838826212 1.0440327251768528605 -0.097165746807035782706;13.571260831455280282 -11.038705811428737746 1.0695481163957960558 -2.6302380768236308661 2.7578105831574681872 0.015519863502109182418 -5.4795181231537348765 1.3378929486299202534 0.14471622608947384836 -3.2827599680710783936 2.085714595116199721 -0.31954819048459814912 -1.26885015932195655 0.99797965084158157811 0.086800937870170832844 0.15380394677209435761 -1.6184760161106510612 0.0020463390160808357654 -1.0206281608913478909 -0.47219580944425820768 -0.018735880535338925862 -1.9264659309958620526 -0.028843866264979776959 -0.13531997432633260936 1.8541679770274697159 -0.82380821531587511419 -0.09844263709657732897 1.5731554271682679502 0.67628845584547370162 -0.099997356135227213891];
IW1_2 = [0.94329414255262167277 -0.050626658903949177393 -0.19045886556254745803 0.12556070599087282291 -0.1144498794515675516 -1.7429945996265465702 0.17422700366171109398 0.11984062079948763768 -0.033446888869179000614 0.20871167622031799871;0.6397356072951203565 0.10343688515237671466 0.098152602537131650173 -0.12805241656784532855 0.1726088477464390869 0.1502750670625095375 0.21930899674888354456 -0.10195723082772668866 -0.21053948999809404818 -0.45752137785701940675;1.426105135466567253 -0.11144280239467080351 -0.017654252264022500529 0.70660046819891375591 0.35741344972573285688 -2.2558649759376345756 0.095998253494912477723 0.26921431239224802301 -0.035787188509932732483 0.60254893564699074648;-0.88969931475373409402 -0.32708336233387746983 0.16359138728777314342 0.35802083701730053056 2.2003768842851827436 -0.27995049616897321743 -0.10041007916737673678 -0.089570920105593879179 0.12717608448850833969 0.72390937579374148303;-0.0063489851617231501946 -0.22868295175461428315 0.40072126912036509783 1.0165733217781465214 1.4741875609835484173 0.0036767324107439894321 0.21700052734558794576 0.13643229928336614298 -0.27951770304888995389 0.093715690465177747814;0.065590941109927747288 0.4702881445839753316 0.12600457592343636271 -1.3160190124895132513 -0.082766637636183776339 -0.7107057178024618338 -0.29990668047246965555 0.033286263979391418621 -0.24451106616977405506 -0.21300198519629742755;0.87042893233590390434 -0.028907335598899040752 0.28507753970806898325 0.1729224005284775989 0.52247201838948131858 -1.4402812489346221714 -0.081691783337129800224 -0.13582584914634701634 -0.19650226959780295322 0.028690109232833681252;-2.0865279718302134349 -1.2810588319269233804 -0.2933181971372013086 0.4839429967834095736 -0.46804329788586707117 -0.011452159032581709849 -0.097748519949602888368 -0.0026872269471224022319 -0.16241421821601306763 0.16506648802542472909;1.8353326522238260221 0.066160982203698079362 -0.00078297004194097068186 -0.45776502011129155401 0.3465708678000470333 0.15545308401391658149 -0.17080034335841323689 0.3051922757231819161 0.18470716605153447709 0.15476883060193483144;0.53841720551014649043 -0.078624528750877123451 -0.17866535215184603524 0.079817734467663215003 -0.3369079869420081863 0.31054693380579900808 -0.16584508569535866274 0.015799564864618028531 -0.073969622768812193225 -0.068203488685737750918];

% Layer 2
b2 = -1.5365252833141636035;
LW2_1 = [0.86509770077574277281 3.9176460900741605364 -2.5417835949256217809 1.6873946756851720963 -1.7053677344228637125 -1.4813464816408741243 1.4708738905144855824 1.5529549689073778307 4.0077451465973812361 -5.2390853910498442758];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(3,1)];

% Input 2 Delay States
xd2 = mapminmax_apply(xi2,x2_step1);
xd2 = [xd2 zeros(1,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Input 2
    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),30,1);
    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),10,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
xf2 = [xi2(:,xits) x2(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
