function [y1,xf1,xf2] = narx_d5_n32(x1,x2,xi1,xi2)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 06-May-2019 22:45:57.
%
% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   x2 = 1xTS matrix, input #2
%   xi1 = 2x5 matrix, initial 5 delay states for input #1.
%   xi2 = 1x5 matrix, initial 5 delay states for input #2.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x5 matrix, final 5 delay states for input #1.
%   xf2 = 1x5 matrix, final 5 delay states for input #2.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Input 2
x2_step1.xoffset = 52;
x2_step1.gain = 0.0045662100456621;
x2_step1.ymin = -1;

% Layer 1
b1 = [-0.96096767661185900078;0.081813392885485641814;8.7616564451867944285;2.0529499084566165124;0.15925306083603368856;-0.024565475499340953813;-1.797598583158460217;1.223852787091658012;0.87207108033610791775;-1.4802975770611461748;-4.8482966121808077631;-1.5738730158415972227;0.49655798232055053942;-1.9386040142236720119;1.9694998736527380423;-3.4928004263382348427;-0.18459987398987401375;-0.5217655285526321407;2.2095997369717061964;1.3599255354168109378;-0.30387759413663745223;-0.63998700910970185429;0.16024660115812308647;-0.039697976835735518386;-2.3140445901670179119;-0.63695004472161231845;-6.2853020236886738559;3.9213702864116632973;-2.9958278801254691892;0.29811350639875838775;0.38810844472855082765;0.38198694206756517167];
IW1_1 = [5.2341318864660246746 -3.4304454339870975588 -2.191634927526899812 3.468153017763830448 2.1739989503887522382 0.95875062557776424832 -1.6587016622819357181 1.0375936190538139758 -4.2312491053360279381 -0.49980328902159171234;-2.2801790905319503366 3.5620268790987830165 -0.49477622957324718378 -1.0604262551049299379 8.556518768896109961 -0.65470018083941206033 -3.6872220911261077703 0.26295056466184923982 -2.0880987737121103898 -0.99559146857022828847;-7.3441403517817418489 1.0005581339959890297 2.5336822392213953492 0.78627400374612466116 -2.0952961717475533376 -0.12770495175063384385 -1.1501436497712678175 0.57247869405338414062 4.8633126462870714946 3.1298851731692782785;-3.2931209817726316835 2.2280764661988610165 -2.2685567231713132941 -0.021324020954959277407 0.57581671891879770975 -0.42145688756574656297 -0.066607235059681538236 -1.725351115792765011 3.9868154711787759936 2.0828151830660210919;-1.7232960230121940892 -1.7881509821104830671 -0.74025760228444492661 -0.33665787513118677898 2.0024093236656717032 0.86460868440355076459 1.0376828931223032182 0.66649711606612949133 1.431097571270527391 -0.0087353342027107639539;1.9169405830874735042 1.5709028705018266425 0.085727659541249168207 -0.38212758875296914951 -1.746288828432905671 -0.28550023372587984838 -1.703250537743959514 0.055971959173755414518 1.004683584485311254 1.5816650269856842304;-4.3618211988472506135 11.644135465745348412 1.7002032816548151573 2.6972178026143640572 1.0299339471725112993 -2.1804626369592252644 0.55901398188619033647 -4.2100735604089694064 -0.49949030175132114184 -9.4252199986800722087;1.7994807312633416263 1.6142631257178987614 -1.5938949301072589115 -0.40485518549915799902 0.73799106326143826262 -1.0054224217089016147 0.7933821873674209435 -0.49873186612835929132 -1.5313491920282333858 -0.58473101493717616339;-29.705430666297225173 2.2042750046445882539 16.336251520445628671 -0.8481962089364999402 4.5181158843810322878 0.27278351736011535733 1.3353563756040898181 1.757584196829937051 6.6236020852549719606 -0.65986288700889128567;2.5202843715063472096 2.9053872340719975043 -7.8629426917250704321 -2.5157735692797449367 1.4306063697845285976 -3.7380371547948310074 4.1165956083035633029 0.35897104507957700026 0.74932793472575609517 0.39940108815702962675;-2.7634435636214100818 3.5664287979645896698 -1.2119703008678062162 0.28916722346870721294 -0.35833524625744800352 -0.84756312731288729889 0.72184148751205756689 -0.45473992856462092105 1.1756959133558235742 0.58700950266626683582;6.8796778178993696073 1.7997428603173943884 -10.133921534006169907 0.92074175007628844547 -0.52890304865137272028 -0.65827645182313143657 -0.081864975993615862748 -2.9989823362100294091 3.9497023842550516015 1.1525210152899689753;4.413369916073946797 0.51517123151734967035 -5.2824898654906409234 -1.5217405082361639135 4.93299472407260442 1.8616883904804202299 -3.2773978906133542921 0.045372171267201180656 -0.70999276072461403597 0.30125347396582558002;-2.0267811148725352055 -0.59476762256803195061 4.2984056293470267462 -0.70334405222786711143 -0.99154392454861217665 1.0829095837018298809 2.3247755483240908347 0.18332860631517230998 1.8077990910488899168 0.78779358895158113629;1.3401848597814769448 -0.41152118629319767162 1.8493507136302944627 -0.54720928130026336156 0.0067099528192680248789 -1.0484607898085926969 -2.0340066283122437696 0.082447755120097790393 -0.19796188315590546036 0.15382728160722267119;-4.3474672175598483292 0.47129712356646596971 8.9225126034412838294 -1.9295366948313634747 0.65627372149756402209 -0.52075456636829675627 -0.56093315712847946486 2.2395857424167999739 -4.3045167164500606205 -1.1071042753167459338;-0.59172088939113332007 1.6204995620320175043 0.89412279096295521619 -0.68521677631857635937 -1.2600088637152166982 -0.039437919667708001836 0.56195103687271230619 -0.33892434875918264758 0.041687505467168116391 0.72871853448781476192;-2.7242533268771635946 -1.7150274288556668356 10.672578084566572088 -1.3796100931778654264 -1.5739661306914558558 0.93363022148303820291 -0.83031073532951960026 1.2353150594266713025 -4.5563028361635558028 -0.77633557081862403226;-1.9435372421765138018 0.7819773422064687507 -2.9663351751972775183 0.80075736618299131475 -2.4603898917586395356 -0.74128294415269946338 0.84566946358617589574 -0.47702633918640519051 5.1598210669882496049 1.8555176295922883867;-38.057282246638337142 2.0168400587064478913 24.130521258908856908 -0.97629299946772729601 3.3066633686789446145 0.39014647437180005607 1.0985503456210143902 0.95429578928264391369 8.3617562987185962697 -0.5730207647553413608;-2.0486079592704475871 2.148580575749016397 -1.6562854614592554814 -0.93898292082002177139 2.2538263310076720458 0.84492232542203726808 -0.45910070747576658956 -0.71249610845868149855 1.6925043703714799381 -0.26037520130941316232;19.135277161225996423 -2.4152066017776929741 -4.945922146503153094 3.0409113641700722397 -6.1968259393571738514 -0.66748454432660830893 -3.7752645049850284131 -1.4675156689597494974 -3.4786641174715131619 1.2617707421144590541;1.8485671091896418439 -3.2806834095347237046 0.74956411407728451568 -0.3811930865369257404 -0.32652818958731866239 -0.42044676471926906158 0.32942761852763513541 -0.75967185713912854794 -0.19974757574650944814 -0.97541861365838578024;-1.2621562994695858517 -0.26926305563610863913 -0.13762617758613826524 0.25899402071982419171 -0.31065873992693576744 -0.62368300165119971989 0.69372879084375238534 -0.29888466590541679091 1.3991978257261066254 -0.22431218630295957084;-7.4297064167540112223 3.76275842422445983 5.3515569060300203219 -6.8691400999557803431 4.1211042689679349138 -3.749497291919862807 0.52355201857540401011 1.3655951203612659572 -0.076797107327295333068 1.1737831976519872423;12.130981620854445424 -4.0989027389386389899 1.7796773599020088152 4.1469652535499479384 -6.7237345545683542269 0.36554739531852659118 -5.9912035109458132709 -1.8836977103781837872 -0.58818432841696866031 1.2572580633056782418;7.1661777851117198779 -5.5456781574428619663 9.5609768362658531515 -0.65566529597738021362 -2.7620436840941229306 2.2693404808083208479 -5.6811522250549391089 1.4246525720273195414 -6.1538194977916456097 -2.429744630536498029;0.44896264430761040343 0.63707096824328568463 -0.65064056225452304716 0.15332553006023180719 1.5340224372273725262 -0.30714557945701409514 -1.5539427254158524327 1.5701137018802371337 -2.7286447418214803129 -1.0763663255829458709;0.32647706677510662798 0.012555718024267203264 -1.8091330603126445364 -0.88609393465902031028 2.4614902803985780899 -1.3670011812021869435 1.4120412560223407628 -0.44914442772594354025 1.2724521583155634641 -0.68100116456575199297;0.34569822085348794749 0.25696926201982089877 -1.180422197949017038 -0.60516925138334420886 0.34745689475894536713 0.024057755091877082443 0.30282084662541919329 -0.1486084454830498558 0.056164517399733993042 0.15051240418545025479;7.6534804782377037213 -2.3242740181332695037 -1.9800101209660962986 1.3659242843569165959 -5.064569226498295329 -0.60165339701089015634 3.6018357174696813416 1.813049241809755685 -3.6273489731091550503 -0.092713907590340385867;-1.3075841949404996001 -1.5354870957561217448 4.1356308310818672425 1.0274192014873686496 -1.7457653021066894539 -0.60445095895333800229 0.0026033771830980337314 1.1563134793624452179 -1.0590697218856190975 -0.79781087953135576551];
IW1_2 = [-3.8976042831936146271 2.988718228490859552 0.7476741233518869878 0.99962469588543356735 -1.1090830426971700629;3.4851766507174910537 -0.90008341554349680091 -0.6593176828359305075 -0.33522400051515666153 -2.0969509251548070772;0.74526561487209541657 0.90213122668308687313 -0.089925262337946829105 0.25715327534039755797 3.9282053853171863267;2.0243603529138041175 0.058031366019033046866 0.11465051847610124858 -1.1679966497200662268 1.0007269979494903822;-2.9516762186554457159 0.45005465138909572786 -0.35096264339949034827 0.33655580568680210085 0.74813608520506336141;1.279140058049871076 -1.4097130487918498876 -0.43759334681759204377 -0.62328746470093743248 1.1805698269431426084;10.584020686999684457 3.2379610369497777711 -2.6876382117799604288 -4.9304934791015844198 -8.5610081559699988674;1.308198846676199123 0.13620309323635065857 -1.5307624086880342595 -0.69356359141293089099 0.32208398121322567853;1.4291388849771888836 -1.7136456671889250813 0.81769419679803367895 0.53398275027276587146 -1.1791337858917090298;3.9504948440318838898 -1.6680077528469772208 -2.5331804440946315005 -0.71701937220645561855 0.58533726954729414782;2.5154107262730360794 -0.055541294549343221687 0.29040065606765325112 -0.61361820390786636636 0.2495619529024346861;1.0205970244325299756 -0.082189714389497930958 -0.16231123681961226457 -1.9554663961457914301 0.32507502975337310147;0.22396605620609699727 -2.5814126691130998559 1.2917816032583593344 -0.62303079311084408332 0.15287067724015038217;-0.54486348841018228395 -1.2270790358696894717 0.91866017898877361247 0.67088878345374280965 1.4791613423872425059;0.26069761395240542701 -0.21399666792368593482 -1.2385148690627676427 -0.30106190832768514598 -0.30405332044142791004;-0.66709697352157726336 -2.256928291140336551 -0.14597079487253605823 2.0608723777706323688 -0.48733684437600882644;1.210431569291988918 -0.80718884392889023172 0.38463490748638112793 -0.37370843286102939373 1.0773254069972095781;-2.1148359088741592871 -1.4935208626587062053 0.57002233956663472814 0.97079167071830774205 -0.42919811002949614931;-0.046207826092467520207 1.3285608516260842826 -0.51641335802366783447 -1.3914228077878891821 2.5740020395245370999;2.0337160985273809999 -1.1247603146882931835 0.53538031584314171862 1.4133884089489303637 -1.3509147854172089964;1.6268280422567660271 -1.2332161991218022479 0.75225086037897903601 -1.2522060767103906365 0.39448174982039013736;-3.3118230033271198742 2.1717084281292082792 0.041182215233495939044 -1.6562015483200052124 0.6555157883291818921;-2.5404978292439777121 0.26528830779305045962 -1.131847947677127042 0.46350468084121071444 0.35622515308266694545;0.061148676129744644614 0.12117498866527125212 0.050014307305349212096 -0.22569427819456353013 0.51850540627246621828;3.4204598590837917982 -6.8084534372785983081 -4.8864657526837724788 1.2709824362914436957 1.0860531379095370585;-3.6817151109517709529 3.0017981088948402224 0.25681062963813028333 -2.5456298088031106275 0.98669206009381993372;-5.4615496331256316864 0.22742983703501748471 2.2267674223565068203 1.563524586750896006 -1.5728635584956474069;1.0210432866449121736 0.18989261347376124034 -0.27984041651999247424 1.6842355257830832205 -1.0986236836351388479;0.95315821276344325774 -1.0950945261374347428 -0.10115706330694598791 0.38015238472648293921 -0.96567862791159864155;0.59597888625149841868 0.431042663875851495 -0.019698508416602065335 -0.45834904191625042147 -0.061274406150244979663;-2.9476203483264060701 1.4152178631770115924 -1.0904049752056814704 0.31760085399702991937 -0.22387199772875396309;-1.4528930408773295113 1.265342910875309812 -0.92466810895522688618 0.88340039388711866231 0.36853080875646709869];

% Layer 2
b2 = -0.113062240514088308;
LW2_1 = [-0.096376135069516616349 0.08806964365625900848 -0.044471239967558848227 0.29583114295365975366 0.028519745510222224705 -0.31976959350241745961 -0.0094271632232246511257 0.39918895177166247024 -0.8087940328845341087 0.067177759524012933823 -0.75449377720519406054 -0.13129739863713041359 -0.70784608222733591543 0.011236000870398235585 -0.45276981863899895542 -0.76100213894317036978 0.36825936820746846267 -0.13259278556164061369 -0.17982524753186407418 0.43825679075655499251 -1.9812961477639818852 -0.86443189998578151556 -0.014079700936767108876 -0.84663552863718527508 -0.018882518551936455786 0.46131861244015381907 -0.1112774466825994929 0.069404858508187394772 -0.022667275025206483352 -3.2613933525077611897 -0.62987787060452904431 -2.4834598735279516113];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0045662100456621;
y1_step1.xoffset = 52;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Input 2 Delay States
xd2 = mapminmax_apply(xi2,x2_step1);
xd2 = [xd2 zeros(1,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+4,6)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Input 2
    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5]-1,6)+1),10,1);
    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2 3 4 5]-1,6)+1),5,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 5);
xits = finalxts(finalxts<=5);
xts = finalxts(finalxts>5)-5;
xf1 = [xi1(:,xits) x1(:,xts)];
xf2 = [xi2(:,xits) x2(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
