function [y1,xf1] = nn_d10_n12(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 01-May-2019 23:07:15.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.6569892238916237304;4.6011101259410160935;-2.1971644881866478904;-10.025367503858969798;-6.7950642636519553719;-13.12353091258885307;3.7201062952300505415;4.7951205726208865343;-4.1470330858099053728;0.5238468546158363548;-12.674379088285014916;15.184092821179463684];
IW1_1 = [3.6580864229981462366 -2.8349710958689531282 5.6121562041171086932 -2.229934353902161881 2.7875136452108795204 -0.30407446583892427938 -0.73391328008680134509 0.56123880057501007723 -2.0725557004537411565 0.50881730618845177894 -1.7720495065250716493 0.47093316012679153904 -2.9591935775024906796 -1.0165258933718919199 -2.5864658010852124015 -2.0045842993484943584 -1.5283594538529667872 -1.4127604419613999376 -1.2947295877960616206 4.4015254505223246895;-4.106765796769723309 4.740205731630243946 -1.1992871628586538879 1.7272935583126758363 -1.7227745255037025807 0.00061466471387577187313 2.1301337460882510122 -1.2848426810087807404 1.4789653733778274081 -0.18857190094624903809 1.264323205024018737 -0.30317459389167428219 1.581893012779080232 0.038686610726932926796 0.14028373137780597579 1.2177483516325147139 0.6004249850041171177 0.41513229244297822351 0.35388614062599199617 -1.7887303450574179031;9.731410448270272795 -9.4849594803247345709 1.1390189653098918843 -0.16762820102156497648 -2.2109108676293223184 2.4555505234858849839 -3.457795917963031318 2.8063387924443587984 -2.6857822611514245992 0.73138562475218327208 -0.35328796962752379018 -2.0420639060870504622 0.48806842385409632268 -1.9287947187637846103 -0.10849745303145533204 -0.92034532570698524001 0.020560367836444416734 0.55625374267512284199 -0.41265444527889322268 2.2263690884637346024;20.746611016512254366 -15.775849456971863916 11.488866076757913604 -9.4948157466218798817 13.122581008721578399 -6.605556378166347109 4.5314680462229040003 -2.140606889168415794 -1.2540242269042043421 -2.2125744498326107568 -4.4881139913489853654 -1.126045179888497838 -9.9132312812151930359 2.0107125898320674651 -8.8489187693602726625 3.8188916180585446014 -10.450367444789405269 7.0505687679521820144 -14.945750286243187688 13.734853173770263268;-0.40478758624412297662 -7.5744406456649100434 2.7578402846372296331 -4.7127422635403473095 0.36336042512558486273 -0.43997859314442061551 -1.6339005996309268198 0.9400506803259933708 -1.3387375246877670776 1.9527505829924951541 -0.72723366815900003512 2.4924240509397876941 0.21097213303221712399 1.8117614502631567142 2.3351793203457171799 -0.23998617512690706421 4.3985803366197506747 -0.64659270977529792468 4.2712213937753471527 0.45194808199779468172;7.9931336954827720831 -12.738435566064687521 -0.39193032037404224033 -0.38392607043517507082 -4.7060463817447724111 5.1831017202036777647 -3.8498887466091846754 2.2092652393015770329 -3.541922718086063071 1.8893358192554587927 -1.3498446589075931978 -1.0583148597884195485 1.0611536568784525336 -2.8856908642006899868 5.7632875720725733615 -1.6086274953592840653 4.409898834521686517 -2.6232664143088109121 -0.15143475753821866725 -2.7081234585627624867;-7.7166828754363860909 5.7148699790951020816 2.8810422593913083134 0.037261053963313764403 0.86101836139092502442 0.020221184919517184303 1.7307580795835244558 -1.3554049078113561411 0.26085677476504043337 0.10327921150688179619 0.74080080778226498062 -0.17930676985158278125 2.2736600816164953542 0.19433159723266141272 -1.7818968813802935625 0.28650320659038436277 -0.85311844844111750508 -0.45948360052352010818 0.32911953016399309035 0.234102848548093323;-17.823003271848424589 6.1958030900824070386 4.5571223207652149512 -1.2853564993902848457 2.4558333680066120053 1.2747952597396434715 -0.07909347876065458971 -1.7437548967537843669 -0.18472468098280336868 0.37725949323684621062 2.3441901665040218994 0.89032347079540630208 6.6458016418131249381 1.1048719278911356412 -1.0288973417727687032 0.93093577236004809716 -0.39006893311653173528 -0.78828898492540711018 1.4494135606319291654 -1.289001704199071785;0.083882991494886982586 -5.9218400383488631888 0.60957790279566570479 -1.3178682586114345288 0.058703334303475775136 1.8647518626338450698 -2.2682859663678103246 0.57805482653858819564 -1.0866532652820148908 0.49672665960255391049 0.48065036339322031456 0.94660474649341119768 1.0259320891785390639 -0.11221428967436641866 2.0637631789092525381 0.50234375359810123918 1.5035355868542921165 -0.33158231303161550541 -0.48957963241730895199 -1.000188972277199051;-0.10511790735527377916 -0.77118838763149144544 1.6038928079156651307 -1.4997719534482190085 1.7244665850977369814 -0.21153555188934203279 0.59460036018563200422 0.04597119052373628556 1.2009972508226844923 0.13997258713504903693 1.007952134991632942 0.36448309140764562075 1.3726694716325500423 0.77987009184733557809 1.442366291989454874 0.95934880284536772077 1.7150540869451758041 0.98619678321755444017 2.0649731110272040446 1.6668612021707167603;28.289781692433553673 -19.491641784244542634 14.659510577601034598 -11.853089901087789926 13.655101242485400803 -9.8704580551476066574 6.4046410987345883115 -4.1570838545978201495 -2.6947633724152861845 -1.9567410999935703764 -6.8433743084800875423 -2.0238301205055826415 -13.724310962765530419 3.4792740967772597394 -11.671166461775394296 5.7828431917403593232 -11.874517680226112759 9.7636198486097978133 -15.419887082402048861 16.328135365816411451;-4.5858005982357639141 4.529429254608607458 -4.6810759095918674788 2.0851761659965690754 -3.4683140651894865947 0.41817837124978085583 -3.6037554170127186204 -0.34233857991158339606 -1.7140655565304807606 -0.75664481993025789475 -1.3341471631069770076 -1.6012347648696654279 -0.86953934054434067757 -2.1094730288314345046 -0.32756461448558743532 -2.2981891776418330586 -0.41805406822025037439 -2.2537179335331951613 0.14418837164602427148 -2.3171031350477759858];

% Layer 2
b2 = -2.2295505771747690105;
LW2_1 = [4.5531427497103402757 7.2352282414584037085 -0.22663187848204568997 2.9820864094595886939 0.4916972654936100362 1.8434377560332171342 -11.20290399148995597 5.5509515872365646771 -7.5114896190009075028 0.021835033292670093241 -3.0053791169880721412 -1.217371620646538144];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
