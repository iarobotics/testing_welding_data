function [y1,xf1] = nn_d16n10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 01-May-2019 22:41:33.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x16 matrix, initial 16 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x16 matrix, final 16 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [5.7089999559752175884;2.1594052944199697563;-5.3027710556048814894;4.1109632629610750598;-9.156746371723563982;-22.471135593905614769;5.5919616103360212378;2.1689382924035744971;-23.090276821346897407;-27.617780691214353084];
IW1_1 = [-20.174916226614357129 7.6525918516295297067 10.211573756348055753 -0.3638102592030159621 0.45390533960149781478 0.99719687944399437729 1.0346998739571349191 -1.8071689917052029539 2.6310433066196421414 -0.92682084056147806539 1.1115370932469419429 1.099575276099770571 5.0175921300831252125 -0.23050537119801539632 -3.192272081408068729 1.2412002516018341147 -1.289821505319331596 -1.1362423903744556242 0.50031620708925350627 -1.049470269956893187 -1.0183770994498446694 -0.13175142056659530643 -0.57422981559777674931 2.5770488781800504619 4.8359007741153368087 -0.19302284544402545374 -5.3685049320544253604 -0.64995295926220364446 1.6274536093282481186 0.13676745881234325664 2.0173490398668385559 -0.079061015899622597014;1.6767785497814959861 -0.94421431609268091645 2.2884657648122193052 0.16545512333003581373 -0.6143784037734499881 -0.25804107032247369791 0.32878095561429021565 -0.88271577886314434025 -1.9371695994696735976 -0.6203387981861510081 -2.0234337647867168819 -0.99941326353614690081 -0.66724948467326172796 -0.10668616508197867332 -0.82275538055678576477 0.73308419759591592069 -0.50219994719139748884 3.965835153797600654 -0.41448479080289590826 3.3166474845112543512 0.52864327157427415393 -2.9709835663564581054 0.19695320423275872179 -2.4593976758068976096 1.3620814044631694983 -2.4946402248976453642 2.8507807112769185665 -3.6381729970177549838 2.0296982835404593359 -5.0881227408644003063 3.4553724126165854535 -10.067616337932747683;19.377690281487758739 -6.7795590976508455228 -11.435160473322374841 0.22731463398984272373 -0.0043833862648781189708 -1.3852920994294362078 -0.69807549702860316465 1.8088156249576428092 -2.7581831323458905203 0.88567678723844200928 -0.96221419856747281152 -0.90518258579788046791 -4.6313639432563897813 0.42613256438357227651 3.0991960842624273198 -1.4140751498547095011 1.2990802343568144117 1.2235720342352383039 0.026845332852982937283 1.0138202876864985669 0.80171638304892733906 0.077554321724159713813 0.43173078420162591673 -2.8032460028969174992 -4.2136465566461698273 0.37941960217627340723 5.8946947322125344826 0.61086553725351211419 -2.0171750216423212088 0.029207141933902190656 -2.1607960170742366302 -0.20772751995409291514;-0.47967483625884815845 6.153646387794864836 -15.549034761806142413 0.74077019165648649857 1.0805989026801798847 -2.6657467253967768173 3.2698158509226180612 0.80440296999046234649 0.39550010116773948177 -0.96213637288643072409 0.70036272167556878898 -0.3511161376952955937 4.0415693553703739838 2.3574334480207870257 -0.38165281006074586179 -0.97763672312355287541 0.33611323207567117555 1.697296588245678084 4.6262701356553677101 -0.1811768379249970029 -1.0613657661944726485 -0.69253577072783067958 -2.131114557023197964 -4.3000534089567876705 4.7425590266146988583 2.9394994981471693762 6.0172164954342299836 0.061294067193626317058 -4.3855517622418105361 2.5182065148958625578 -2.3237771642635451919 -4.2400767016933951226;20.784044294583530643 -12.035199099938793665 9.5570868457067845725 -10.328104113285421661 20.018536901533298789 -10.408688252639125338 7.1165247162853368934 -12.149322398901043485 1.0573848866750610309 -6.0621274340798452229 -10.217017830786323529 -5.4100048043278228249 -13.774526867191111634 -2.1728169994295840617 -8.7307120798401296469 2.4157871465607949624 -9.2875008721063192496 5.4309793940025716807 -7.0800650353171574736 5.8301137217794236633 2.3401571351576158087 7.9627733048226998491 4.2843211967952807839 5.2975889869251515663 -3.4165940242288206363 -3.4650646782228253784 -1.2077837597236784628 10.400986274844330026 -0.24858290807818750334 -1.9735641941002988187 -8.4639352276701789179 14.050644080214700793;-64.528493203959499169 41.816589819097103486 -58.827444304693841559 31.774674495938199925 -38.531486056443839061 22.013203564888598862 -27.884722440024322765 25.637817116715464039 -6.0877129649076877627 22.039418815398274631 2.0651572415075176714 16.96076280769231559 8.4928058381936910592 3.0154087337435750982 16.681599085198698162 -4.9487116875362184842 21.519991592507338396 -1.3857332434109779218 16.148445183504751554 -7.4598009482003408976 15.879373294280918927 -18.743157757553692733 8.2149083044519279895 -18.767419234320403376 39.916975887407915025 -28.699698440939847899 29.311524930883095408 -31.403064803816974404 27.426853515408200934 -32.516952468230151396 22.819191034568284238 -46.518186447465957656;12.641276478443106868 -6.4425794149486987905 14.114041202791424823 -6.1324099920160461963 7.8385612025212569876 -5.5256510389306816577 3.0829312898784708707 -6.4574510468747456926 4.0930294149371633239 -4.0081135382007531121 2.1275525187103534464 -0.24727829340683349368 2.2304363811819900576 -2.5584617876410651327 -9.6985407834646277792 0.46452173219728609688 0.97321780073637498276 2.3676228581566642895 1.6535707309951326316 4.3612897176291038903 0.12469932919774837088 4.4031100549743564798 -5.3570530701508864979 0.70856358221183191048 -10.782020316095309198 1.1119265447127684165 -7.6160182530590194716 11.391463823681741374 -2.2176844545060023783 3.2220949843039079497 -16.425426903918584287 12.002534263367401479;1.6558695591530472324 -0.90673515208727684112 0.38054526243845016031 -0.24561801264088514718 1.2014158509512156137 -0.17995454833435350905 -0.96804951932672256287 -0.62630242977447692088 -1.489076693291409903 -0.92647137033872506429 -2.6664256640301666756 -0.54728466939050635087 -0.71808221955673823267 -0.62862755837705497353 0.29373059296072062674 0.59329134060733712541 -1.6826839104424471394 3.8705768350911440301 -0.32596307268592866757 3.8534690373211200054 1.6907773381766975085 -2.0246000243303394761 -0.69572565112730411219 -1.8336662867451940517 2.4649065431230998691 -4.0051184506560186804 2.7762758350176861555 -3.6496950029024954887 4.8518256464652189663 -5.3973076990917538964 1.2195943424534392285 -10.434100452825942895;55.561784787098822846 -23.377925845061540144 46.644992961068311388 -29.652245107643285138 42.327778336963959305 -36.134747975953899868 36.537916039476698415 -25.484856655405799586 6.8791046076229758199 -12.737398587012764395 -7.0909406855792571633 -7.1155928637549425986 -23.552509074501806197 -5.3223097750094972014 -32.979114156479973019 -0.38984467555517854365 -26.516080597326652679 3.8612451640916947149 -33.532517167197084973 6.1906033480801863078 -25.621459745146704989 13.027006527620796916 -8.9689292110672838021 13.489218927994659936 -16.156590485430299964 19.631131648180502935 -10.201744724627273442 9.8555079930616553696 -10.924374597691430822 12.078827531259694439 12.516792806693526785 37.476377016639865758;52.918663831259451058 -20.743695678601547172 -32.134596881501998666 9.8941603959059829521 -11.243975200987406993 0.69271782657602976041 1.1736694713237125764 5.3360988942304539151 0.77341074471665549606 1.7364332727568279058 -5.423028954446762917 -7.8585558678004705513 -15.385631132638604157 -1.1606706070745727022 14.446441157612710526 -1.4523114777561989541 -2.6764856915194261688 1.8272407766339950896 -12.441625296572377479 2.1358175514046195964 0.1787870409213862255 -0.50716930634804835432 2.6307613320283902425 -5.7527458563547764214 -9.5513235977978663271 -1.1334752280194080321 19.476580346426043633 -6.1834609686642201254 1.150127867285829053 -3.3864300200429293675 5.8165781274030337045 -5.1757510195300655553];

% Layer 2
b2 = 0.24671486432663086719;
LW2_1 = [13.032005253445936077 2.8848937563243737259 12.543218153669187132 -1.2307029021276900682 0.51754818662840307297 0.40704111486640104367 0.41044614565628456671 -2.890394580183089257 -0.53697259730585711335 0.52655770427579184911];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+15,17)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16]-1,17)+1),32,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 16);
xits = finalxts(finalxts<=16);
xts = finalxts(finalxts>16)-16;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
