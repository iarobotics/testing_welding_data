function [y1,xf1] = nn_d8n10(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 01-May-2019 17:59:46.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x8 matrix, initial 8 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x8 matrix, final 8 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [-9.1009367367518638758;-5.3135854188960767175;8.9057983567597638341;-54.906721863676182238;5.1425668170780864941;9.8776813804693617271;5.0252967494897031742;-4.9739449971723503907;8.0573910932297838627;-8.4229428534232884118];
IW1_1 = [-0.45571083781676852142 -14.224195241954200597 13.411822584518169776 -2.602436937380387505 4.1331081239536349159 5.5615430866396566856 -7.2842042905103943085 7.2711304641146039529 -9.386684114438144988 2.9869477322879549597 7.5302979835267640496 -5.3304123846384943164 0.012868222866251444181 0.86644120097496624133 -0.80402229539351011134 -5.0507829179665231223;29.531305382870865373 -20.84784659291182507 8.3928117638701209557 -6.4612664712728591354 9.0568155497585394187 -6.2359795189840063756 0.24867587699117693623 -1.3726594388563464477 -5.354285782536472027 1.9261157609790575673 -4.1545551810641629942 5.507835966697235186 -22.073222321064356777 10.144151372864392613 -15.979012607416199998 10.956197076046397143;-22.226869260166672859 9.2352648436724624759 -8.4846037401805940448 3.0813532541972548096 11.961262624780230723 2.9415643519931466976 -2.0696362056378774241 -6.2668478736976087617 7.7931073940179462767 0.91133482351914507635 4.2779809499163876652 2.9272330825318038094 7.8275234022629929242 3.5142161820147808093 -1.8655682130982373934 -4.8005170901097429237;9.6251326469308526868 -0.43512619890399018008 12.319796917380616108 -1.5621460720264717104 -0.48814411683797170882 -12.236835893042108836 -2.0829782755073185108 8.220199095643607734 -3.2085543903456690273 -4.9313809913482264946 7.0556661685498998082 -10.517748139352919523 0.23370106075998836603 -10.845433650458398134 4.6343705152651963886 -9.833191195942738716;-27.906699577207167096 19.96637848569974949 -10.070221240258238282 6.7077810723249458036 -8.7992098013984048066 6.0584002922784980782 -0.16087674931392889621 1.2586147428416345484 5.0026958215311987388 -1.760872042775381896 3.6011981081941701888 -5.1583222098195591343 21.913805947299945132 -10.188818633645478684 16.828947650756902021 -10.939658768214703954;-20.908750978737920434 10.064097757366788244 -13.351309088056387608 4.2776077017260574209 14.081386232123163538 2.7967057235043215613 -2.4397765021299617771 -7.1648292175594594511 9.239580601420941619 0.80041274137913498432 4.2050869057014228503 3.1188441508573538918 7.8320318552230325793 3.8673199944725968891 -1.6837159440366220586 -4.9102025236154736021;-26.199245104800851891 19.480744470660301459 -11.645225741852751611 6.8317164233745826252 -8.8093184505752919478 5.8642534798973455779 -0.042302360707846736743 1.1525039312164602201 4.8944873909395933964 -1.5369976259992130796 2.7338203435970185318 -5.0350002942140035245 21.738822488403936717 -10.252308506143398503 17.852456090449489778 -10.925620065085972499;18.633156020057448643 -7.9628241499730414432 -8.1736133749207926513 0.25113070516010838062 -0.074985345748318887882 -3.0197890567398135708 -3.0973314769112452183 3.6280357430890770587 -1.5421220982087149309 0.18822163429456650885 -1.1861724457147309053 -0.7528446179900869506 -4.7163646019428870915 -0.50138844365443679951 2.5542672956886129931 0.60630413213887013324;-0.61022813469207359827 3.1447198039840298378 -3.8588031175696175801 0.87062184652453467049 1.342747269927652809 -0.44995927412540215329 0.41808227325837615806 -0.80670434073646724027 2.4845139630088799443 -0.16283316124392799296 -1.3349941795506499176 2.1919180535586249015 -0.29661382520310913824 0.84781633127802114025 -1.6437275176778451957 2.879287476061248352;2.938117865153543562 -4.4177189262429026329 3.0404881818540361316 -0.77074663023030520748 -2.1020929428222694391 0.81797788536159221628 -0.86714599573354200768 2.0838713161601436497 -3.480777694419184165 0.61107965438254929769 0.82690563097902702872 -3.1526316799252507295 0.35510646694598585471 -1.2447902256802354515 3.4018921043734731136 -3.1029531398795318076];

% Layer 2
b2 = -0.71918085843904466792;
LW2_1 = [-0.90580831419086282885 22.926439844662056089 10.396455392626853254 1.6370901629232457175 45.361186078233167507 -8.6514589703791529018 -22.387888626435113792 1.7474214650373385282 9.3715195641783601843 8.965819335231316245];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+7,9)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8]-1,9)+1),16,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 8);
xits = finalxts(finalxts<=8);
xts = finalxts(finalxts>8)-8;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
