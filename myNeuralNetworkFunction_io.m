function [y1,xf1] = myNeuralNetworkFunction_io(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 10-Apr-2019 23:42:32.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.48032011663891927;7.8599878746407405572;2.4924813727253654072;-8.6040348165395350577;3.6397854576032746543;-1.7759053776720412632;1.7515630649293352228;7.8901207995974544929;3.8205236540015254931;7.5639025536654882487];
IW1_1 = [-4.8034934132874864687 -9.0780374464503026388 5.700287710801259955 -0.86403566931268449558 0.20085449270575833625 1.1680667614102446805 -4.4885843640412161903 0.19745260554907467787 -0.77744341581802878238 7.3965221043914173293 4.2010267350144854248 -3.2526637552591384228 -1.7236600093719196547 -0.55767748813432782562 1.9691922660628631281 2.3577536032124437604 6.7272702240499322457 -0.29688598215125244772 -6.9369670561636853634 0.95292701960907755243;-4.9996458552222584615 5.4863466200033448317 -8.7570816526969412763 9.4665366091254803393 -3.1497473817825318854 2.0898812118350753586 -1.576565420922298788 -0.31713650363661405329 3.9902402720929801561 0.35753387251898821608 0.83606056879078238797 -5.318765220349262357 3.7490516705984657797 -1.4791097930136487548 -2.4168935141904466235 -0.35884441687302393031 6.6798717848622723992 -5.682963828394458794 2.8309648447492765655 1.968872479756131888;-5.377458812031038704 5.7646692423458487653 2.105877625963730182 -3.4965462118225469901 4.0038105529123555471 -3.3447312880328556872 1.0383780098976627126 -1.1375598006676150842 -0.71093477113421355007 2.0121585436603304231 -4.4358179398881558697 -0.20999581777999851151 -4.2972971810757600863 -0.45757485280481319245 1.043718838947900851 -0.14316129197012600338 3.0453817648233201254 -0.89329758995437646973 -0.33928184510272024754 1.523090087222398914;31.146774809270961981 -21.224896000509858141 -16.932839930211134316 8.6969157224523705452 -2.8012329667728166349 -12.505924475860322076 -0.41299044444274290999 5.1313042454844817186 1.0919973710117676369 7.3160807018368902988 -4.5462493191609869569 -0.23917749187709164138 -5.9915491695674383266 -1.9673043390124342888 0.038552684331281852903 -3.9370799695800671181 4.7755191854521399364 5.0478195172911686228 -1.9617965723682344592 -1.3790398549672637785;-14.601255286672085276 14.461212384930458796 -6.6037199009601206257 -0.81571794518647422478 5.3756550938173486287 -2.5405120212350587039 9.8032044103922295619 -3.1287073598726009571 3.4750347796752074636 -5.9024040717249128818 -2.3181390021355521291 -0.88789062144110730834 4.0552565164547607068 0.68856000830326624662 -0.39734251537363346474 2.6624065406742394302 -0.21573890088632066697 -2.3551742171659011404 0.20788225061596618537 -0.96524525849912878872;7.9387301782527224248 -7.5826976714630713872 -0.51359840845241566676 -1.5869633137542742407 -6.7047873625488447757 9.7986691958516409784 -6.2536217348245140002 6.2431847418769876867 -1.4317831875563247213 -5.2217284705415858426 2.6364210214618206685 -2.793343454395817993 0.018421818823398612708 3.3992609340774011528 1.5963190186024807105 1.9682045011314250882 2.2867040804856579861 0.13208794192977477144 -0.50957803598206541373 -0.65316168018872222678;-7.9379400786552469782 8.1457828495221598075 1.6451612802982422679 1.411320858009105228 4.1805751705841824872 -9.9934605758959555999 7.3025109805014478681 -6.2636110702091292168 1.9730167928948452172 5.7814565839775404754 -3.3044232413844731866 2.0974710961890474792 0.61165106623693477061 -3.6203544868470878271 -1.4560699543968191882 -1.4180246422236690851 -2.4089590333890327223 -0.26701528226589021919 0.32986923233039677772 0.57853245667806674213;-3.5720094067494381207 5.1661009287599082285 -9.6181053052189966479 9.8759944282160372353 -3.3595603797665840595 2.4462964717193225184 -1.5433556125416594274 -0.41179649488803266033 4.3772312490587275136 -0.74128063061487026175 0.87602212479007057766 -5.2676155990470894253 3.5986814820963113348 -0.81153926165167078466 -2.5120490343777670539 -0.26625546395297217117 5.6844483795373026425 -5.1148123405216807669 3.3529614228527897524 1.4138415045644086021;-13.787084157499300829 15.526693101205886194 -7.2220772138078110913 -1.1512037576378710835 5.5701464072444828446 -3.0899404867590529733 10.62325603561420273 -3.016013671038845434 3.3065289044783705563 -6.4083532005561432143 -3.4377932105697976972 -0.1902668952476641584 4.4405799664314384856 0.60050045705925492179 -0.54883680237652388012 2.3480220516941328057 -0.77349619424890658781 -2.3779899473073826677 0.68800263473721068319 -0.98099602364985960534;-31.436760854530781728 18.060523705624706992 17.43670220744012056 -7.8329096155635662413 3.7423051967182181521 12.07047565096429409 0.27053363582252987207 -4.0781685313068667398 -2.301638800780994476 -6.8032798160016945133 5.3552428776587062131 0.20855225104888233667 8.3041135069551366144 1.3734761090227403102 -1.9745370922045097917 3.0982653014773711142 -4.7117281208750965149 -4.1186833024039657403 1.3833895475851976098 1.3027995654431199224];

% Layer 2
b2 = 0.088243413581589436046;
LW2_1 = [-0.5199042523738934829 6.8377269476639224166 -0.19750484607036356 -4.5060979081169447724 7.2190484097122924467 -2.390811454814440129 -2.4108250062391847202 -7.1805514060737820614 -7.2467089460895710573 -5.5270239556080165144];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),20,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
