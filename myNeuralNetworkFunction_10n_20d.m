function [y1,xf1] = myNeuralNetworkFunction(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 01-May-2019 01:14:31.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   xi1 = 2x20 matrix, initial 20 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x20 matrix, final 20 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [588;52];
x1_step1.gain = [0.000550206327372765;0.0045662100456621];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.2710702167917733441;8.2295202511903546849;5.1003766012732629775;5.2089231659941139796;-5.3252602983958281513;4.6099108298120494709;-4.0370069858863102397;9.3049173050940261476;4.2414719522541863839;-3.8690288878143599405];
IW1_1 = [8.8000364655894660615 -4.7414910395769638285 -0.91217763933974027601 2.2547909526253984147 -2.9370057690072917111 1.6120095776355463091 -1.1119735529427035026 -0.04007651032123477064 -0.64874023675659275856 -1.0868129779055062389 0.41863692372846772471 0.8432581892221034936 1.3687007503853092505 0.55000973398536923131 0.46918010893526895799 -1.2783713299244321426 -0.5362344032095769375 0.94023883942577257677 1.1056906009378082434 0.1272399223249849054 2.6309198864901288673 -0.27821290115295688183 1.2996953536012620933 1.0696210351537653871 1.1286450201872020305 0.88542142395227296792 0.600058037027926372 -0.84892795163313594653 0.34697127774737834827 -0.76096565718736486339 -0.40727269530378334972 -0.28791786296649157784 -2.3749459416178053672 -1.8744190485995444462 -3.5953556395375505517 -0.08294438531572434492 -0.2686785349234562803 0.10927305929764040415 -2.8677362369993044666 1.8667509148520877726;-35.043733187397961615 19.405782626711474137 17.823042110202436561 -7.215495095879957077 2.4876169558643899116 7.8001513159108348816 -1.8644909186234694953 -1.0310016298187523187 0.98156076463181218816 -3.1233341386627166969 4.8262775388475445126 -0.99021458407283691194 12.369366791303784581 0.60875404756120998773 0.96175868093829963712 2.0537875782241457046 -7.0229399089735053963 -3.1154056493528128335 2.6990159947339522617 0.72773864834167345528 2.536739200349751755 -1.8281749598127252643 -3.4086554728772093803 3.982021740433430157 -0.12094855675492630076 -3.4729194980363691236 -2.598876293854573305 0.3157160372834981743 2.5925454411373274333 1.3609601068823318215 1.4558526436668695059 -0.52506728921699630241 -1.3900037977389287924 -2.9813361835198697314 -4.6853175182393114184 2.2120019524879324102 7.7836281875991586432 0.57545798802118053317 -4.9849376155693967405 -0.32725824865513386541;-0.63596184880687822716 4.2852553431072193391 -7.7483483417446157304 2.7823564862626670724 -2.670793412572643355 2.8295433605256419263 -1.7486243562987362488 1.0450911734014800558 0.33079504468055859201 -2.6882764936448846349 3.8538604503420010872 -1.5566817820580627352 3.5350098866930155239 0.59877254505443122667 0.45308302209042150555 0.99883540459980835191 -0.47231434465029586978 2.3633554531435150281 0.020033747871454534589 1.7923418020016945729 2.203369081312636979 -1.7371324605085010084 1.2698160666615847525 -1.6028377335984074215 1.9360306582529624997 -0.75111234590438202829 -0.10624376064084917193 -1.0556691068181560667 -0.3577394166888578364 -2.4498956266857372377 2.1384391545485965658 -0.83104762519141184285 -0.29130050907187127196 -0.91463205840307004735 -0.75821585648725020601 1.5795465794835601425 -1.0697803603383648774 0.66590840435071274594 -1.505999652500513708 -1.5286121640192684712;-8.8276340125432817274 4.8403874342345130088 -3.4264822050512000473 -1.0989233091741776871 3.5183687360161037816 1.0882216445804775429 -0.36248362779404436074 2.3428364980487863534 1.264618831855836234 2.4927717692608037936 -1.5302564905068647416 4.5150308585036214026 -3.3428241992086720202 2.9832304882968765369 -1.8013399136114716104 1.3024888224085293675 -0.38379470604568960423 -0.24180189971232790569 0.12362462667460014099 -0.29990154779109362559 0.61886468670802807779 -0.1813771093274234858 0.85763661404079716277 0.50966996679492615474 0.69886771963093630156 0.71990723993080596443 -0.18827732358505747112 -0.79797689158860740655 0.0024449913291259431705 0.87731304526088282891 0.16887236683577031005 -0.59795845103531075626 1.47175229799792473 0.29181899372645137003 1.5229798508798304546 0.29323737820933004627 1.3119914923515698657 -0.23935765839801911858 1.7698358178324458123 -0.57745703926961200469;7.7179335800484523133 -5.0467214342449953079 3.6875177983845901508 -0.027985473841783847782 -1.3904724311094545097 0.082450429379982995148 -1.4070039563710636799 -1.8632194730198561317 -1.1484062677878839054 -3.0482249267553438443 1.7007412059059108245 -4.6270961608349399086 4.3626070767924733929 -2.672338719920320127 1.8487757663270352193 -1.64825540298240103 0.097605821557037272806 0.43241811304625998869 -0.060495705645468397793 0.021589134269385926168 -0.75320560253576995802 0.26269621049544600311 -1.3279082781501136967 -0.69850315737874224542 -0.99568534416466358827 -0.99715845879407516428 -0.059831326622297044404 0.64622637338066934998 -0.59597443741773259429 -0.36123100640953981211 0.16872072258123441135 0.3190937058374196944 -1.621107818356522845 0.17976456300696913582 -1.2385547177517826078 -0.17503668653795650956 -0.66759746437669731378 0.023445005799196019791 -1.7231358907850917728 0.54020438190499664444;-14.138165992428531226 14.043865758946072475 -9.7768625521501864029 -0.46813355610631324222 4.7414140075604196412 -3.0345991410210526595 5.7545553328242213809 -3.0858186406957850423 3.9790020114812336693 -1.9862652056257730226 3.6822175701654993318 2.2008549921806586092 0.70931158860919463205 -0.63435943421341878246 1.5307830555891674962 -0.34615862819131681949 3.3400320462589601078 -2.0810309609241994799 -0.99203819887424704582 -1.1453771728171864286 -1.3863385034791402273 -1.6346471136155125148 -1.9648328680434794524 0.72885369065062011185 -1.0651021172461687669 0.57576709771522838199 -1.3603739204520792772 -0.25619496218448617464 -0.73717555229153552965 -0.13092197742088088064 0.30357947763731568669 -1.0825092473374717805 -0.56392949615547016684 2.451632574439665202 -0.081611439232035939972 0.48749530253021011728 1.2199779800954597686 -1.1709818985927906709 4.235061123230296154 -0.28824932718894125117;1.100956960183014921 -3.5331636556309575781 4.3257031166300672353 -1.7092953902553242873 2.8631710810240282861 -1.9443016917729414317 1.48025585665662196 -1.7246301213128183427 0.47154880301103613283 1.5256339553941624665 -2.4665500824680726133 1.87914906870910281 -3.6737763016759501511 0.049814928667489613567 -1.021580731929867536 -1.0882494861641218709 1.2019739304543413105 -2.2028311203541370844 0.043472980749687861746 -1.6779850386858095046 -1.7502971353696228363 1.0945405736398414742 -0.96922967176583407767 1.8713259255994667551 -2.3053365233133460421 0.74085978268764485222 0.31640738304677484827 1.0167834322098798783 0.24453952857415542366 2.5820573834242876998 -2.2471574673257190824 0.42937380050995610503 0.1009641655897201562 0.65033936971684780382 0.48232621507522099868 -1.2109754598078923404 1.0418135910044801218 -0.6029938222420893057 1.9728696944892876175 1.4192930150668421341;-35.169941518198207575 22.473355121293103309 17.673837944029710201 -7.7541082593032042425 1.239992090571122807 8.0084135738399684357 -1.6401412191749642489 -2.9594481146180537934 2.0328111344441572861 -2.5739242177977064152 4.2448070924144296612 -0.011521851555477025109 10.776934332054098675 -0.35303602568196651434 1.831858053168378353 2.6983587161816391387 -7.0167187579987606583 -3.6388424286193465917 3.6059477001177486777 1.4346327211113958366 2.6464566906665845103 -2.2599889662303969118 -2.2853711037961077501 4.6529002417517739687 -1.7905206210280326662 -3.8816236997836961464 -0.42761341326650514905 0.41593238420721379001 1.9013492670303682175 1.0868487199011471755 1.4557496727235523792 -0.40695340173806382467 -1.5788370450816895385 -3.5816433179243643004 -4.4628999630985521918 2.1251463294416921279 6.3470387585968230937 1.3480374668889196776 -4.5064025510226377591 -0.59803878103936203292;-14.198213622478045082 13.009679088748052678 -9.0212958464875150355 -0.32308890105671239645 4.7302238722358787015 -2.2901629767403925975 4.8260869690316745562 -2.7916557630734573081 3.9874010422604850845 -2.0923919770110366301 4.3269181119433444138 1.4895905080795346365 0.98187283233221733791 -0.62615946785527665241 1.244793367336121781 -0.15210384553360262183 2.9819439099319300368 -2.0749148459942587941 -1.0307015254351532541 -1.0766246396059291346 -1.4919469842824715222 -1.6726597434771175443 -2.153933378400437082 0.73481478197591065804 -1.0762129619704046135 0.40065480129967578904 -1.5274210746897776136 0.0040479672350981210638 -0.7671892286607067124 0.049528240986134342005 0.40966355143125188221 -1.0822430521011663362 -0.14232618112350314821 2.3003850354630550612 0.00019558605605937695593 0.55439472415547452755 1.2158927875009204467 -1.1150261288668721349 4.132104279978988437 -0.42497253221462866213;1.2593183460965677867 -2.6076204156305489157 2.5815103015598248604 -1.441701924485178532 3.4112292866241897826 -2.3286835798396610109 2.2812315982592519248 -2.6577955594078765955 1.156671696199168764 1.0358952831988439414 -2.5354578315813443012 2.6182192694465218352 -4.6903038107916072974 0.35458468227572842446 -1.603979304382653126 -1.2038166543842343525 1.9648181516399705338 -2.4089840508292312826 -0.096438541161327856477 -1.8540726295491367637 -1.6246586634807125282 0.9649515377895595547 -0.67483232356862232759 2.2291294598156512485 -2.9832119197328896831 0.98875871397423609199 0.96487370693131135901 1.0429009379107943012 0.19688665231116495025 2.8738289853794096729 -2.5921004351019951706 0.35149062788854534833 -0.34073678967425358177 0.7010740999348472613 0.59269481422083603039 -1.2647838952825614101 1.3465954175425480788 -0.64832715441029176162 2.3894996178766403361 1.5337885018393992986];

% Layer 2
b2 = 0.36791583782051862084;
LW2_1 = [0.47490942391052143323 -6.7280427352623757287 -3.8739685793420455262 2.1835125991920665278 2.1781687054143290538 -5.9777271434519585469 -7.9983240224134179996 5.7086064968706029532 5.9861911894401806933 4.0100832689636254358];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+19,21)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20]-1,21)+1),40,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 20);
xits = finalxts(finalxts<=20);
xts = finalxts(finalxts>20)-20;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
